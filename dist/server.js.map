{"version":3,"sources":["webpack:///webpack/bootstrap 37517378778ec302f8f8","webpack:///./src/server/server.js","webpack:///external \"uws\"","webpack:///./src/server/connection.js","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\"","webpack:///./src/lib/message.js","webpack:///external \"lodash/isUndefined\"","webpack:///external \"node-uuid\"","webpack:///external \"event-emitter-extra\"","webpack:///external \"lodash/forEach\"","webpack:///external \"lodash/isObject\"","webpack:///./src/server/rooms.js","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/map\"","webpack:///./src/server/room.js"],"names":["Server","options","rooms","Object","assign","timeout","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","port","server","bindEvents","Promise","resolve","reject","err","Error","close","on","onConnection","bind","socket","connection","emit","id","getRoom","getConnectionById","eventName","payload","broadcast","module","exports","uuid","Connection","v4","promiseCallbacks","onMessage","onError","onClose","handshake_","retry","send","maxCount","initialDelay","increaseFactor","then","joinRoom","catch","console","log","data","flags","message","parse","reservedNames","indexOf","name","clearTimeout","once","send_","createResponse","dispose","error","code","removeFromAll","callbacks","roomName","add","remove","getRoomsOf","messageId","setId","setTimeout","toString","promiseDelay","ms","task","defaults","maxDelay","counter","delay","Message","raw","JSON","n","p","e","i","isResponded_","warn","stringify","events","eventNames","forEach","removeAllListeners","event","Rooms","getConnectionsCount","room","Room","connections","connectionId","keys","length","index"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 37517378778ec302f8f8","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\tthis.rooms = new Rooms();\n\n\t\tthis.options = Object.assign({\n\t\t\ttimeout: 30000,\n\t\t\tmaxReconnectDelay: 60,\n\t\t\tinitialReconnectDelay: 1,\n\t\t\treconnectIncrementFactor: 1\n\t\t}, options || {});\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\n\tstop() {\n\t\tif (!this.server) {\n\t\t\tconst err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.server.close();\n\t\t\tthis.server = null;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t}\n\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tconnection.on('_handshakeOk', () => this.emit('connection', connection));\n\t}\n\n\n\tgetConnectionById(id) {\n\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t}\n\n\n\tbroadcast(eventName, payload) {\n\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t}\n}\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 1\n// module chunks = 0","import Utils from '../lib/utils';\nimport Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.promiseCallbacks = {};\n\t\tthis.socket.on('message', this.onMessage.bind(this));\n\t\tthis.socket.on('error', this.onError.bind(this));\n\t\tthis.socket.on('close', this.onClose.bind(this));\n\n\t\tthis.handshake_ = false;\n\t\tUtils.retry(_ => this.send('_h',\n\t\t\t{\n\t\t\t\tid: this.id,\n\t\t\t\ttimeout: this.server.options.timeout,\n\t\t\t\tmaxReconnectDelay: this.server.options.maxReconnectDelay,\n\t\t\t\tinitialReconnectDelay: this.server.options.initialReconnectDelay,\n\t\t\t\treconnectIncrementFactor: this.server.options.reconnectIncrementFactor\n\t\t\t}),\n\t\t\t{maxCount: 3, initialDelay: 1, increaseFactor: 1})\n\t\t\t.then(_ => {\n\t\t\t\tthis.joinRoom('/');\n\t\t\t\tthis.handshake_ = true;\n\t\t\t\tthis.emit('_handshakeOk');\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tthis.handshake_ = false;\n\t\t\t\tconsole.log(`Handshake failed for ${this.id}.`);\n\t\t\t\tthis.onClose(500, err);\n\t\t\t});\n\t}\n\n\n\tonMessage(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Message response\n\t\tif (message.name == '_r' && this.promiseCallbacks[message.id]) {\n\t\t\tconst {resolve, reject, timeout} = this.promiseCallbacks[message.id];\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = assign(new Error(), message.err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\tonError(error) {\n\t\tthis.emit('_error', error);\n\t}\n\n\tonClose(code, message) {\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\tforEach(this.promiseCallbacks, (callbacks) => {\n\t\t\tcallbacks.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.promiseCallbacks = {};\n\n\t\tthis.emit('_close', code, message);\n\t}\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst timeout = setTimeout(_ => {\n\t\t\t\t\t\t/* Connections has been closed. */\n\t\t\t\t\t\tif (!this.promiseCallbacks[messageId]) return;\n\n\t\t\t\t\t\tconst {reject, timeout} = this.promiseCallbacks[messageId];\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\treject(new Error('Timeout reached'));\n\t\t\t\t\t\tdelete this.promiseCallbacks[messageId];\n\t\t\t\t\t}, this.server.options.timeout);\n\n\t\t\t\t\tthis.promiseCallbacks[messageId] = {resolve, reject, timeout};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\nmodule.exports = {promiseDelay, retry};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 4\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r', '_h'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"event-emitter-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 10\n// module chunks = 0","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\tforEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 13\n// module chunks = 0","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\tforEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tforEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js"],"sourceRoot":""}