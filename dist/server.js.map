{"version":3,"sources":["webpack:///webpack/bootstrap 482f1b58df2392940a38","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///external \"lodash/forEach\"","webpack:///./src/lib/message.js","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/isObject\"","webpack:///./src/server/connection.js","webpack:///./src/server/rooms.js","webpack:///external \"uws\"","webpack:///./src/lib/deferred.js","webpack:///./src/server/room.js","webpack:///external \"lodash/debounce\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/map\"","webpack:///external \"lodash/values\"","webpack:///external \"node-uuid\"","webpack:///./src/server/server.js"],"names":["Message","raw","data","JSON","parse","name","n","payload","p","err","e","id","i","Error","isResponded_","console","warn","then","emit","catch","stringify","events","eventNames","forEach","removeAllListeners","event","Names","RESPONSE","HANDSHAKE","PING","ReservedNames","promiseDelay","ms","Promise","setTimeout","resolve","retry","task","options","defaults","maxDelay","maxCount","initialDelay","increaseFactor","timeout","counter","delay","once","clearTimeout","generateDummyId","length","Math","random","pow","toString","slice","module","exports","uuid","Connection","socket","server","v4","deferreds_","state","States","OPEN","on","onMessage_","bind","onError_","onClose_","autoPing_","pingInterval","ping","flags","message","Events","MESSAGE","indexOf","onHandshake_","onPing_","onResponse_","send_","createResponse","dispose","responsePayload","handshakePayload","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","joinRoom","HANDSHAKE_OK","log","handshakeResponse","deferred","reject","ERROR","code","CLOSE","rooms","removeFromAll","roomName","add","remove","getRoomsOf","eventName","setId","onExpire","send","Rooms","connection","getConnectionsCount","room","getConnectionById","Deferred","handler","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","args","apply","Room","connections","connectionId","Object","keys","index","Server","assign","port","bindEvents","close","onConnection","onHeaders","onError","CONNECTION","headers","HEADERS","getRoom","broadcast"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 482f1b58df2392940a38","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 1\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport values from 'lodash/values';\nimport {generateDummyId} from './utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = generateDummyId()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\t// If thenable\n\t\tif (isObject(payload) && isFunction(payload.then)) {\n\t\t\tpayload\n\t\t\t\t.then(response => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('resolved', payload);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('rejected', err);\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\n\nMessage.Names = {\n\tRESPONSE: '_r',\n\tHANDSHAKE: '_h',\n\tPING: '_p'\n};\n\n\nMessage.ReservedNames = values(Message.Names);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId(length = 4) {\n\treturn (\"0000\" + (Math.random()*Math.pow(36,length) << 0).toString(36)).slice(-length);\n}\n\n\nmodule.exports = {promiseDelay, retry, generateDummyId};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 5\n// module chunks = 0","import Utils from '../lib/utils';\nimport Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport debounce from 'lodash/debounce';\nimport Deferred from '../lib/deferred';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.deferreds_ = {};\n\t\tthis.state = Connection.States.OPEN;\n\n\t\tthis.socket.on('message', this.onMessage_.bind(this));\n\t\tthis.socket.on('error', this.onError_.bind(this));\n\t\tthis.socket.on('close', this.onClose_.bind(this));\n\n\t\tthis.autoPing_ = server.options.pingInterval > 0 ?\n\t\t\tdebounce(() => {\n\t\t\t\tif (this.state != Connection.States.OPEN)\n\t\t\t\t\treturn;\n\n\t\t\t\tthis\n\t\t\t\t\t.ping()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tif (server.options.pingInterval > 0 && this.state == Connection.States.OPEN) {\n\t\t\t\t\t\t\tthis.autoPing_();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {});\n\t\t\t}, server.options.pingInterval) :\n\t\t\t() => {};\n\t}\n\n\n\tonMessage_(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\tthis.autoPing_();\n\n\t\t// Emit original _message event with raw data\n\t\tthis.emit(Connection.Events.MESSAGE, data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.ReservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Handshake\n\t\tif (message.name == Message.Names.HANDSHAKE) {\n\t\t\treturn this.onHandshake_(message);\n\t\t}\n\n\t\t// Ping\n\t\tif (message.name == Message.Names.PING) {\n\t\t\treturn this.onPing_(message);\n\t\t}\n\n\t\t// Message response\n\t\tif (message.name == Message.Names.RESPONSE && this.deferreds_[message.id]) {\n\t\t\treturn this.onResponse_(message);\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tonHandshake_(message) {\n\t\tmessage.once('resolved', payload => {\n\t\t\tconst responsePayload = {\n\t\t\t\thandshakePayload: payload,\n\t\t\t\tid: this.id,\n\t\t\t\ttimeout: this.server.options.timeout,\n\t\t\t\tmaxReconnectDelay: this.server.options.maxReconnectDelay,\n\t\t\t\tinitialReconnectDelay: this.server.options.initialReconnectDelay,\n\t\t\t\treconnectIncrementFactor: this.server.options.reconnectIncrementFactor,\n\t\t\t\tpingInterval: this.server.options.pingInterval\n\t\t\t};\n\n\t\t\tthis\n\t\t\t\t.send_(message.createResponse(null, responsePayload))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.joinRoom('/');\n\t\t\t\t\tthis.emit(Connection.Events.HANDSHAKE_OK);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tconsole.log(`Handshake resolve response failed to send for ${this.id}.`);\n\t\t\t\t\tthis.onClose_(500, err);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\n\t\t\tthis\n\t\t\t\t.send_(message.createResponse(err))\n\t\t\t\t.catch(err_ => {\n\t\t\t\t\tconsole.log(`Handshake reject response failed to send for ${this.id}.`);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.onClose_(500, err);\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t});\n\n\t\t// Sorry for party rocking\n\t\tconst handshakeResponse = this.server.emit('handshake', this, message);\n\n\t\tif (!handshakeResponse)\n\t\t\tmessage.resolve();\n\t}\n\n\n\tonResponse_(message) {\n\t\tconst deferred = this.deferreds_[message.id];\n\n\t\tif (message.err) {\n\t\t\tconst err = assign(new Error(), message.err);\n\t\t\tdeferred.reject(err);\n\t\t} else {\n\t\t\tdeferred.resolve(message.payload);\n\t\t}\n\n\t\tdelete this.deferreds_[message.id];\n\t}\n\n\n\tonPing_(message) {\n\t\tthis\n\t\t\t.send_(message.createResponse(null, 'pong'))\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Ping responce failed to send', err);\n\t\t\t});\n\t}\n\n\n\tonError_(err) {\n\t\tthis.emit(Connection.Events.ERROR, err);\n\t\tthis.onClose_(500, err);\n\t}\n\n\n\tonClose_(code, message) {\n\t\tif (this.state == Connection.States.CLOSE)\n\t\t\treturn;\n\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\tforEach(this.deferreds_, (deferred) => {\n\t\t\tdeferred.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.deferreds_ = {};\n\n\t\tthis.state = Connection.States.CLOSE;\n\t\tthis.emit(Connection.Events.CLOSE, code, message);\n\t}\n\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tmessage.setId();\n\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\tconst deferred = this.deferreds_[message.id] = new Deferred({\n\t\t\t\t\tonExpire: () => {\n\t\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: this.server.options.timeout\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\n\tping() {\n\t\treturn Utils\n\t\t\t.retry(_ => this.send(Message.Names.PING), {maxCount: 3, initialDelay: 1, increaseFactor: 1})\n\t\t\t.catch(err => {\n\t\t\t\tthis.onClose_(410, new Error('Ping failed, dead connection'));\n\t\t\t\tthrow err;\n\t\t\t});\n\t}\n}\n\n\nConnection.States = {\n\tOPEN: 'open',\n\tCLOSE: 'close'\n};\n\n\nConnection.Events = {\n\tMESSAGE: '_message',\n\tHANDSHAKE_OK: '_handshakeOk', // Private\n\tERROR: '_error',\n\tCLOSE: '_close'\n};\n\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\tforEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 8\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\tforEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tforEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js","module.exports = require(\"lodash/debounce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/debounce\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"lodash/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/values\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 17\n// module chunks = 0","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\tthis.rooms = new Rooms();\n\n\t\tthis.options = Object.assign({\n\t\t\ttimeout: 30000,\n\t\t\tmaxReconnectDelay: 60,\n\t\t\tinitialReconnectDelay: 1,\n\t\t\treconnectIncrementFactor: 1,\n\t\t\tpingInterval: 60000\n\t\t}, options || {});\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\n\tstop() {\n\t\tif (!this.server) {\n\t\t\tconst err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.server.close();\n\t\t\tthis.server = null;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t\tthis.server.on('headers', this.onHeaders.bind(this));\n\t\tthis.server.on('error', this.onError.bind(this));\n\t}\n\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tconnection.on(Connection.Events.HANDSHAKE_OK, () => this.emit(Server.Events.CONNECTION, connection));\n\t}\n\n\n\tonHeaders(headers) {\n\t\tthis.emit(Server.Events.HEADERS, headers);\n\t}\n\n\n\tonError(err) {\n\t\tthis.emit(Server.Events.ERROR, err);\n\t}\n\n\n\tgetConnectionById(id) {\n\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t}\n\n\n\tbroadcast(eventName, payload) {\n\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t}\n}\n\n\nServer.Events = {\n\tCONNECTION: 'connection',\n\tHANDSHAKE: 'handshake',\n\tHEADERS: 'headers',\n\tERROR: 'error'\n};\n\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js"],"sourceRoot":""}