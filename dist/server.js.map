{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap 134b96fe478dfdcfe77b","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///external \"lodash/forEach\"","webpack:///./src/lib/message.js","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/isObject\"","webpack:///./src/server/connection.js","webpack:///./src/server/rooms.js","webpack:///external \"uws\"","webpack:///./src/lib/deferred.js","webpack:///./src/server/room.js","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/map\"","webpack:///external \"lodash/values\"","webpack:///external \"node-uuid\"","webpack:///./src/server/server.js"],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","Object","defineProperty","configurable","enumerable","get","n","__esModule","o","object","property","prototype","hasOwnProperty","p","s","require","_interopRequireDefault","obj","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","length","descriptor","key","protoProps","staticProps","_isUndefined","_isUndefined2","_isObject","_isObject2","_isFunction","_isFunction2","_values","_values2","_utils","_commonjs","_commonjs2","Message","_EventEmitter","_ref","payload","id","err","this","_this","getPrototypeOf","isResponded_","raw","data","JSON","parse","e","Error","arguments","undefined","generateDummyId","_this2","console","warn","then","response","emit","catch","stringify","_this3","events","eventNames","forEach","event","removeAllListeners","Names","RESPONSE","HANDSHAKE","PING","ReservedNames","promiseDelay","ms","Promise","resolve","setTimeout","_","retry","task","options","defaults","maxDelay","maxCount","initialDelay","increaseFactor","_assign2","timeout","counter","delay","once","clearTimeout","Math","random","pow","toString","slice","_assign","_interopRequireWildcard","newObj","_utils2","_message","_message2","_forEach","_forEach2","_deferred","_deferred2","_nodeUuid","uuid","Connection","socket","server","v4","deferreds_","on","onMessage_","bind","onError_","onClose_","flags","message","Events","MESSAGE","indexOf","onHandshake_","onPing_","onResponse_","send_","createResponse","dispose","responsePayload","handshakePayload","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","joinRoom","HANDSHAKE_OK","log","err_","handshakeResponse","deferred","reject","_this4","ERROR","code","rooms","removeFromAll","CLOSE","roomName","add","remove","getRoomsOf","eventName","_this5","setId","onExpire","_this6","send","_filter","_filter2","_map","_map2","_room","_room2","Rooms","/","connection","getConnectionsCount","room","getConnectionById","Deferred","_ref$handler","handler","_ref$onExpire","_ref$timeout","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","_len","args","Array","_key","apply","_len2","_key2","Room","connections","connectionId","keys","index","_uws","_connection","_connection2","_rooms","_rooms2","Server","assign","port","bindEvents","close","onConnection","onHeaders","onError","CONNECTION","headers","HEADERS","getRoom","broadcast"],"mappings":"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","file":"server.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmory imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmory exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tObject.defineProperty(exports, name, {\n/******/ \t\t\tconfigurable: false,\n/******/ \t\t\tenumerable: true,\n/******/ \t\t\tget: getter\n/******/ \t\t});\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 17);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/forEach\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _isUndefined = __webpack_require__(13);\n\nvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\nvar _isObject = __webpack_require__(5);\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nvar _isFunction = __webpack_require__(12);\n\nvar _isFunction2 = _interopRequireDefault(_isFunction);\n\nvar _values = __webpack_require__(15);\n\nvar _values2 = _interopRequireDefault(_values);\n\nvar _utils = __webpack_require__(3);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Message = function (_EventEmitter) {\n\t_inherits(Message, _EventEmitter);\n\n\t_createClass(Message, null, [{\n\t\tkey: 'parse',\n\t\tvalue: function parse(raw) {\n\t\t\ttry {\n\t\t\t\tvar data = JSON.parse(raw);\n\t\t\t\treturn new Message({\n\t\t\t\t\tname: data.n,\n\t\t\t\t\tpayload: data.p,\n\t\t\t\t\terr: data.e,\n\t\t\t\t\tid: data.i\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tthrow new Error('Could not parse message.');\n\t\t\t}\n\t\t}\n\t}]);\n\n\tfunction Message(_ref) {\n\t\tvar name = _ref.name,\n\t\t    payload = _ref.payload,\n\t\t    id = _ref.id,\n\t\t    err = _ref.err;\n\n\t\t_classCallCheck(this, Message);\n\n\t\tvar _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\n\t\t_this.name = name;\n\t\t_this.payload = payload;\n\t\t_this.id = id;\n\t\t_this.err = err;\n\n\t\t_this.isResponded_ = false;\n\t\treturn _this;\n\t}\n\n\t_createClass(Message, [{\n\t\tkey: 'setId',\n\t\tvalue: function setId() {\n\t\t\tvar id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (0, _utils.generateDummyId)();\n\n\t\t\tthis.id = id;\n\t\t\treturn id;\n\t\t}\n\t}, {\n\t\tkey: 'createResponse',\n\t\tvalue: function createResponse(err, payload) {\n\t\t\treturn new Message({ name: '_r', payload: payload, err: err, id: this.id });\n\t\t}\n\t}, {\n\t\tkey: 'resolve',\n\t\tvalue: function resolve(payload) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\n\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n\t\t\t// If thenable\n\t\t\tif ((0, _isObject2.default)(payload) && (0, _isFunction2.default)(payload.then)) {\n\t\t\t\tpayload.then(function (response) {\n\t\t\t\t\t_this2.isResponded_ = true;\n\t\t\t\t\t_this2.emit('resolved', payload);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t_this2.isResponded_ = true;\n\t\t\t\t\t_this2.emit('rejected', err);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isResponded_ = true;\n\t\t\tthis.emit('resolved', payload);\n\t\t}\n\t}, {\n\t\tkey: 'reject',\n\t\tvalue: function reject(err) {\n\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\n\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n\t\t\tthis.isResponded_ = true;\n\t\t\tthis.emit('rejected', err);\n\t\t}\n\t}, {\n\t\tkey: 'toString',\n\t\tvalue: function toString() {\n\t\t\ttry {\n\t\t\t\tvar data = { n: this.name };\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\n\t\t\t\treturn JSON.stringify(data);\n\t\t\t} catch (err) {\n\t\t\t\tthrow new Error('Could not stringify message.');\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'dispose',\n\t\tvalue: function dispose() {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar events = this.eventNames();\n\t\t\tevents.forEach(function (event) {\n\t\t\t\treturn _this3.removeAllListeners(event);\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Message;\n}(_commonjs2.default);\n\nexports.default = Message;\n\n\nMessage.Names = {\n\tRESPONSE: '_r',\n\tHANDSHAKE: '_h',\n\tPING: '_p'\n};\n\nMessage.ReservedNames = (0, _values2.default)(Message.Names);\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\"use strict\";\n\nvar _assign = __webpack_require__(4);\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction promiseDelay(ms) {\n\treturn new Promise(function (resolve) {\n\t\treturn setTimeout(function (_) {\n\t\t\treturn resolve();\n\t\t}, ms);\n\t});\n}\n\nfunction retry(task) {\n\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\tvar defaults = { maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2 };\n\toptions = (0, _assign2.default)(defaults, options);\n\tvar timeout = void 0;\n\tvar counter = 1;\n\tvar delay = options.initialDelay;\n\n\tvar once = function once() {\n\t\treturn task().catch(function (err) {\n\t\t\tcounter++;\n\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn promiseDelay(delay * 1000 / 2).then(function (_) {\n\t\t\t\treturn once();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn once();\n}\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId() {\n\tvar length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4;\n\n\treturn (\"0000\" + (Math.random() * Math.pow(36, length) << 0).toString(36)).slice(-length);\n}\n\nmodule.exports = { promiseDelay: promiseDelay, retry: retry, generateDummyId: generateDummyId };\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isObject\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _message = __webpack_require__(2);\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nvar _assign = __webpack_require__(4);\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _isObject = __webpack_require__(5);\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nvar _deferred = __webpack_require__(9);\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _nodeUuid = __webpack_require__(16);\n\nvar uuid = _interopRequireWildcard(_nodeUuid);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Connection = function (_EventEmitter) {\n\t_inherits(Connection, _EventEmitter);\n\n\tfunction Connection(socket, server) {\n\t\t_classCallCheck(this, Connection);\n\n\t\tvar _this = _possibleConstructorReturn(this, (Connection.__proto__ || Object.getPrototypeOf(Connection)).call(this));\n\n\t\t_this.id = uuid.v4();\n\n\t\t_this.socket = socket;\n\t\t_this.server = server;\n\n\t\t_this.deferreds_ = {};\n\t\t_this.socket.on('message', _this.onMessage_.bind(_this));\n\t\t_this.socket.on('error', _this.onError_.bind(_this));\n\t\t_this.socket.on('close', _this.onClose_.bind(_this));\n\t\treturn _this;\n\t}\n\n\t_createClass(Connection, [{\n\t\tkey: 'onMessage_',\n\t\tvalue: function onMessage_(data, flags) {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar message = _message2.default.parse(data);\n\n\t\t\t// Emit original _message event with raw data\n\t\t\tthis.emit(Connection.Events.MESSAGE, data);\n\n\t\t\t// Message without response (no id fields)\n\t\t\tif (!message.id && _message2.default.ReservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\n\t\t\t// Handshake\n\t\t\tif (message.name == _message2.default.Names.HANDSHAKE) {\n\t\t\t\treturn this.onHandshake_(message);\n\t\t\t}\n\n\t\t\t// Ping\n\t\t\tif (message.name == _message2.default.Names.PING) {\n\t\t\t\treturn this.onPing_(message);\n\t\t\t}\n\n\t\t\t// Message response\n\t\t\tif (message.name == _message2.default.Names.RESPONSE && this.deferreds_[message.id]) {\n\t\t\t\treturn this.onResponse_(message);\n\t\t\t}\n\n\t\t\t// Message with response\n\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\t_this2.send_(message.createResponse(null, payload));\n\t\t\t\tmessage.dispose();\n\t\t\t});\n\n\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\tif ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\t\t\t\t_this2.send_(message.createResponse(err));\n\t\t\t\tmessage.dispose();\n\t\t\t});\n\n\t\t\tthis.emit(message.name, message);\n\t\t}\n\t}, {\n\t\tkey: 'onHandshake_',\n\t\tvalue: function onHandshake_(message) {\n\t\t\tvar _this3 = this;\n\n\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\tvar responsePayload = {\n\t\t\t\t\thandshakePayload: payload,\n\t\t\t\t\tid: _this3.id,\n\t\t\t\t\ttimeout: _this3.server.options.timeout,\n\t\t\t\t\tmaxReconnectDelay: _this3.server.options.maxReconnectDelay,\n\t\t\t\t\tinitialReconnectDelay: _this3.server.options.initialReconnectDelay,\n\t\t\t\t\treconnectIncrementFactor: _this3.server.options.reconnectIncrementFactor\n\t\t\t\t};\n\n\t\t\t\t_this3.send_(message.createResponse(null, responsePayload)).then(function () {\n\t\t\t\t\t_this3.joinRoom('/');\n\t\t\t\t\t_this3.emit(Connection.Events.HANDSHAKE_OK);\n\t\t\t\t}).catch(function () {\n\t\t\t\t\tconsole.log('Handshake resolve response failed to send for ' + _this3.id + '.');\n\t\t\t\t\t_this3.onClose_(500, err);\n\t\t\t\t}).then(function () {\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\tif ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\n\t\t\t\t_this3.send_(message.createResponse(err)).catch(function (err_) {\n\t\t\t\t\tconsole.log('Handshake reject response failed to send for ' + _this3.id + '.');\n\t\t\t\t}).then(function () {\n\t\t\t\t\t_this3.onClose_(500, err);\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Sorry for party rocking\n\t\t\tvar handshakeResponse = this.server.emit('handshake', this, message);\n\n\t\t\tif (!handshakeResponse) message.resolve();\n\t\t}\n\t}, {\n\t\tkey: 'onResponse_',\n\t\tvalue: function onResponse_(message) {\n\t\t\tvar deferred = this.deferreds_[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tvar _err = (0, _assign2.default)(new Error(), message.err);\n\t\t\t\tdeferred.reject(_err);\n\t\t\t} else {\n\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.deferreds_[message.id];\n\t\t}\n\t}, {\n\t\tkey: 'onPing_',\n\t\tvalue: function onPing_(message) {\n\t\t\tvar _this4 = this;\n\n\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\treturn _this4.send_(message.createResponse(null, 'pong'));\n\t\t\t}, { maxCount: 3, initialDelay: 1, increaseFactor: 1 }).catch(function (err) {\n\t\t\t\tconsole.log('Ping responce failed to send', err);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'onError_',\n\t\tvalue: function onError_(err) {\n\t\t\tthis.emit(Connection.Events.ERROR, err);\n\t\t}\n\t}, {\n\t\tkey: 'onClose_',\n\t\tvalue: function onClose_(code, message) {\n\t\t\tthis.server.rooms.removeFromAll(this);\n\n\t\t\t(0, _forEach2.default)(this.deferreds_, function (deferred) {\n\t\t\t\tdeferred.reject(new Error('Socket connection closed!'));\n\t\t\t});\n\t\t\tthis.deferreds_ = {};\n\n\t\t\tthis.emit(Connection.Events.CLOSE, code, message);\n\t\t}\n\t}, {\n\t\tkey: 'joinRoom',\n\t\tvalue: function joinRoom(roomName) {\n\t\t\tthis.server.rooms.add(roomName, this);\n\t\t}\n\t}, {\n\t\tkey: 'leaveRoom',\n\t\tvalue: function leaveRoom(roomName) {\n\t\t\tthis.server.rooms.remove(roomName, this);\n\t\t}\n\t}, {\n\t\tkey: 'getRooms',\n\t\tvalue: function getRooms() {\n\t\t\tthis.server.rooms.getRoomsOf(this);\n\t\t}\n\t}, {\n\t\tkey: 'send',\n\t\tvalue: function send(eventName, payload) {\n\t\t\tvar _this5 = this;\n\n\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\tmessage.setId();\n\n\t\t\treturn this.send_(message).then(function (_) {\n\t\t\t\tvar deferred = _this5.deferreds_[message.id] = new _deferred2.default({\n\t\t\t\t\tonExpire: function onExpire() {\n\t\t\t\t\t\tdelete _this5.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: _this5.server.options.timeout\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'sendWithoutResponse',\n\t\tvalue: function sendWithoutResponse(eventName, payload) {\n\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\treturn this.send_(message);\n\t\t}\n\t}, {\n\t\tkey: 'send_',\n\t\tvalue: function send_(message) {\n\t\t\tvar _this6 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this6.socket.send(message.toString(), function (err) {\n\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Connection;\n}(_commonjs2.default);\n\nConnection.Events = {\n\tMESSAGE: '_message',\n\tHANDSHAKE_OK: '_handshakeOk', // Private\n\tERROR: '_error',\n\tCLOSE: '_close'\n};\n\nmodule.exports = Connection;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _filter = __webpack_require__(11);\n\nvar _filter2 = _interopRequireDefault(_filter);\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _map = __webpack_require__(14);\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _room = __webpack_require__(10);\n\nvar _room2 = _interopRequireDefault(_room);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Rooms = function () {\n\tfunction Rooms() {\n\t\t_classCallCheck(this, Rooms);\n\n\t\tthis.rooms = { '/': new _room2.default('/') };\n\t}\n\n\t_createClass(Rooms, [{\n\t\tkey: 'add',\n\t\tvalue: function add(roomName, connection) {\n\t\t\tif (!this.rooms[roomName]) this.rooms[roomName] = new _room2.default(roomName);\n\n\t\t\tthis.rooms[roomName].add(connection);\n\t\t}\n\t}, {\n\t\tkey: 'remove',\n\t\tvalue: function remove(roomName, connection) {\n\t\t\tif (!this.rooms[roomName]) return;\n\n\t\t\tthis.rooms[roomName].remove(connection);\n\n\t\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount()) delete this.rooms[roomName];\n\t\t}\n\t}, {\n\t\tkey: 'getRoomsOf',\n\t\tvalue: function getRoomsOf(connection) {\n\t\t\treturn (0, _map2.default)((0, _filter2.default)(this.rooms, function (room) {\n\t\t\t\treturn room.getConnectionById(connection.id);\n\t\t\t}), 'name');\n\t\t}\n\t}, {\n\t\tkey: 'getRoom',\n\t\tvalue: function getRoom(room) {\n\t\t\treturn this.rooms[room];\n\t\t}\n\t}, {\n\t\tkey: 'removeFromAll',\n\t\tvalue: function removeFromAll(connection) {\n\t\t\tvar _this = this;\n\n\t\t\tvar rooms = this.getRoomsOf(connection);\n\t\t\t(0, _forEach2.default)(rooms, function (roomName) {\n\t\t\t\treturn _this.rooms[roomName].remove(connection);\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Rooms;\n}();\n\nexports.default = Rooms;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"uws\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Deferred = function () {\n    function Deferred() {\n        var _this = this;\n\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            _ref$handler = _ref.handler,\n            handler = _ref$handler === undefined ? function () {} : _ref$handler,\n            _ref$onExpire = _ref.onExpire,\n            onExpire = _ref$onExpire === undefined ? function () {} : _ref$onExpire,\n            _ref$timeout = _ref.timeout,\n            timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\n        _classCallCheck(this, Deferred);\n\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise(function (resolve, reject) {\n            _this.resolve_ = resolve;\n            _this.reject_ = reject;\n\n            try {\n                handler(_this);\n            } catch (err) {\n                _this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n    _createClass(Deferred, [{\n        key: 'resolve',\n        value: function resolve(data) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.resolve_(data);\n        }\n    }, {\n        key: 'reject',\n        value: function reject(err) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.reject_(err);\n        }\n    }, {\n        key: 'expire',\n        value: function expire() {\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.onExpire_();\n            this.reject_(new Error('Timeout exceed'));\n        }\n    }, {\n        key: 'then',\n        value: function then() {\n            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                args[_key] = arguments[_key];\n            }\n\n            return this.promise.then.apply(this.promise, args);\n        }\n    }, {\n        key: 'catch',\n        value: function _catch() {\n            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                args[_key2] = arguments[_key2];\n            }\n\n            return this.promise.catch.apply(this.promise, args);\n        }\n    }, {\n        key: 'clearTimeout_',\n        value: function clearTimeout_() {\n            if (this.timeout_) {\n                clearTimeout(this.timeout_);\n                this.timeout_ = null;\n            }\n        }\n    }]);\n\n    return Deferred;\n}();\n\nmodule.exports = Deferred;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _message = __webpack_require__(2);\n\nvar _message2 = _interopRequireDefault(_message);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Room = function () {\n\tfunction Room(name) {\n\t\tvar connections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\t_classCallCheck(this, Room);\n\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\t_createClass(Room, [{\n\t\tkey: 'add',\n\t\tvalue: function add(connection) {\n\t\t\tthis.connections[connection.id] = connection;\n\t\t}\n\t}, {\n\t\tkey: 'remove',\n\t\tvalue: function remove(connection) {\n\t\t\tdelete this.connections[connection.id];\n\t\t}\n\t}, {\n\t\tkey: 'getConnectionById',\n\t\tvalue: function getConnectionById(connectionId) {\n\t\t\treturn this.connections[connectionId];\n\t\t}\n\t}, {\n\t\tkey: 'getConnectionsCount',\n\t\tvalue: function getConnectionsCount() {\n\t\t\treturn Object.keys(this.connections).length;\n\t\t}\n\t}, {\n\t\tkey: 'broadcast_',\n\t\tvalue: function broadcast_(message) {\n\t\t\t(0, _forEach2.default)(this.connections, function (connection) {\n\t\t\t\tconnection.send_(message);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'broadcast',\n\t\tvalue: function broadcast(eventName, payload) {\n\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t(0, _forEach2.default)(this.connections, function (connection, index) {\n\t\t\t\tconnection.send_(message);\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Room;\n}();\n\nexports.default = Room;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/filter\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isFunction\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/map\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/values\");\n\n/***/ },\n/* 16 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"node-uuid\");\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _uws = __webpack_require__(8);\n\nvar _connection = __webpack_require__(6);\n\nvar _connection2 = _interopRequireDefault(_connection);\n\nvar _rooms = __webpack_require__(7);\n\nvar _rooms2 = _interopRequireDefault(_rooms);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Server = function (_EventEmitter) {\n\t_inherits(Server, _EventEmitter);\n\n\tfunction Server(options) {\n\t\t_classCallCheck(this, Server);\n\n\t\tvar _this = _possibleConstructorReturn(this, (Server.__proto__ || Object.getPrototypeOf(Server)).call(this));\n\n\t\t_this.rooms = new _rooms2.default();\n\n\t\t_this.options = Object.assign({\n\t\t\ttimeout: 30000,\n\t\t\tmaxReconnectDelay: 60,\n\t\t\tinitialReconnectDelay: 1,\n\t\t\treconnectIncrementFactor: 1\n\t\t}, options || {});\n\t\treturn _this;\n\t}\n\n\t_createClass(Server, [{\n\t\tkey: 'start',\n\t\tvalue: function start() {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (!this.options.port) {\n\t\t\t\tthis.server = new _uws.Server(this.options);\n\t\t\t\tthis.bindEvents();\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this2.server = new _uws.Server(_this2.options, function (err) {\n\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t_this2.bindEvents();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'stop',\n\t\tvalue: function stop() {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (!this.server) {\n\t\t\t\tvar err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}\n\n\t\t\treturn new Promise(function (resolve) {\n\t\t\t\t_this3.server.close();\n\t\t\t\t_this3.server = null;\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'bindEvents',\n\t\tvalue: function bindEvents() {\n\t\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t\t\tthis.server.on('headers', this.onHeaders.bind(this));\n\t\t\tthis.server.on('error', this.onError.bind(this));\n\t\t}\n\t}, {\n\t\tkey: 'onConnection',\n\t\tvalue: function onConnection(socket) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar connection = new _connection2.default(socket, this);\n\t\t\tconnection.on(_connection2.default.Events.HANDSHAKE_OK, function () {\n\t\t\t\treturn _this4.emit(Server.Events.CONNECTION, connection);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'onHeaders',\n\t\tvalue: function onHeaders(headers) {\n\t\t\tthis.emit(Server.Events.HEADERS, headers);\n\t\t}\n\t}, {\n\t\tkey: 'onError',\n\t\tvalue: function onError(err) {\n\t\t\tthis.emit(Server.Events.ERROR, err);\n\t\t}\n\t}, {\n\t\tkey: 'getConnectionById',\n\t\tvalue: function getConnectionById(id) {\n\t\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t\t}\n\t}, {\n\t\tkey: 'broadcast',\n\t\tvalue: function broadcast(eventName, payload) {\n\t\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t\t}\n\t}]);\n\n\treturn Server;\n}(_commonjs2.default);\n\nServer.Events = {\n\tCONNECTION: 'connection',\n\tHANDSHAKE: 'handshake',\n\tHEADERS: 'headers',\n\tERROR: 'error'\n};\n\nmodule.exports = Server;\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 17);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 134b96fe478dfdcfe77b","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 1\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport values from 'lodash/values';\nimport {generateDummyId} from './utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = generateDummyId()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\t// If thenable\n\t\tif (isObject(payload) && isFunction(payload.then)) {\n\t\t\tpayload\n\t\t\t\t.then(response => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('resolved', payload);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('rejected', err);\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\n\nMessage.Names = {\n\tRESPONSE: '_r',\n\tHANDSHAKE: '_h',\n\tPING: '_p'\n};\n\n\nMessage.ReservedNames = values(Message.Names);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId(length = 4) {\n\treturn (\"0000\" + (Math.random()*Math.pow(36,length) << 0).toString(36)).slice(-length);\n}\n\n\nmodule.exports = {promiseDelay, retry, generateDummyId};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 5\n// module chunks = 0","import Utils from '../lib/utils';\nimport Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport Deferred from '../lib/deferred';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.deferreds_ = {};\n\t\tthis.socket.on('message', this.onMessage_.bind(this));\n\t\tthis.socket.on('error', this.onError_.bind(this));\n\t\tthis.socket.on('close', this.onClose_.bind(this));\n\t}\n\n\n\tonMessage_(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\t// Emit original _message event with raw data\n\t\tthis.emit(Connection.Events.MESSAGE, data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.ReservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Handshake\n\t\tif (message.name == Message.Names.HANDSHAKE) {\n\t\t\treturn this.onHandshake_(message);\n\t\t}\n\n\t\t// Ping\n\t\tif (message.name == Message.Names.PING) {\n\t\t\treturn this.onPing_(message);\n\t\t}\n\n\t\t// Message response\n\t\tif (message.name == Message.Names.RESPONSE && this.deferreds_[message.id]) {\n\t\t\treturn this.onResponse_(message);\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tonHandshake_(message) {\n\t\tmessage.once('resolved', payload => {\n\t\t\tconst responsePayload = {\n\t\t\t\thandshakePayload: payload,\n\t\t\t\tid: this.id,\n\t\t\t\ttimeout: this.server.options.timeout,\n\t\t\t\tmaxReconnectDelay: this.server.options.maxReconnectDelay,\n\t\t\t\tinitialReconnectDelay: this.server.options.initialReconnectDelay,\n\t\t\t\treconnectIncrementFactor: this.server.options.reconnectIncrementFactor\n\t\t\t};\n\n\t\t\tthis\n\t\t\t\t.send_(message.createResponse(null, responsePayload))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.joinRoom('/');\n\t\t\t\t\tthis.emit(Connection.Events.HANDSHAKE_OK);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tconsole.log(`Handshake resolve response failed to send for ${this.id}.`);\n\t\t\t\t\tthis.onClose_(500, err);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\n\t\t\tthis\n\t\t\t\t.send_(message.createResponse(err))\n\t\t\t\t.catch(err_ => {\n\t\t\t\t\tconsole.log(`Handshake reject response failed to send for ${this.id}.`);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.onClose_(500, err);\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\t});\n\n\t\t// Sorry for party rocking\n\t\tconst handshakeResponse = this.server.emit('handshake', this, message);\n\n\t\tif (!handshakeResponse)\n\t\t\tmessage.resolve();\n\t}\n\n\n\tonResponse_(message) {\n\t\tconst deferred = this.deferreds_[message.id];\n\n\t\tif (message.err) {\n\t\t\tconst err = assign(new Error(), message.err);\n\t\t\tdeferred.reject(err);\n\t\t} else {\n\t\t\tdeferred.resolve(message.payload);\n\t\t}\n\n\t\tdelete this.deferreds_[message.id];\n\t}\n\n\n\tonPing_(message) {\n\n\t\tUtils\n\t\t\t.retry(_ => this.send_(message.createResponse(null, 'pong')), {maxCount: 3, initialDelay: 1, increaseFactor: 1})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Ping responce failed to send', err);\n\t\t\t})\n\t}\n\n\n\tonError_(err) {\n\t\tthis.emit(Connection.Events.ERROR, err);\n\t}\n\n\n\tonClose_(code, message) {\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\tforEach(this.deferreds_, (deferred) => {\n\t\t\tdeferred.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.deferreds_ = {};\n\n\t\tthis.emit(Connection.Events.CLOSE, code, message);\n\t}\n\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tmessage.setId();\n\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\tconst deferred = this.deferreds_[message.id] = new Deferred({\n\t\t\t\t\tonExpire: () => {\n\t\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: this.server.options.timeout\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\nConnection.Events = {\n\tMESSAGE: '_message',\n\tHANDSHAKE_OK: '_handshakeOk', // Private\n\tERROR: '_error',\n\tCLOSE: '_close'\n};\n\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\tforEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 8\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\tforEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tforEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"lodash/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/values\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 16\n// module chunks = 0","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\tthis.rooms = new Rooms();\n\n\t\tthis.options = Object.assign({\n\t\t\ttimeout: 30000,\n\t\t\tmaxReconnectDelay: 60,\n\t\t\tinitialReconnectDelay: 1,\n\t\t\treconnectIncrementFactor: 1\n\t\t}, options || {});\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\n\tstop() {\n\t\tif (!this.server) {\n\t\t\tconst err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.server.close();\n\t\t\tthis.server = null;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t\tthis.server.on('headers', this.onHeaders.bind(this));\n\t\tthis.server.on('error', this.onError.bind(this));\n\t}\n\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tconnection.on(Connection.Events.HANDSHAKE_OK, () => this.emit(Server.Events.CONNECTION, connection));\n\t}\n\n\n\tonHeaders(headers) {\n\t\tthis.emit(Server.Events.HEADERS, headers);\n\t}\n\n\n\tonError(err) {\n\t\tthis.emit(Server.Events.ERROR, err);\n\t}\n\n\n\tgetConnectionById(id) {\n\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t}\n\n\n\tbroadcast(eventName, payload) {\n\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t}\n}\n\n\nServer.Events = {\n\tCONNECTION: 'connection',\n\tHANDSHAKE: 'handshake',\n\tHEADERS: 'headers',\n\tERROR: 'error'\n};\n\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js"],"sourceRoot":""}