{"version":3,"sources":["webpack:///webpack/bootstrap c07fe16fa4b1b5158476","webpack:///./src/server/server.js","webpack:///external \"uws\"","webpack:///./src/server/connection.js","webpack:///./src/lib/message.js","webpack:///external \"lodash\"","webpack:///external \"node-uuid\"","webpack:///external \"event-emitter-extra\"","webpack:///./src/server/rooms.js","webpack:///./src/server/room.js"],"names":["Server","options","rooms","port","server","bindEvents","Promise","resolve","reject","err","on","onConnection","bind","socket","connection","emit","module","exports","_","uuid","Connection","id","v4","promiseCallbacks","onMessage","onError","onClose","joinRoom","data","flags","message","parse","reservedNames","indexOf","name","assign","Error","payload","once","send_","createResponse","dispose","isObject","error","code","removeFromAll","forEach","callbacks","roomName","add","remove","getRoomsOf","eventName","messageId","setId","then","send","toString","Message","raw","JSON","n","p","e","i","isResponded_","isUndefined","console","warn","stringify","events","eventNames","removeAllListeners","event","Rooms","getConnectionsCount","map","filter","room","getConnectionById","Room","connections","connectionId","Object","keys","length","index"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c07fe16fa4b1b5158476","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\t\tthis.rooms = new Rooms();\n\t\tthis.options = options;\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t}\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tthis.emit('connection', connection);\n\t}\n}\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 1\n// module chunks = 0","import Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra';\nimport * as _ from 'lodash';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.promiseCallbacks = {};\n\t\tthis.socket.on('message', this.onMessage.bind(this));\n\t\tthis.socket.on('error', this.onError.bind(this));\n\t\tthis.socket.on('close', this.onClose.bind(this));\n\n\t\tthis.joinRoom('/');\n\t}\n\n\n\tonMessage(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Message response\n\t\tif (message.name == '_r') {\n\t\t\tconst {resolve, reject} = this.promiseCallbacks[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = _.assign(new Error(), message.err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks[message.options.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\tonError(error) {\n\t\tthis.emit('_error', error);\n\t}\n\n\tonClose(code, message) {\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\t_.forEach(this.promiseCallbacks, (callbacks) => {\n\t\t\tcallbacks.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.promiseCallbacks = {};\n\n\t\tthis.emit('_close', code, message);\n\t}\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.promiseCallbacks[messageId] = {resolve, reject};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import * as _ from 'lodash';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (_.isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (_.isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!_.isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!_.isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!_.isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"event-emitter-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra\"\n// module id = 6\n// module chunks = 0","import * as _ from 'lodash';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection.id);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn _.map(_.filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\t_.forEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","import * as _ from 'lodash';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\t_.forEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\t_.forEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js"],"sourceRoot":""}