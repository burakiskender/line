{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap 35a53faf49cd975de8d9","webpack:///./src/server/server.js","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///external \"lodash/forEach\"","webpack:///./src/lib/message.js","webpack:///external \"lodash/assign\"","webpack:///external \"node-uuid\"","webpack:///./src/lib/deferred.js","webpack:///./src/lib/utils.js","webpack:///./src/server/connection.js","webpack:///./src/server/room.js","webpack:///./src/server/rooms.js","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/isObject\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/map\"","webpack:///external \"uws\""],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","_uws","_connection","_connection2","_rooms","_rooms2","_commonjs","_commonjs2","Server","_EventEmitter","options","this","_this","getPrototypeOf","rooms","assign","timeout","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","_this2","port","Promise","resolve","reject","server","err","bindEvents","_this3","Error","close","on","onConnection","bind","socket","_this4","connection","emit","getRoom","getConnectionById","eventName","payload","broadcast","Events","CONNECTION","HEADERS","ERROR","require","_interopRequireWildcard","newObj","hasOwnProperty","_isUndefined","_isUndefined2","_nodeUuid","uuid","Message","_ref","name","isResponded_","raw","data","JSON","parse","n","e","arguments","undefined","v4","console","warn","stringify","events","eventNames","forEach","event","removeAllListeners","reservedNames","Deferred","_ref$handler","handler","_ref$onExpire","onExpire","_ref$timeout","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","setTimeout","expire","clearTimeout_","_len","args","Array","_key","then","apply","_len2","_key2","catch","clearTimeout","promiseDelay","ms","_","retry","task","defaults","maxDelay","maxCount","initialDelay","increaseFactor","_assign2","counter","delay","once","_assign","_utils","_utils2","_message","_message2","_forEach","_forEach2","_isObject","_isObject2","_deferred","_deferred2","Connection","deferreds_","onMessage","onError","onClose","handshake_","flags","message","indexOf","responsePayload","send_","createResponse","joinRoom","log","deferred","dispose","error","code","removeFromAll","roomName","add","remove","getRoomsOf","setId","send","toString","Room","connections","connectionId","keys","index","_filter","_filter2","_map","_map2","_room","_room2","Rooms","/","getConnectionsCount","room"],"mappings":"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","file":"server.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _uws = __webpack_require__(15);\n\t\n\tvar _connection = __webpack_require__(8);\n\t\n\tvar _connection2 = _interopRequireDefault(_connection);\n\t\n\tvar _rooms = __webpack_require__(10);\n\t\n\tvar _rooms2 = _interopRequireDefault(_rooms);\n\t\n\tvar _commonjs = __webpack_require__(1);\n\t\n\tvar _commonjs2 = _interopRequireDefault(_commonjs);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Server = function (_EventEmitter) {\n\t\t_inherits(Server, _EventEmitter);\n\t\n\t\tfunction Server(options) {\n\t\t\t_classCallCheck(this, Server);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Server.__proto__ || Object.getPrototypeOf(Server)).call(this));\n\t\n\t\t\t_this.rooms = new _rooms2.default();\n\t\n\t\t\t_this.options = Object.assign({\n\t\t\t\ttimeout: 30000,\n\t\t\t\tmaxReconnectDelay: 60,\n\t\t\t\tinitialReconnectDelay: 1,\n\t\t\t\treconnectIncrementFactor: 1\n\t\t\t}, options || {});\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Server, [{\n\t\t\tkey: 'start',\n\t\t\tvalue: function start() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tif (!this.options.port) {\n\t\t\t\t\tthis.server = new _uws.Server(this.options);\n\t\t\t\t\tthis.bindEvents();\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this2.server = new _uws.Server(_this2.options, function (err) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t\t_this2.bindEvents();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'stop',\n\t\t\tvalue: function stop() {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tif (!this.server) {\n\t\t\t\t\tvar err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\n\t\t\t\treturn new Promise(function (resolve) {\n\t\t\t\t\t_this3.server.close();\n\t\t\t\t\t_this3.server = null;\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'bindEvents',\n\t\t\tvalue: function bindEvents() {\n\t\t\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onConnection',\n\t\t\tvalue: function onConnection(socket) {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\tvar connection = new _connection2.default(socket, this);\n\t\t\t\tconnection.on('_handshakeOk', function () {\n\t\t\t\t\treturn _this4.emit('connection', connection);\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getConnectionById',\n\t\t\tvalue: function getConnectionById(id) {\n\t\t\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'broadcast',\n\t\t\tvalue: function broadcast(eventName, payload) {\n\t\t\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Server;\n\t}(_commonjs2.default);\n\t\n\tServer.Events = {\n\t\tCONNECTION: 'connection',\n\t\tHEADERS: 'headers',\n\t\tERROR: 'error'\n\t};\n\t\n\tmodule.exports = Server;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/forEach\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _isUndefined = __webpack_require__(13);\n\t\n\tvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\t\n\tvar _nodeUuid = __webpack_require__(5);\n\t\n\tvar uuid = _interopRequireWildcard(_nodeUuid);\n\t\n\tvar _commonjs = __webpack_require__(1);\n\t\n\tvar _commonjs2 = _interopRequireDefault(_commonjs);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Message = function (_EventEmitter) {\n\t\t_inherits(Message, _EventEmitter);\n\t\n\t\t_createClass(Message, null, [{\n\t\t\tkey: 'parse',\n\t\t\tvalue: function parse(raw) {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = JSON.parse(raw);\n\t\t\t\t\treturn new Message({\n\t\t\t\t\t\tname: data.n,\n\t\t\t\t\t\tpayload: data.p,\n\t\t\t\t\t\terr: data.e,\n\t\t\t\t\t\tid: data.i\n\t\t\t\t\t});\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not parse message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}]);\n\t\n\t\tfunction Message(_ref) {\n\t\t\tvar name = _ref.name,\n\t\t\t    payload = _ref.payload,\n\t\t\t    id = _ref.id,\n\t\t\t    err = _ref.err;\n\t\n\t\t\t_classCallCheck(this, Message);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\t\n\t\t\t_this.name = name;\n\t\t\t_this.payload = payload;\n\t\t\t_this.id = id;\n\t\t\t_this.err = err;\n\t\n\t\t\t_this.isResponded_ = false;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Message, [{\n\t\t\tkey: 'setId',\n\t\t\tvalue: function setId() {\n\t\t\t\tvar id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : uuid.v4();\n\t\n\t\t\t\tthis.id = id;\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'createResponse',\n\t\t\tvalue: function createResponse(err, payload) {\n\t\t\t\treturn new Message({ name: '_r', payload: payload, err: err, id: this.id });\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'resolve',\n\t\t\tvalue: function resolve(payload) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('resolved', payload);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'reject',\n\t\t\tvalue: function reject(err) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('rejected', err);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'toString',\n\t\t\tvalue: function toString() {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = { n: this.name };\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\t\n\t\t\t\t\treturn JSON.stringify(data);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not stringify message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'dispose',\n\t\t\tvalue: function dispose() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar events = this.eventNames();\n\t\t\t\tevents.forEach(function (event) {\n\t\t\t\t\treturn _this2.removeAllListeners(event);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Message;\n\t}(_commonjs2.default);\n\t\n\texports.default = Message;\n\t\n\t\n\tMessage.reservedNames = ['_r', '_h'];\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"node-uuid\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Deferred = function () {\n\t    function Deferred() {\n\t        var _this = this;\n\t\n\t        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n\t            _ref$handler = _ref.handler,\n\t            handler = _ref$handler === undefined ? function () {} : _ref$handler,\n\t            _ref$onExpire = _ref.onExpire,\n\t            onExpire = _ref$onExpire === undefined ? function () {} : _ref$onExpire,\n\t            _ref$timeout = _ref.timeout,\n\t            timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\t\n\t        _classCallCheck(this, Deferred);\n\t\n\t        this.resolve_ = null;\n\t        this.reject_ = null;\n\t\n\t        this.timeout_ = null;\n\t        this.onExpire_ = onExpire;\n\t        this.isFinished_ = false;\n\t\n\t        this.promise = new Promise(function (resolve, reject) {\n\t            _this.resolve_ = resolve;\n\t            _this.reject_ = reject;\n\t\n\t            try {\n\t                handler(_this);\n\t            } catch (err) {\n\t                _this.reject(err);\n\t            }\n\t        });\n\t\n\t        if (timeout > 0) {\n\t            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n\t        }\n\t    }\n\t\n\t    _createClass(Deferred, [{\n\t        key: 'resolve',\n\t        value: function resolve(data) {\n\t            if (this.isFinished_) return;\n\t\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.resolve_(data);\n\t        }\n\t    }, {\n\t        key: 'reject',\n\t        value: function reject(err) {\n\t            if (this.isFinished_) return;\n\t\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.reject_(err);\n\t        }\n\t    }, {\n\t        key: 'expire',\n\t        value: function expire() {\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.onExpire_();\n\t            this.reject_(new Error('Timeout exceed'));\n\t        }\n\t    }, {\n\t        key: 'then',\n\t        value: function then() {\n\t            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t                args[_key] = arguments[_key];\n\t            }\n\t\n\t            return this.promise.then.apply(this.promise, args);\n\t        }\n\t    }, {\n\t        key: 'catch',\n\t        value: function _catch() {\n\t            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t                args[_key2] = arguments[_key2];\n\t            }\n\t\n\t            return this.promise.catch.apply(this.promise, args);\n\t        }\n\t    }, {\n\t        key: 'clearTimeout_',\n\t        value: function clearTimeout_() {\n\t            if (this.timeout_) {\n\t                clearTimeout(this.timeout_);\n\t                this.timeout_ = null;\n\t            }\n\t        }\n\t    }]);\n\t\n\t    return Deferred;\n\t}();\n\t\n\tmodule.exports = Deferred;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _assign = __webpack_require__(4);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction promiseDelay(ms) {\n\t\treturn new Promise(function (resolve) {\n\t\t\treturn setTimeout(function (_) {\n\t\t\t\treturn resolve();\n\t\t\t}, ms);\n\t\t});\n\t}\n\t\n\tfunction retry(task) {\n\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t\tvar defaults = { maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2 };\n\t\toptions = (0, _assign2.default)(defaults, options);\n\t\tvar timeout = void 0;\n\t\tvar counter = 1;\n\t\tvar delay = options.initialDelay;\n\t\n\t\tvar once = function once() {\n\t\t\treturn task().catch(function (err) {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\t\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(function (_) {\n\t\t\t\t\treturn once();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\n\t\treturn once();\n\t}\n\t\n\tmodule.exports = { promiseDelay: promiseDelay, retry: retry };\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _utils = __webpack_require__(7);\n\t\n\tvar _utils2 = _interopRequireDefault(_utils);\n\t\n\tvar _message = __webpack_require__(3);\n\t\n\tvar _message2 = _interopRequireDefault(_message);\n\t\n\tvar _commonjs = __webpack_require__(1);\n\t\n\tvar _commonjs2 = _interopRequireDefault(_commonjs);\n\t\n\tvar _assign = __webpack_require__(4);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _isObject = __webpack_require__(12);\n\t\n\tvar _isObject2 = _interopRequireDefault(_isObject);\n\t\n\tvar _deferred = __webpack_require__(6);\n\t\n\tvar _deferred2 = _interopRequireDefault(_deferred);\n\t\n\tvar _nodeUuid = __webpack_require__(5);\n\t\n\tvar uuid = _interopRequireWildcard(_nodeUuid);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Connection = function (_EventEmitter) {\n\t\t_inherits(Connection, _EventEmitter);\n\t\n\t\tfunction Connection(socket, server) {\n\t\t\t_classCallCheck(this, Connection);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Connection.__proto__ || Object.getPrototypeOf(Connection)).call(this));\n\t\n\t\t\t_this.id = uuid.v4();\n\t\n\t\t\t_this.socket = socket;\n\t\t\t_this.server = server;\n\t\n\t\t\t_this.deferreds_ = {};\n\t\t\t_this.socket.on('message', _this.onMessage.bind(_this));\n\t\t\t_this.socket.on('error', _this.onError.bind(_this));\n\t\t\t_this.socket.on('close', _this.onClose.bind(_this));\n\t\n\t\t\t_this.handshake_ = false;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Connection, [{\n\t\t\tkey: 'onMessage',\n\t\t\tvalue: function onMessage(data, flags) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar message = _message2.default.parse(data);\n\t\t\t\t// TODO: Emit original _message event with raw data?\n\t\n\t\t\t\t// Message without response (no id fields)\n\t\t\t\tif (!message.id && _message2.default.reservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\t\n\t\t\t\t// Handshake\n\t\t\t\tif (message.name == '_h') {\n\t\t\t\t\t(function () {\n\t\t\t\t\t\tvar responsePayload = {\n\t\t\t\t\t\t\tid: _this2.id,\n\t\t\t\t\t\t\ttimeout: _this2.server.options.timeout,\n\t\t\t\t\t\t\tmaxReconnectDelay: _this2.server.options.maxReconnectDelay,\n\t\t\t\t\t\t\tinitialReconnectDelay: _this2.server.options.initialReconnectDelay,\n\t\t\t\t\t\t\treconnectIncrementFactor: _this2.server.options.reconnectIncrementFactor\n\t\t\t\t\t\t};\n\t\n\t\t\t\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\t\t\t\treturn _this2.send_(message.createResponse(null, responsePayload));\n\t\t\t\t\t\t}, { maxCount: 3, initialDelay: 1, increaseFactor: 1 }).then(function (_) {\n\t\t\t\t\t\t\t_this2.joinRoom('/');\n\t\t\t\t\t\t\t_this2.handshake_ = true;\n\t\t\t\t\t\t\t_this2.emit('_handshakeOk');\n\t\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\t\t_this2.handshake_ = false;\n\t\t\t\t\t\t\tconsole.log('Handshake failed for ' + _this2.id + '.');\n\t\t\t\t\t\t\t_this2.onClose(500, err);\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\n\t\t\t\t// Message response\n\t\t\t\tif (message.name == '_r' && this.deferreds_[message.id]) {\n\t\t\t\t\tvar deferred = this.deferreds_[message.id];\n\t\n\t\t\t\t\tif (message.err) {\n\t\t\t\t\t\tvar err = (0, _assign2.default)(new Error(), message.err);\n\t\t\t\t\t\tdeferred.reject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t\t\t}\n\t\n\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\t// Message with response\n\t\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\t\t_this2.send_(message.createResponse(null, payload));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\t\tif ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\t\t\t\t\t_this2.send_(message.createResponse(err));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tthis.emit(message.name, message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onError',\n\t\t\tvalue: function onError(error) {\n\t\t\t\tthis.emit('_error', error);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onClose',\n\t\t\tvalue: function onClose(code, message) {\n\t\t\t\tthis.server.rooms.removeFromAll(this);\n\t\n\t\t\t\t(0, _forEach2.default)(this.deferreds_, function (deferred) {\n\t\t\t\t\tdeferred.reject(new Error('Socket connection closed!'));\n\t\t\t\t});\n\t\t\t\tthis.deferreds_ = {};\n\t\n\t\t\t\tthis.emit('_close', code, message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'joinRoom',\n\t\t\tvalue: function joinRoom(roomName) {\n\t\t\t\tthis.server.rooms.add(roomName, this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'leaveRoom',\n\t\t\tvalue: function leaveRoom(roomName) {\n\t\t\t\tthis.server.rooms.remove(roomName, this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRooms',\n\t\t\tvalue: function getRooms() {\n\t\t\t\tthis.server.rooms.getRoomsOf(this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send',\n\t\t\tvalue: function send(eventName, payload) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\tmessage.setId();\n\t\n\t\t\t\treturn this.send_(message).then(function (_) {\n\t\t\t\t\tvar deferred = _this3.deferreds_[message.id] = new _deferred2.default({\n\t\t\t\t\t\tonExpire: function onExpire() {\n\t\t\t\t\t\t\tdelete _this3.deferreds_[message.id];\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttimeout: _this3.server.options.timeout\n\t\t\t\t\t});\n\t\n\t\t\t\t\treturn deferred;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'sendWithoutResponse',\n\t\t\tvalue: function sendWithoutResponse(eventName, payload) {\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\treturn this.send_(message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send_',\n\t\t\tvalue: function send_(message) {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this4.socket.send(message.toString(), function (err) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Connection;\n\t}(_commonjs2.default);\n\t\n\tmodule.exports = Connection;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _message = __webpack_require__(3);\n\t\n\tvar _message2 = _interopRequireDefault(_message);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Room = function () {\n\t\tfunction Room(name) {\n\t\t\tvar connections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t\t\t_classCallCheck(this, Room);\n\t\n\t\t\tthis.name = name;\n\t\t\tthis.connections = connections;\n\t\t}\n\t\n\t\t_createClass(Room, [{\n\t\t\tkey: 'add',\n\t\t\tvalue: function add(connection) {\n\t\t\t\tthis.connections[connection.id] = connection;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remove',\n\t\t\tvalue: function remove(connection) {\n\t\t\t\tdelete this.connections[connection.id];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getConnectionById',\n\t\t\tvalue: function getConnectionById(connectionId) {\n\t\t\t\treturn this.connections[connectionId];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getConnectionsCount',\n\t\t\tvalue: function getConnectionsCount() {\n\t\t\t\treturn Object.keys(this.connections).length;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'broadcast_',\n\t\t\tvalue: function broadcast_(message) {\n\t\t\t\t(0, _forEach2.default)(this.connections, function (connection) {\n\t\t\t\t\tconnection.send_(message);\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'broadcast',\n\t\t\tvalue: function broadcast(eventName, payload) {\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\t(0, _forEach2.default)(this.connections, function (connection, index) {\n\t\t\t\t\tconnection.send_(message);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Room;\n\t}();\n\t\n\texports.default = Room;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _filter = __webpack_require__(11);\n\t\n\tvar _filter2 = _interopRequireDefault(_filter);\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _map = __webpack_require__(14);\n\t\n\tvar _map2 = _interopRequireDefault(_map);\n\t\n\tvar _room = __webpack_require__(9);\n\t\n\tvar _room2 = _interopRequireDefault(_room);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Rooms = function () {\n\t\tfunction Rooms() {\n\t\t\t_classCallCheck(this, Rooms);\n\t\n\t\t\tthis.rooms = { '/': new _room2.default('/') };\n\t\t}\n\t\n\t\t_createClass(Rooms, [{\n\t\t\tkey: 'add',\n\t\t\tvalue: function add(roomName, connection) {\n\t\t\t\tif (!this.rooms[roomName]) this.rooms[roomName] = new _room2.default(roomName);\n\t\n\t\t\t\tthis.rooms[roomName].add(connection);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remove',\n\t\t\tvalue: function remove(roomName, connection) {\n\t\t\t\tif (!this.rooms[roomName]) return;\n\t\n\t\t\t\tthis.rooms[roomName].remove(connection);\n\t\n\t\t\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount()) delete this.rooms[roomName];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRoomsOf',\n\t\t\tvalue: function getRoomsOf(connection) {\n\t\t\t\treturn (0, _map2.default)((0, _filter2.default)(this.rooms, function (room) {\n\t\t\t\t\treturn room.getConnectionById(connection.id);\n\t\t\t\t}), 'name');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRoom',\n\t\t\tvalue: function getRoom(room) {\n\t\t\t\treturn this.rooms[room];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'removeFromAll',\n\t\t\tvalue: function removeFromAll(connection) {\n\t\t\t\tvar _this = this;\n\t\n\t\t\t\tvar rooms = this.getRoomsOf(connection);\n\t\t\t\t(0, _forEach2.default)(rooms, function (roomName) {\n\t\t\t\t\treturn _this.rooms[roomName].remove(connection);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Rooms;\n\t}();\n\t\n\texports.default = Rooms;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/filter\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/isObject\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/map\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"uws\");\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 35a53faf49cd975de8d9","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\tthis.rooms = new Rooms();\n\n\t\tthis.options = Object.assign({\n\t\t\ttimeout: 30000,\n\t\t\tmaxReconnectDelay: 60,\n\t\t\tinitialReconnectDelay: 1,\n\t\t\treconnectIncrementFactor: 1\n\t\t}, options || {});\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\n\tstop() {\n\t\tif (!this.server) {\n\t\t\tconst err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.server.close();\n\t\t\tthis.server = null;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t}\n\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tconnection.on('_handshakeOk', () => this.emit('connection', connection));\n\t}\n\n\n\tgetConnectionById(id) {\n\t\treturn this.rooms.getRoom('/').getConnectionById(id);\n\t}\n\n\n\tbroadcast(eventName, payload) {\n\t\treturn this.rooms.getRoom('/').broadcast(eventName, payload);\n\t}\n}\n\n\nServer.Events = {\n\tCONNECTION: 'connection',\n\tHEADERS: 'headers',\n\tERROR: 'error'\n};\n\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 2\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r', '_h'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 5\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\nmodule.exports = {promiseDelay, retry};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","import Utils from '../lib/utils';\nimport Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport Deferred from '../lib/deferred';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.deferreds_ = {};\n\t\tthis.socket.on('message', this.onMessage.bind(this));\n\t\tthis.socket.on('error', this.onError.bind(this));\n\t\tthis.socket.on('close', this.onClose.bind(this));\n\n\t\tthis.handshake_ = false;\n\t}\n\n\n\tonMessage(data, flags) {\n\t\tconst message = Message.parse(data);\n\t\t// TODO: Emit original _message event with raw data?\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Handshake\n\t\tif (message.name == '_h') {\n\t\t\tconst responsePayload = {\n\t\t\t\tid: this.id,\n\t\t\t\ttimeout: this.server.options.timeout,\n\t\t\t\tmaxReconnectDelay: this.server.options.maxReconnectDelay,\n\t\t\t\tinitialReconnectDelay: this.server.options.initialReconnectDelay,\n\t\t\t\treconnectIncrementFactor: this.server.options.reconnectIncrementFactor\n\t\t\t};\n\n\t\t\tUtils.retry(\n\t\t\t\t\t_ => this.send_(message.createResponse(null, responsePayload)),\n\t\t\t\t\t{maxCount: 3, initialDelay: 1, increaseFactor: 1}\n\t\t\t\t)\n\t\t\t\t.then(_ => {\n\t\t\t\t\tthis.joinRoom('/');\n\t\t\t\t\tthis.handshake_ = true;\n\t\t\t\t\tthis.emit('_handshakeOk');\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tthis.handshake_ = false;\n\t\t\t\t\tconsole.log(`Handshake failed for ${this.id}.`);\n\t\t\t\t\tthis.onClose(500, err);\n\t\t\t\t});\n\t\t}\n\n\t\t// Message response\n\t\tif (message.name == '_r' && this.deferreds_[message.id]) {\n\t\t\tconst deferred = this.deferreds_[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = assign(new Error(), message.err);\n\t\t\t\tdeferred.reject(err);\n\t\t\t} else {\n\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.deferreds_[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\tonError(error) {\n\t\tthis.emit('_error', error);\n\t}\n\n\tonClose(code, message) {\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\tforEach(this.deferreds_, (deferred) => {\n\t\t\tdeferred.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.deferreds_ = {};\n\n\t\tthis.emit('_close', code, message);\n\t}\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tmessage.setId();\n\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\tconst deferred = this.deferreds_[message.id] = new Deferred({\n\t\t\t\t\tonExpire: () => {\n\t\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: this.server.options.timeout\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t}\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\tforEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tforEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\tforEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 15\n// module chunks = 0"],"sourceRoot":""}