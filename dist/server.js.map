{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap 375975164789bf4b44d4","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///external \"lodash/forEach\"","webpack:///./src/lib/message.js","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/isObject\"","webpack:///./src/server/connection.js","webpack:///./src/server/rooms.js","webpack:///external \"uws\"","webpack:///./src/lib/deferred.js","webpack:///./src/server/room.js","webpack:///external \"lodash/debounce\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/map\"","webpack:///external \"lodash/values\"","webpack:///external \"node-uuid\"","webpack:///./src/server/server.js"],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","Object","defineProperty","configurable","enumerable","get","n","__esModule","o","object","property","prototype","hasOwnProperty","p","s","require","_interopRequireDefault","obj","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","length","descriptor","key","protoProps","staticProps","_isUndefined","_isUndefined2","_isObject","_isObject2","_isFunction","_isFunction2","_values","_values2","_utils","_commonjs","_commonjs2","Message","_EventEmitter","_ref","payload","id","err","this","_this","getPrototypeOf","isResponded_","raw","data","JSON","parse","e","Error","arguments","undefined","generateDummyId","_this2","console","warn","then","response","emit","catch","stringify","_this3","events","eventNames","forEach","event","removeAllListeners","Names","RESPONSE","HANDSHAKE","PING","ReservedNames","promiseDelay","ms","Promise","resolve","setTimeout","_","retry","task","options","defaults","maxDelay","maxCount","initialDelay","increaseFactor","_assign2","timeout","counter","delay","once","clearTimeout","Math","random","pow","toString","slice","_assign","_interopRequireWildcard","newObj","_utils2","_message","_message2","_forEach","_forEach2","_debounce","_debounce2","_deferred","_deferred2","_nodeUuid","uuid","Connection","socket","server","v4","deferreds_","state","States","OPEN","on","onMessage_","bind","onError_","onClose_","autoPing_","pingInterval","ping","flags","message","Events","MESSAGE","indexOf","onHandshake_","onPing_","onResponse_","send_","createResponse","dispose","responsePayload","handshakePayload","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","joinRoom","HANDSHAKE_OK","log","err_","handshakeResponse","deferred","reject","ERROR","code","CLOSE","rooms","removeFromAll","roomName","add","remove","getRoomsOf","eventName","_this4","setId","onExpire","_this5","send","_this6","_filter","_filter2","_map","_map2","_room","_room2","Rooms","/","connection","getConnectionsCount","room","getConnectionById","Deferred","_ref$handler","handler","_ref$onExpire","_ref$timeout","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","_len","args","Array","_key","apply","_len2","_key2","Room","connections","connectionId","keys","index","_uws","_connection","_connection2","_rooms","_rooms2","Server","_EventEmitterExtra","assign","port","bindEvents","close","onConnection","onHeaders","onError","CONNECTION","headers","HEADERS","getRoom","broadcast"],"mappings":"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","file":"server.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmory imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmory exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tObject.defineProperty(exports, name, {\n/******/ \t\t\tconfigurable: false,\n/******/ \t\t\tenumerable: true,\n/******/ \t\t\tget: getter\n/******/ \t\t});\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 18);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/forEach\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _isUndefined = __webpack_require__(14);\n\nvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\nvar _isObject = __webpack_require__(5);\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nvar _isFunction = __webpack_require__(13);\n\nvar _isFunction2 = _interopRequireDefault(_isFunction);\n\nvar _values = __webpack_require__(16);\n\nvar _values2 = _interopRequireDefault(_values);\n\nvar _utils = __webpack_require__(3);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Message = function (_EventEmitter) {\n    _inherits(Message, _EventEmitter);\n\n    _createClass(Message, null, [{\n        key: 'parse',\n        value: function parse(raw) {\n            try {\n                var data = JSON.parse(raw);\n                return new Message({\n                    name: data.n,\n                    payload: data.p,\n                    err: data.e,\n                    id: data.i\n                });\n            } catch (err) {\n                throw new Error('Could not parse message.');\n            }\n        }\n    }]);\n\n    function Message(_ref) {\n        var name = _ref.name,\n            payload = _ref.payload,\n            id = _ref.id,\n            err = _ref.err;\n\n        _classCallCheck(this, Message);\n\n        var _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\n        _this.name = name;\n        _this.payload = payload;\n        _this.id = id;\n        _this.err = err;\n\n        _this.isResponded_ = false;\n        return _this;\n    }\n\n    _createClass(Message, [{\n        key: 'setId',\n        value: function setId() {\n            var id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (0, _utils.generateDummyId)();\n\n            this.id = id;\n            return id;\n        }\n    }, {\n        key: 'createResponse',\n        value: function createResponse(err, payload) {\n            return new Message({ name: '_r', payload: payload, err: err, id: this.id });\n        }\n    }, {\n        key: 'resolve',\n        value: function resolve(payload) {\n            var _this2 = this;\n\n            if ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\n            if (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n            // If thenable\n            if ((0, _isObject2.default)(payload) && (0, _isFunction2.default)(payload.then)) {\n                payload.then(function (response) {\n                    _this2.isResponded_ = true;\n                    _this2.emit('resolved', payload);\n                }).catch(function (err) {\n                    _this2.isResponded_ = true;\n                    _this2.emit('rejected', err);\n                });\n\n                return;\n            }\n\n            this.isResponded_ = true;\n            this.emit('resolved', payload);\n        }\n    }, {\n        key: 'reject',\n        value: function reject(err) {\n            if ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\n            if (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n            this.isResponded_ = true;\n            this.emit('rejected', err);\n        }\n    }, {\n        key: 'toString',\n        value: function toString() {\n            try {\n                var data = { n: this.name };\n\n                if (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\n                if (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\n                if (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\n                return JSON.stringify(data);\n            } catch (err) {\n                throw new Error('Could not stringify message.');\n            }\n        }\n    }, {\n        key: 'dispose',\n        value: function dispose() {\n            var _this3 = this;\n\n            var events = this.eventNames();\n            events.forEach(function (event) {\n                return _this3.removeAllListeners(event);\n            });\n        }\n    }]);\n\n    return Message;\n}(_commonjs2.default);\n\nexports.default = Message;\n\n\nMessage.Names = {\n    RESPONSE: '_r',\n    HANDSHAKE: '_h',\n    PING: '_p'\n};\n\nMessage.ReservedNames = (0, _values2.default)(Message.Names);\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\"use strict\";\n\nvar _assign = __webpack_require__(4);\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction promiseDelay(ms) {\n    return new Promise(function (resolve) {\n        return setTimeout(function (_) {\n            return resolve();\n        }, ms);\n    });\n}\n\nfunction retry(task) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var defaults = { maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2 };\n    options = (0, _assign2.default)(defaults, options);\n    var timeout = void 0;\n    var counter = 1;\n    var delay = options.initialDelay;\n\n    var once = function once() {\n        return task().catch(function (err) {\n            counter++;\n            delay = delay * options.increaseFactor;\n\n            if (options.maxCount != 0 && counter > options.maxCount) {\n                timeout && clearTimeout(timeout);\n                throw err;\n            }\n            return promiseDelay(delay * 1000 / 2).then(function (_) {\n                return once();\n            });\n        });\n    };\n\n    return once();\n}\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId() {\n    var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4;\n\n    return (\"0000\" + (Math.random() * Math.pow(36, length) << 0).toString(36)).slice(-length);\n}\n\nmodule.exports = { promiseDelay: promiseDelay, retry: retry, generateDummyId: generateDummyId };\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isObject\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _message = __webpack_require__(2);\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nvar _assign = __webpack_require__(4);\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _isObject = __webpack_require__(5);\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nvar _debounce = __webpack_require__(11);\n\nvar _debounce2 = _interopRequireDefault(_debounce);\n\nvar _deferred = __webpack_require__(9);\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _nodeUuid = __webpack_require__(17);\n\nvar uuid = _interopRequireWildcard(_nodeUuid);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Connection = function (_EventEmitter) {\n    _inherits(Connection, _EventEmitter);\n\n    function Connection(socket, server) {\n        _classCallCheck(this, Connection);\n\n        var _this = _possibleConstructorReturn(this, (Connection.__proto__ || Object.getPrototypeOf(Connection)).call(this));\n\n        _this.id = uuid.v4();\n\n        _this.socket = socket;\n        _this.server = server;\n\n        _this.deferreds_ = {};\n        _this.state = Connection.States.OPEN;\n\n        _this.socket.on('message', _this.onMessage_.bind(_this));\n        _this.socket.on('error', _this.onError_.bind(_this));\n        _this.socket.on('close', _this.onClose_.bind(_this));\n\n        _this.autoPing_ = server.options.pingInterval > 0 ? (0, _debounce2.default)(function () {\n            if (_this.state != Connection.States.OPEN) return;\n\n            _this.ping().then(function () {\n                if (server.options.pingInterval > 0 && _this.state == Connection.States.OPEN) {\n                    _this.autoPing_();\n                }\n            }).catch(function () {});\n        }, server.options.pingInterval) : function () {};\n        return _this;\n    }\n\n    _createClass(Connection, [{\n        key: 'onMessage_',\n        value: function onMessage_(data, flags) {\n            var _this2 = this;\n\n            var message = _message2.default.parse(data);\n\n            this.autoPing_();\n\n            // Emit original _message event with raw data\n            this.emit(Connection.Events.MESSAGE, data);\n\n            // Message without response (no id fields)\n            if (!message.id && _message2.default.ReservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\n            // Handshake\n            if (message.name == _message2.default.Names.HANDSHAKE) {\n                return this.onHandshake_(message);\n            }\n\n            // Ping\n            if (message.name == _message2.default.Names.PING) {\n                return this.onPing_(message);\n            }\n\n            // Message response\n            if (message.name == _message2.default.Names.RESPONSE && this.deferreds_[message.id]) {\n                return this.onResponse_(message);\n            }\n\n            // Message with response\n            message.once('resolved', function (payload) {\n                _this2.send_(message.createResponse(null, payload));\n                message.dispose();\n            });\n\n            message.once('rejected', function (err) {\n                if ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n                _this2.send_(message.createResponse(err));\n                message.dispose();\n            });\n\n            this.emit(message.name, message);\n        }\n    }, {\n        key: 'onHandshake_',\n        value: function onHandshake_(message) {\n            var _this3 = this;\n\n            message.once('resolved', function (payload) {\n                var responsePayload = {\n                    handshakePayload: payload,\n                    id: _this3.id,\n                    timeout: _this3.server.options.timeout,\n                    maxReconnectDelay: _this3.server.options.maxReconnectDelay,\n                    initialReconnectDelay: _this3.server.options.initialReconnectDelay,\n                    reconnectIncrementFactor: _this3.server.options.reconnectIncrementFactor,\n                    pingInterval: _this3.server.options.pingInterval\n                };\n\n                _this3.send_(message.createResponse(null, responsePayload)).then(function () {\n                    _this3.joinRoom('/');\n                    _this3.emit(Connection.Events.HANDSHAKE_OK);\n                }).catch(function () {\n                    console.log('Handshake resolve response failed to send for ' + _this3.id + '.');\n                    _this3.onClose_(500, err);\n                }).then(function () {\n                    message.dispose();\n                });\n            });\n\n            message.once('rejected', function (err) {\n                if ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\n                _this3.send_(message.createResponse(err)).catch(function (err_) {\n                    console.log('Handshake reject response failed to send for ' + _this3.id + '.');\n                }).then(function () {\n                    _this3.onClose_(500, err);\n                    message.dispose();\n                });\n            });\n\n            // Sorry for party rocking\n            var handshakeResponse = this.server.emit('handshake', this, message);\n\n            if (!handshakeResponse) message.resolve();\n        }\n    }, {\n        key: 'onResponse_',\n        value: function onResponse_(message) {\n            var deferred = this.deferreds_[message.id];\n\n            if (message.err) {\n                var _err = (0, _assign2.default)(new Error(), message.err);\n                deferred.reject(_err);\n            } else {\n                deferred.resolve(message.payload);\n            }\n\n            delete this.deferreds_[message.id];\n        }\n    }, {\n        key: 'onPing_',\n        value: function onPing_(message) {\n            this.send_(message.createResponse(null, 'pong')).catch(function (err) {\n                console.log('Ping responce failed to send', err);\n            });\n        }\n    }, {\n        key: 'onError_',\n        value: function onError_(err) {\n            this.emit(Connection.Events.ERROR, err);\n            this.onClose_(500, err);\n        }\n    }, {\n        key: 'onClose_',\n        value: function onClose_(code, message) {\n            if (this.state == Connection.States.CLOSE) return;\n\n            this.server.rooms.removeFromAll(this);\n\n            (0, _forEach2.default)(this.deferreds_, function (deferred) {\n                deferred.reject(new Error('Socket connection closed!'));\n            });\n            this.deferreds_ = {};\n\n            this.state = Connection.States.CLOSE;\n            this.emit(Connection.Events.CLOSE, code, message);\n        }\n    }, {\n        key: 'joinRoom',\n        value: function joinRoom(roomName) {\n            this.server.rooms.add(roomName, this);\n        }\n    }, {\n        key: 'leaveRoom',\n        value: function leaveRoom(roomName) {\n            this.server.rooms.remove(roomName, this);\n        }\n    }, {\n        key: 'getRooms',\n        value: function getRooms() {\n            this.server.rooms.getRoomsOf(this);\n        }\n    }, {\n        key: 'send',\n        value: function send(eventName, payload) {\n            var _this4 = this;\n\n            var message = new _message2.default({ name: eventName, payload: payload });\n            message.setId();\n\n            return this.send_(message).then(function (_) {\n                var deferred = _this4.deferreds_[message.id] = new _deferred2.default({\n                    onExpire: function onExpire() {\n                        delete _this4.deferreds_[message.id];\n                    },\n                    timeout: _this4.server.options.timeout\n                });\n\n                return deferred;\n            });\n        }\n    }, {\n        key: 'sendWithoutResponse',\n        value: function sendWithoutResponse(eventName, payload) {\n            var message = new _message2.default({ name: eventName, payload: payload });\n            return this.send_(message);\n        }\n    }, {\n        key: 'send_',\n        value: function send_(message) {\n            var _this5 = this;\n\n            return new Promise(function (resolve, reject) {\n                _this5.socket.send(message.toString(), function (err) {\n                    if (err) return reject(err);\n                    resolve();\n                });\n            });\n        }\n    }, {\n        key: 'ping',\n        value: function ping() {\n            var _this6 = this;\n\n            return _utils2.default.retry(function (_) {\n                return _this6.send(_message2.default.Names.PING);\n            }, { maxCount: 3, initialDelay: 1, increaseFactor: 1 }).catch(function (err) {\n                _this6.onClose_(410, new Error('Ping failed, dead connection'));\n                throw err;\n            });\n        }\n    }]);\n\n    return Connection;\n}(_commonjs2.default);\n\nConnection.States = {\n    OPEN: 'open',\n    CLOSE: 'close'\n};\n\nConnection.Events = {\n    MESSAGE: '_message',\n    HANDSHAKE_OK: '_handshakeOk', // Private\n    ERROR: '_error',\n    CLOSE: '_close'\n};\n\nmodule.exports = Connection;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _filter = __webpack_require__(12);\n\nvar _filter2 = _interopRequireDefault(_filter);\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _map = __webpack_require__(15);\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _room = __webpack_require__(10);\n\nvar _room2 = _interopRequireDefault(_room);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Rooms = function () {\n    function Rooms() {\n        _classCallCheck(this, Rooms);\n\n        this.rooms = { '/': new _room2.default('/') };\n    }\n\n    _createClass(Rooms, [{\n        key: 'add',\n        value: function add(roomName, connection) {\n            if (!this.rooms[roomName]) this.rooms[roomName] = new _room2.default(roomName);\n\n            this.rooms[roomName].add(connection);\n        }\n    }, {\n        key: 'remove',\n        value: function remove(roomName, connection) {\n            if (!this.rooms[roomName]) return;\n\n            this.rooms[roomName].remove(connection);\n\n            if (roomName != '/' && !this.rooms[roomName].getConnectionsCount()) delete this.rooms[roomName];\n        }\n    }, {\n        key: 'getRoomsOf',\n        value: function getRoomsOf(connection) {\n            return (0, _map2.default)((0, _filter2.default)(this.rooms, function (room) {\n                return room.getConnectionById(connection.id);\n            }), 'name');\n        }\n    }, {\n        key: 'getRoom',\n        value: function getRoom(room) {\n            return this.rooms[room];\n        }\n    }, {\n        key: 'removeFromAll',\n        value: function removeFromAll(connection) {\n            var _this = this;\n\n            var rooms = this.getRoomsOf(connection);\n            (0, _forEach2.default)(rooms, function (roomName) {\n                return _this.rooms[roomName].remove(connection);\n            });\n        }\n    }]);\n\n    return Rooms;\n}();\n\nexports.default = Rooms;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"uws\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Deferred = function () {\n    function Deferred() {\n        var _this = this;\n\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            _ref$handler = _ref.handler,\n            handler = _ref$handler === undefined ? function () {} : _ref$handler,\n            _ref$onExpire = _ref.onExpire,\n            onExpire = _ref$onExpire === undefined ? function () {} : _ref$onExpire,\n            _ref$timeout = _ref.timeout,\n            timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\n        _classCallCheck(this, Deferred);\n\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise(function (resolve, reject) {\n            _this.resolve_ = resolve;\n            _this.reject_ = reject;\n\n            try {\n                handler(_this);\n            } catch (err) {\n                _this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n    _createClass(Deferred, [{\n        key: 'resolve',\n        value: function resolve(data) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.resolve_(data);\n        }\n    }, {\n        key: 'reject',\n        value: function reject(err) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.reject_(err);\n        }\n    }, {\n        key: 'expire',\n        value: function expire() {\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.onExpire_();\n            this.reject_(new Error('Timeout exceed'));\n        }\n    }, {\n        key: 'then',\n        value: function then() {\n            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                args[_key] = arguments[_key];\n            }\n\n            return this.promise.then.apply(this.promise, args);\n        }\n    }, {\n        key: 'catch',\n        value: function _catch() {\n            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                args[_key2] = arguments[_key2];\n            }\n\n            return this.promise.catch.apply(this.promise, args);\n        }\n    }, {\n        key: 'clearTimeout_',\n        value: function clearTimeout_() {\n            if (this.timeout_) {\n                clearTimeout(this.timeout_);\n                this.timeout_ = null;\n            }\n        }\n    }]);\n\n    return Deferred;\n}();\n\nmodule.exports = Deferred;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _forEach = __webpack_require__(1);\n\nvar _forEach2 = _interopRequireDefault(_forEach);\n\nvar _message = __webpack_require__(2);\n\nvar _message2 = _interopRequireDefault(_message);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Room = function () {\n    function Room(name) {\n        var connections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n        _classCallCheck(this, Room);\n\n        this.name = name;\n        this.connections = connections;\n    }\n\n    _createClass(Room, [{\n        key: 'add',\n        value: function add(connection) {\n            this.connections[connection.id] = connection;\n        }\n    }, {\n        key: 'remove',\n        value: function remove(connection) {\n            delete this.connections[connection.id];\n        }\n    }, {\n        key: 'getConnectionById',\n        value: function getConnectionById(connectionId) {\n            return this.connections[connectionId];\n        }\n    }, {\n        key: 'getConnectionsCount',\n        value: function getConnectionsCount() {\n            return Object.keys(this.connections).length;\n        }\n    }, {\n        key: 'broadcast_',\n        value: function broadcast_(message) {\n            (0, _forEach2.default)(this.connections, function (connection) {\n                connection.send_(message);\n            });\n        }\n    }, {\n        key: 'broadcast',\n        value: function broadcast(eventName, payload) {\n            var message = new _message2.default({ name: eventName, payload: payload });\n            (0, _forEach2.default)(this.connections, function (connection, index) {\n                connection.send_(message);\n            });\n        }\n    }]);\n\n    return Room;\n}();\n\nexports.default = Room;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/debounce\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/filter\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isFunction\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/map\");\n\n/***/ },\n/* 16 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/values\");\n\n/***/ },\n/* 17 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"node-uuid\");\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _uws = __webpack_require__(8);\n\nvar _connection = __webpack_require__(6);\n\nvar _connection2 = _interopRequireDefault(_connection);\n\nvar _rooms = __webpack_require__(7);\n\nvar _rooms2 = _interopRequireDefault(_rooms);\n\nvar _commonjs = __webpack_require__(0);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * Line Server Class\n * Documentation is here\n *\n * @class Server\n * @extends {EventEmitterExtra}\n * @param {Object=} options Optional options object.\n * @param {string=} options.host Server host name. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {number=} options.port Server port. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {http.Server=} options.server Server object to be attached. If provided, `host` and `port` will ignored. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {Function=} options.handleProtocols Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#optionshandleprotocols).\n * @param {string=} options.path Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean=} options.noServer Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean=} options.clientTracking Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean|Object=} options.perMessageDeflate Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#optionspermessagedeflate).\n * @param {number=} options.timeout Timeout duration (in ms) for message responses. Default: 30 seconds\n * @param {number=} options.maxReconnectDelay Maximum reconnection delay (in seconds) for clients. Default: 60 seconds\n * @param {number=} options.initialReconnectDelay Intial reconnection delay (in seconds) for clients. Defualt: 1 seconds\n * @param {number=} options.reconnectIncrementFactor Reconnection incremental factor for clients. Default: 2\n * @param {number=} options.pingInterval Ping interval (in ms) for both server and client. Default: 60 seconds.\n * @example\n * const Server = require('line/server');\n * const server = new Server({\n *     port: 8080\n * });\n */\nvar Server = function (_EventEmitterExtra) {\n    _inherits(Server, _EventEmitterExtra);\n\n    function Server() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        _classCallCheck(this, Server);\n\n        var _this = _possibleConstructorReturn(this, (Server.__proto__ || Object.getPrototypeOf(Server)).call(this));\n\n        _this.rooms = new _rooms2.default();\n\n        _this.options = Object.assign({\n            timeout: 30000,\n            maxReconnectDelay: 60,\n            initialReconnectDelay: 1,\n            reconnectIncrementFactor: 2,\n            pingInterval: 60000\n        }, options);\n        return _this;\n    }\n\n    /**\n     * Starts the server.\n     *\n     * @returns {Promise}\n     * @memberOf Server\n     * @example\n     * server\n     *     .start()\n     *     .then(() => {\n     *         console.log('Server started');\n     *     })\n     *     .catch((err) => {\n     *         console.log('Server could not started', err);\n     *     });\n     */\n\n\n    _createClass(Server, [{\n        key: 'start',\n        value: function start() {\n            var _this2 = this;\n\n            if (!this.options.port) {\n                this.server = new _uws.Server(this.options);\n                this.bindEvents();\n                return Promise.resolve();\n            }\n\n            return new Promise(function (resolve, reject) {\n                _this2.server = new _uws.Server(_this2.options, function (err) {\n                    if (err) return reject(err);\n                    _this2.bindEvents();\n                    resolve();\n                });\n            });\n        }\n\n        /**\n         * Stops the server.\n         *\n         * @returns {Promise}\n         * @memberOf Server\n         * @example\n         * server\n         *     .stop()\n         *     .then(() => {\n         *         console.log('Server stopped');\n         *     })\n         *     .catch((err) => {\n         *         console.log('Server could not stopped', err);\n         *     });\n         */\n\n    }, {\n        key: 'stop',\n        value: function stop() {\n            var _this3 = this;\n\n            if (!this.server) {\n                var err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n                return Promise.reject(err);\n            }\n\n            return new Promise(function (resolve) {\n                _this3.server.close();\n                _this3.server = null;\n                resolve();\n            });\n        }\n    }, {\n        key: 'bindEvents',\n        value: function bindEvents() {\n            this.server.on('connection', this.onConnection.bind(this));\n            this.server.on('headers', this.onHeaders.bind(this));\n            this.server.on('error', this.onError.bind(this));\n        }\n    }, {\n        key: 'onConnection',\n        value: function onConnection(socket) {\n            var _this4 = this;\n\n            var connection = new _connection2.default(socket, this);\n            connection.on(_connection2.default.Events.HANDSHAKE_OK, function () {\n                return _this4.emit(Server.Events.CONNECTION, connection);\n            });\n        }\n    }, {\n        key: 'onHeaders',\n        value: function onHeaders(headers) {\n            this.emit(Server.Events.HEADERS, headers);\n        }\n    }, {\n        key: 'onError',\n        value: function onError(err) {\n            this.emit(Server.Events.ERROR, err);\n        }\n\n        /**\n         * Gets a connection by id\n         *\n         * @param {string} id\n         * @returns {?Connection}\n         * @memberOf Server\n         * @example\n         * const connection = server.getConnectionById('someId');\n         *\n         * if (connection)\n         *     connection.send('hello', {world: ''});\n         */\n\n    }, {\n        key: 'getConnectionById',\n        value: function getConnectionById(id) {\n            return this.rooms.getRoom('/').getConnectionById(id);\n        }\n\n        /**\n         * Broadcasts a message to all the connected clients.\n         *\n         * @param {string} eventName\n         * @param {any} payload\n         * @memberOf Server\n         * @example\n         * server.broadcast('hello', {world: ''});\n         */\n\n    }, {\n        key: 'broadcast',\n        value: function broadcast(eventName, payload) {\n            this.rooms.getRoom('/').broadcast(eventName, payload);\n        }\n    }]);\n\n    return Server;\n}(_commonjs2.default);\n\n/**\n * `Server` is an [full-fledged event emitter](https://github.com/signalive/event-emitter-extra).\n *\n * @param {'connection'} Server.Events.CONNECTION\n * @param {'handshake'} Server.Events.HANDSHAKE\n * @param {'headers'} Server.Events.HEADERS\n * @param {'error'} Server.Events.ERROR\n * @example\n * // On a client connects after successful handshake\n * server.on('connection', (connection) => {\n *    connection.send('hello');\n *    ...\n * });\n *\n * // If you want to authorize your client\n * server.on('handshake', (connection, handshake) => {\n *    if (handshake.payload.token == 'test')\n *        handshake.resolve();\n *    else\n *        handshake.reject(new Error('Invalid token'));\n * });\n *\n * // Catch errors\n * server.on('error', (err) => {\n *    ...\n * });\n */\n\n\nServer.Events = {\n    CONNECTION: 'connection',\n    HANDSHAKE: 'handshake',\n    HEADERS: 'headers',\n    ERROR: 'error'\n};\n\nmodule.exports = Server;\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 375975164789bf4b44d4","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 1\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport values from 'lodash/values';\nimport {generateDummyId} from './utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n    static parse(raw) {\n        try {\n            const data = JSON.parse(raw);\n            return new Message({\n                name: data.n,\n                payload: data.p,\n                err: data.e,\n                id: data.i\n            });\n        } catch(err) {\n            throw new Error(`Could not parse message.`);\n        }\n    }\n\n    constructor({name, payload, id, err}) {\n        super();\n\n        this.name = name;\n        this.payload = payload;\n        this.id = id;\n        this.err = err;\n\n        this.isResponded_ = false;\n    }\n\n    setId(id = generateDummyId()) {\n        this.id = id;\n        return id;\n    }\n\n    createResponse(err, payload) {\n        return new Message({name: '_r', payload, err, id: this.id});\n    }\n\n    resolve(payload) {\n        if (isUndefined(this.id))\n            return console.warn('[line] A message without an id cannot be resolved.');\n\n        if (this.isResponded_)\n            return console.warn('[line] This message has already been ended.');\n\n        // If thenable\n        if (isObject(payload) && isFunction(payload.then)) {\n            payload\n                .then(response => {\n                    this.isResponded_ = true;\n                    this.emit('resolved', payload);\n                })\n                .catch(err => {\n                    this.isResponded_ = true;\n                    this.emit('rejected', err);\n                });\n\n            return;\n        }\n\n        this.isResponded_ = true;\n        this.emit('resolved', payload);\n    }\n\n    reject(err) {\n        if (isUndefined(this.id))\n            return console.warn('[line] A message without an id cannot be rejected.');\n\n        if (this.isResponded_)\n            return console.warn('[line] This message has already been ended.');\n\n        this.isResponded_ = true;\n        this.emit('rejected', err);\n    }\n\n    toString() {\n        try {\n            const data = {n: this.name};\n\n            if (!isUndefined(this.payload))\n                data.p = this.payload;\n\n            if (!isUndefined(this.id))\n                data.i = this.id;\n\n            if (!isUndefined(this.err))\n                data.e = this.err;\n\n            return JSON.stringify(data);\n        } catch(err) {\n            throw new Error(`Could not stringify message.`);\n        }\n    }\n\n    dispose() {\n        const events = this.eventNames();\n        events.forEach(event => this.removeAllListeners(event));\n    }\n}\n\n\nMessage.Names = {\n    RESPONSE: '_r',\n    HANDSHAKE: '_h',\n    PING: '_p'\n};\n\n\nMessage.ReservedNames = values(Message.Names);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n    return new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n    const defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n    options = assign(defaults, options);\n    let timeout;\n    let counter = 1;\n    let delay = options.initialDelay;\n\n    const once = function() {\n        return task()\n            .catch(err => {\n                counter++;\n                delay = delay * options.increaseFactor;\n\n                if (options.maxCount != 0 && counter > options.maxCount) {\n                    timeout && clearTimeout(timeout);\n                    throw err;\n                }\n                return promiseDelay(delay * 1000 / 2).then(_ => once());\n            });\n    }\n\n    return once();\n}\n\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId(length = 4) {\n    return (\"0000\" + (Math.random()*Math.pow(36,length) << 0).toString(36)).slice(-length);\n}\n\n\nmodule.exports = {promiseDelay, retry, generateDummyId};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 5\n// module chunks = 0","import Utils from '../lib/utils';\nimport Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport debounce from 'lodash/debounce';\nimport Deferred from '../lib/deferred';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n    constructor(socket, server) {\n        super();\n\n        this.id = uuid.v4();\n\n        this.socket = socket;\n        this.server = server;\n\n        this.deferreds_ = {};\n        this.state = Connection.States.OPEN;\n\n        this.socket.on('message', this.onMessage_.bind(this));\n        this.socket.on('error', this.onError_.bind(this));\n        this.socket.on('close', this.onClose_.bind(this));\n\n        this.autoPing_ = server.options.pingInterval > 0 ?\n            debounce(() => {\n                if (this.state != Connection.States.OPEN)\n                    return;\n\n                this\n                    .ping()\n                    .then(() => {\n                        if (server.options.pingInterval > 0 && this.state == Connection.States.OPEN) {\n                            this.autoPing_();\n                        }\n                    })\n                    .catch(() => {});\n            }, server.options.pingInterval) :\n            () => {};\n    }\n\n\n    onMessage_(data, flags) {\n        const message = Message.parse(data);\n\n        this.autoPing_();\n\n        // Emit original _message event with raw data\n        this.emit(Connection.Events.MESSAGE, data);\n\n        // Message without response (no id fields)\n        if (!message.id && Message.ReservedNames.indexOf(message.name) == -1)\n            return this.emit(message.name, message);\n\n        // Handshake\n        if (message.name == Message.Names.HANDSHAKE) {\n            return this.onHandshake_(message);\n        }\n\n        // Ping\n        if (message.name == Message.Names.PING) {\n            return this.onPing_(message);\n        }\n\n        // Message response\n        if (message.name == Message.Names.RESPONSE && this.deferreds_[message.id]) {\n            return this.onResponse_(message);\n        }\n\n        // Message with response\n        message.once('resolved', payload => {\n            this.send_(message.createResponse(null, payload));\n            message.dispose();\n        });\n\n        message.once('rejected', err => {\n            if (isObject(err) && err instanceof Error && err.name == 'Error')\n               err = {message: err.message, name: 'Error'};\n            this.send_(message.createResponse(err));\n            message.dispose();\n        });\n\n        this.emit(message.name, message);\n    }\n\n\n    onHandshake_(message) {\n        message.once('resolved', payload => {\n            const responsePayload = {\n                handshakePayload: payload,\n                id: this.id,\n                timeout: this.server.options.timeout,\n                maxReconnectDelay: this.server.options.maxReconnectDelay,\n                initialReconnectDelay: this.server.options.initialReconnectDelay,\n                reconnectIncrementFactor: this.server.options.reconnectIncrementFactor,\n                pingInterval: this.server.options.pingInterval\n            };\n\n            this\n                .send_(message.createResponse(null, responsePayload))\n                .then(() => {\n                    this.joinRoom('/');\n                    this.emit(Connection.Events.HANDSHAKE_OK);\n                })\n                .catch(() => {\n                    console.log(`Handshake resolve response failed to send for ${this.id}.`);\n                    this.onClose_(500, err);\n                })\n                .then(() => {\n                    message.dispose();\n                });\n        });\n\n        message.once('rejected', err => {\n            if (isObject(err) && err instanceof Error && err.name == 'Error')\n               err = {message: err.message, name: 'Error'};\n\n            this\n                .send_(message.createResponse(err))\n                .catch(err_ => {\n                    console.log(`Handshake reject response failed to send for ${this.id}.`);\n                })\n                .then(() => {\n                    this.onClose_(500, err);\n                    message.dispose();\n                });\n        });\n\n        // Sorry for party rocking\n        const handshakeResponse = this.server.emit('handshake', this, message);\n\n        if (!handshakeResponse)\n            message.resolve();\n    }\n\n\n    onResponse_(message) {\n        const deferred = this.deferreds_[message.id];\n\n        if (message.err) {\n            const err = assign(new Error(), message.err);\n            deferred.reject(err);\n        } else {\n            deferred.resolve(message.payload);\n        }\n\n        delete this.deferreds_[message.id];\n    }\n\n\n    onPing_(message) {\n        this\n            .send_(message.createResponse(null, 'pong'))\n            .catch(err => {\n                console.log('Ping responce failed to send', err);\n            });\n    }\n\n\n    onError_(err) {\n        this.emit(Connection.Events.ERROR, err);\n        this.onClose_(500, err);\n    }\n\n\n    onClose_(code, message) {\n        if (this.state == Connection.States.CLOSE)\n            return;\n\n        this.server.rooms.removeFromAll(this);\n\n        forEach(this.deferreds_, (deferred) => {\n            deferred.reject(new Error('Socket connection closed!'));\n        });\n        this.deferreds_ = {};\n\n        this.state = Connection.States.CLOSE;\n        this.emit(Connection.Events.CLOSE, code, message);\n    }\n\n\n    joinRoom(roomName) {\n        this.server.rooms.add(roomName, this);\n    }\n\n\n    leaveRoom(roomName) {\n        this.server.rooms.remove(roomName, this);\n    }\n\n\n    getRooms() {\n        this.server.rooms.getRoomsOf(this);\n    }\n\n\n    send(eventName, payload) {\n        const message = new Message({name: eventName, payload});\n        message.setId();\n\n        return this\n            .send_(message)\n            .then(_ => {\n                const deferred = this.deferreds_[message.id] = new Deferred({\n                    onExpire: () => {\n                        delete this.deferreds_[message.id];\n                    },\n                    timeout: this.server.options.timeout\n                });\n\n                return deferred;\n            });\n    }\n\n\n    sendWithoutResponse(eventName, payload) {\n        const message = new Message({name: eventName, payload});\n        return this.send_(message);\n    }\n\n\n    send_(message) {\n        return new Promise((resolve, reject) => {\n            this.socket.send(message.toString(), err => {\n                if (err) return reject(err);\n                resolve();\n            });\n        });\n    }\n\n\n    ping() {\n        return Utils\n            .retry(_ => this.send(Message.Names.PING), {maxCount: 3, initialDelay: 1, increaseFactor: 1})\n            .catch(err => {\n                this.onClose_(410, new Error('Ping failed, dead connection'));\n                throw err;\n            });\n    }\n}\n\n\nConnection.States = {\n    OPEN: 'open',\n    CLOSE: 'close'\n};\n\n\nConnection.Events = {\n    MESSAGE: '_message',\n    HANDSHAKE_OK: '_handshakeOk', // Private\n    ERROR: '_error',\n    CLOSE: '_close'\n};\n\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n    constructor() {\n        this.rooms = {'/': new Room('/')};\n    }\n\n    add(roomName, connection) {\n        if(!this.rooms[roomName])\n            this.rooms[roomName] = new Room(roomName);\n\n        this.rooms[roomName].add(connection);\n    }\n\n    remove(roomName, connection) {\n        if(!this.rooms[roomName])\n            return;\n\n        this.rooms[roomName].remove(connection);\n\n        if (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n            delete this.rooms[roomName];\n    }\n\n    getRoomsOf(connection) {\n        return map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n    }\n\n    getRoom(room) {\n        return this.rooms[room];\n    }\n\n    removeFromAll(connection) {\n        const rooms = this.getRoomsOf(connection);\n        forEach(rooms, roomName => this.rooms[roomName].remove(connection));\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 8\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n    constructor(name, connections = {}) {\n        this.name = name;\n        this.connections = connections;\n    }\n\n    add(connection) {\n        this.connections[connection.id] = connection;\n    }\n\n    remove(connection) {\n        delete this.connections[connection.id];\n    }\n\n    getConnectionById(connectionId) {\n        return this.connections[connectionId];\n    }\n\n    getConnectionsCount() {\n        return Object.keys(this.connections).length;\n    }\n\n    broadcast_(message) {\n        forEach(this.connections, connection => {\n            connection.send_(message)\n        });\n    }\n\n    broadcast(eventName, payload) {\n        const message = new Message({name: eventName, payload});\n        forEach(this.connections, (connection, index) => {\n            connection.send_(message)\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js","module.exports = require(\"lodash/debounce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/debounce\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"lodash/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/values\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 17\n// module chunks = 0","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitterExtra from 'event-emitter-extra/dist/commonjs.modern';\n\n\n/**\n * Line Server Class\n * Documentation is here\n *\n * @class Server\n * @extends {EventEmitterExtra}\n * @param {Object=} options Optional options object.\n * @param {string=} options.host Server host name. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {number=} options.port Server port. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {http.Server=} options.server Server object to be attached. If provided, `host` and `port` will ignored. Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {Function=} options.handleProtocols Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#optionshandleprotocols).\n * @param {string=} options.path Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean=} options.noServer Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean=} options.clientTracking Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#new-websocketserveroptions-callback).\n * @param {boolean|Object=} options.perMessageDeflate Inherited from uws, [see docs](https://github.com/websockets/ws/blob/master/doc/ws.md#optionspermessagedeflate).\n * @param {number=} options.timeout Timeout duration (in ms) for message responses. Default: 30 seconds\n * @param {number=} options.maxReconnectDelay Maximum reconnection delay (in seconds) for clients. Default: 60 seconds\n * @param {number=} options.initialReconnectDelay Intial reconnection delay (in seconds) for clients. Defualt: 1 seconds\n * @param {number=} options.reconnectIncrementFactor Reconnection incremental factor for clients. Default: 2\n * @param {number=} options.pingInterval Ping interval (in ms) for both server and client. Default: 60 seconds.\n * @example\n * const Server = require('line/server');\n * const server = new Server({\n *     port: 8080\n * });\n */\nclass Server extends EventEmitterExtra {\n    constructor(options = {}) {\n        super();\n\n        this.rooms = new Rooms();\n\n        this.options = Object.assign({\n            timeout: 30000,\n            maxReconnectDelay: 60,\n            initialReconnectDelay: 1,\n            reconnectIncrementFactor: 2,\n            pingInterval: 60000\n        }, options);\n    }\n\n    /**\n     * Starts the server.\n     *\n     * @returns {Promise}\n     * @memberOf Server\n     * @example\n     * server\n     *     .start()\n     *     .then(() => {\n     *         console.log('Server started');\n     *     })\n     *     .catch((err) => {\n     *         console.log('Server could not started', err);\n     *     });\n     */\n    start() {\n        if (!this.options.port) {\n            this.server = new WebSocketServer(this.options);\n            this.bindEvents();\n            return Promise.resolve();\n        }\n\n        return new Promise((resolve, reject) => {\n            this.server = new WebSocketServer(this.options, err => {\n                if (err) return reject(err);\n                this.bindEvents();\n                resolve();\n            });\n        })\n    }\n\n\n    /**\n     * Stops the server.\n     *\n     * @returns {Promise}\n     * @memberOf Server\n     * @example\n     * server\n     *     .stop()\n     *     .then(() => {\n     *         console.log('Server stopped');\n     *     })\n     *     .catch((err) => {\n     *         console.log('Server could not stopped', err);\n     *     });\n     */\n    stop() {\n        if (!this.server) {\n            const err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n            return Promise.reject(err);\n        }\n\n        return new Promise(resolve => {\n            this.server.close();\n            this.server = null;\n            resolve();\n        });\n    }\n\n\n    bindEvents() {\n        this.server.on('connection', this.onConnection.bind(this));\n        this.server.on('headers', this.onHeaders.bind(this));\n        this.server.on('error', this.onError.bind(this));\n    }\n\n\n    onConnection(socket) {\n        const connection = new Connection(socket, this);\n        connection.on(Connection.Events.HANDSHAKE_OK, () => this.emit(Server.Events.CONNECTION, connection));\n    }\n\n\n    onHeaders(headers) {\n        this.emit(Server.Events.HEADERS, headers);\n    }\n\n\n    onError(err) {\n        this.emit(Server.Events.ERROR, err);\n    }\n\n\n    /**\n     * Gets a connection by id\n     *\n     * @param {string} id\n     * @returns {?Connection}\n     * @memberOf Server\n     * @example\n     * const connection = server.getConnectionById('someId');\n     *\n     * if (connection)\n     *     connection.send('hello', {world: ''});\n     */\n    getConnectionById(id) {\n        return this.rooms.getRoom('/').getConnectionById(id);\n    }\n\n\n    /**\n     * Broadcasts a message to all the connected clients.\n     *\n     * @param {string} eventName\n     * @param {any} payload\n     * @memberOf Server\n     * @example\n     * server.broadcast('hello', {world: ''});\n     */\n    broadcast(eventName, payload) {\n        this.rooms.getRoom('/').broadcast(eventName, payload);\n    }\n}\n\n\n/**\n * `Server` is an [full-fledged event emitter](https://github.com/signalive/event-emitter-extra).\n *\n * @param {'connection'} Server.Events.CONNECTION\n * @param {'handshake'} Server.Events.HANDSHAKE\n * @param {'headers'} Server.Events.HEADERS\n * @param {'error'} Server.Events.ERROR\n * @example\n * // On a client connects after successful handshake\n * server.on('connection', (connection) => {\n *    connection.send('hello');\n *    ...\n * });\n *\n * // If you want to authorize your client\n * server.on('handshake', (connection, handshake) => {\n *    if (handshake.payload.token == 'test')\n *        handshake.resolve();\n *    else\n *        handshake.reject(new Error('Invalid token'));\n * });\n *\n * // Catch errors\n * server.on('error', (err) => {\n *    ...\n * });\n */\nServer.Events = {\n    CONNECTION: 'connection',\n    HANDSHAKE: 'handshake',\n    HEADERS: 'headers',\n    ERROR: 'error'\n};\n\n\nmodule.exports = Server;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js"],"sourceRoot":""}