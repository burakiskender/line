{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap 2780ac7dffd16a32a39a","webpack:///./src/server/server.js","webpack:///external \"event-emitter-extra\"","webpack:///external \"lodash/forEach\"","webpack:///./src/lib/message.js","webpack:///external \"node-uuid\"","webpack:///./src/server/connection.js","webpack:///./src/server/room.js","webpack:///./src/server/rooms.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/isObject\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/map\"","webpack:///external \"uws\""],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","_uws","_connection","_connection2","_rooms","_rooms2","_eventEmitterExtra","_eventEmitterExtra2","Server","_EventEmitter","options","this","_this","getPrototypeOf","rooms","_this2","port","Promise","resolve","reject","server","err","bindEvents","Error","close","on","onConnection","bind","socket","connection","emit","require","_interopRequireWildcard","newObj","hasOwnProperty","_isUndefined","_isUndefined2","_nodeUuid","uuid","Message","_ref","name","payload","isResponded_","raw","data","JSON","parse","n","e","arguments","undefined","v4","console","warn","stringify","events","eventNames","forEach","event","removeAllListeners","reservedNames","_message","_message2","_assign","_assign2","_forEach","_forEach2","_isObject","_isObject2","Connection","promiseCallbacks","onMessage","onError","onClose","joinRoom","flags","message","indexOf","_promiseCallbacks$mes","once","send_","createResponse","dispose","error","code","removeFromAll","callbacks","roomName","add","remove","getRoomsOf","eventName","_this3","messageId","setId","then","_","_this4","send","toString","Room","connections","connectionId","keys","index","_filter","_filter2","_map","_map2","_room","_room2","Rooms","/","getConnectionsCount","room","getConnectionById"],"mappings":"AAAAA,OAAOC,QACE,SAAUC,GCGnB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAH,OAGA,IAAAD,GAAAK,EAAAD,IACAH,WACAK,GAAAF,EACAG,QAAA,EAUA,OANAL,GAAAE,GAAAI,KAAAR,EAAAC,QAAAD,IAAAC,QAAAE,GAGAH,EAAAO,QAAA,EAGAP,EAAAC,QAvBA,GAAAI,KAqCA,OATAF,GAAAM,EAAAP,EAGAC,EAAAO,EAAAL,EAGAF,EAAAQ,EAAA,GAGAR,EAAA,KDOM,SAASH,EAAQC,EAASE,GAE/B,YAkBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GAtBje,GAAIW,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWX,WAAaW,EAAWX,aAAc,EAAOW,EAAWT,cAAe,EAAU,SAAWS,KAAYA,EAAWV,UAAW,GAAML,OAAOgB,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUxB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBnB,EAAYQ,UAAWmB,GAAiBC,GAAaT,EAAiBnB,EAAa4B,GAAqB5B,MEjDjiB6B,EAAA5C,EAAA,IACA6C,EAAA7C,EAAA,GFsDK8C,EAAerC,EAAuBoC,GErD3CE,EAAA/C,EAAA,GFyDKgD,EAAUvC,EAAuBsC,GExDtCE,EAAAjD,EAAA,GF4DKkD,EAAsBzC,EAAuBwC,GEzD5CE,EFmEQ,SAAUC,GElEvB,QAAAD,GAAYE,GAASxC,EAAAyC,KAAAH,EAAA,IAAAI,GAAAtC,EAAAqC,MAAAH,EAAAnB,WAAAR,OAAAgC,eAAAL,IAAA9C,KAAAiD,MAAA,OAEpBC,GAAKE,MAAQ,GAAAT,GAAApC,QACb2C,EAAKF,QAAUA,EAHKE,EF2HpB,MAxDAnC,GAAU+B,EAAQC,GAYlBnB,EAAakB,IACZV,IAAK,QACLd,MAAO,WE3ED,GAAA+B,GAAAJ,IACP,OAAKA,MAAKD,QAAQM,KAMX,GAAIC,SAAQ,SAACC,EAASC,GAC5BJ,EAAKK,OAAS,GAAAnB,GAAAO,OAAoBO,EAAKL,QAAS,SAAAW,GAC/C,MAAIA,GAAYF,EAAOE,IACvBN,EAAKO,iBACLJ,WATDP,KAAKS,OAAS,GAAAnB,GAAAO,OAAoBG,KAAKD,SACvCC,KAAKW,aACEL,QAAQC,cFyFfpB,IAAK,OACLd,MAAO,WE5ER,IAAK2B,KAAKS,OAAQ,CACjB,GAAMC,GAAM,GAAIE,OAAM,6EACtB,OAAON,SAAQE,OAAOE,GAKvB,MAFAV,MAAKS,OAAOI,QACZb,KAAKS,OAAS,KACPH,QAAQC,aFgFdpB,IAAK,aACLd,MAAO,WE5ER2B,KAAKS,OAAOK,GAAG,aAAcd,KAAKe,aAAaC,KAAKhB,UFgFnDb,IAAK,eACLd,MAAO,SE9EI4C,GACZ,GAAMC,GAAa,GAAA1B,GAAAlC,QAAe2D,EAAQjB,KAC1CA,MAAKmB,KAAK,aAAcD,OFkFjBrB,GACND,EAAoBtC,QE/EvBf,GAAOC,QAAUqD,GFqFX,SAAStD,EAAQC,GGzIvBD,EAAAC,QAAA4E,QAAA,wBH+IM,SAAS7E,EAAQC,GI/IvBD,EAAAC,QAAA4E,QAAA,mBJqJM,SAAS7E,EAAQC,EAASE,GAE/B,YAoBA,SAAS2E,GAAwBjE,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAIkE,KAAa,IAAW,MAAPlE,EAAe,IAAK,GAAI+B,KAAO/B,GAAWc,OAAOD,UAAUsD,eAAexE,KAAKK,EAAK+B,KAAMmC,EAAOnC,GAAO/B,EAAI+B,GAAgC,OAAtBmC,GAAOhE,QAAUF,EAAYkE,EAElQ,QAASnE,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GA1BjeE,OAAOgB,eAAe1C,EAAS,cAC9B6B,OAAO,GAGR,IAAIM,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWX,WAAaW,EAAWX,aAAc,EAAOW,EAAWT,cAAe,EAAU,SAAWS,KAAYA,EAAWV,UAAW,GAAML,OAAOgB,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUxB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBnB,EAAYQ,UAAWmB,GAAiBC,GAAaT,EAAiBnB,EAAa4B,GAAqB5B,MK7JjiB+D,EAAA9E,EAAA,ILiKK+E,EAAgBtE,EAAuBqE,GKhK5CE,EAAAhF,EAAA,GAAYiF,ELoKAN,EAAwBK,GKnKpC/B,EAAAjD,EAAA,GLuKKkD,EAAsBzC,EAAuBwC,GKnK7BiC,EL+KN,SAAU9B,GKhKxB,QAAA8B,GAAAC,GAAsC,GAAzBC,GAAyBD,EAAzBC,KAAMC,EAAmBF,EAAnBE,QAASlF,EAAUgF,EAAVhF,GAAI6D,EAAMmB,EAANnB,GAAMnD,GAAAyC,KAAA4B,EAAA,IAAA3B,GAAAtC,EAAAqC,MAAA4B,EAAAlD,WAAAR,OAAAgC,eAAA0B,IAAA7E,KAAAiD,MAAA,OAGrCC,GAAK6B,KAAOA,EACZ7B,EAAK8B,QAAUA,EACf9B,EAAKpD,GAAKA,EACVoD,EAAKS,IAAMA,EAEXT,EAAK+B,cAAe,EARiB/B,ELqQrC,MApGAnC,GAAU8D,EAAS9B,GAEnBnB,EAAaiD,EAAS,OACrBzC,IAAK,QACLd,MAAO,SKnLI4D,GACZ,IACC,GAAMC,GAAOC,KAAKC,MAAMH,EACxB,OAAO,IAAIL,IACVE,KAAMI,EAAKG,EACXN,QAASG,EAAKhF,EACdwD,IAAKwB,EAAKI,EACVzF,GAAIqF,EAAKnD,IAET,MAAM2B,GACP,KAAM,IAAIE,OAAJ,iCL2MPjC,EAAaiD,IACZzC,IAAK,QACLd,MAAO,WK9La,GAAhBxB,GAAgB0F,UAAAvD,OAAA,GAAAwD,SAAAD,UAAA,GAAAA,UAAA,GAAXZ,EAAKc,IAEf,OADAzC,MAAKnD,GAAKA,EACHA,KLmMNsC,IAAK,iBACLd,MAAO,SKjMMqC,EAAKqB,GACnB,MAAO,IAAIH,IAASE,KAAM,KAAMC,UAASrB,MAAK7D,GAAImD,KAAKnD,QLoMtDsC,IAAK,UACLd,MAAO,SKlMD0D,GACP,OAAI,EAAAN,EAAAnE,SAAY0C,KAAKnD,IACb6F,QAAQC,KAAK,sDAEjB3C,KAAKgC,aACDU,QAAQC,KAAK,gDAErB3C,KAAKgC,cAAe,MACpBhC,MAAKmB,KAAK,WAAYY,OLmMrB5C,IAAK,SACLd,MAAO,SKjMFqC,GACN,OAAI,EAAAe,EAAAnE,SAAY0C,KAAKnD,IACb6F,QAAQC,KAAK,sDAEjB3C,KAAKgC,aACDU,QAAQC,KAAK,gDAErB3C,KAAKgC,cAAe,MACpBhC,MAAKmB,KAAK,WAAYT,OLkMrBvB,IAAK,WACLd,MAAO,WK/LR,IACC,GAAM6D,IAAQG,EAAGrC,KAAK8B,KAWtB,QATK,EAAAL,EAAAnE,SAAY0C,KAAK+B,WACrBG,EAAKhF,EAAI8C,KAAK+B,UAEV,EAAAN,EAAAnE,SAAY0C,KAAKnD,MACrBqF,EAAKnD,EAAIiB,KAAKnD,KAEV,EAAA4E,EAAAnE,SAAY0C,KAAKU,OACrBwB,EAAKI,EAAItC,KAAKU,KAERyB,KAAKS,UAAUV,GACrB,MAAMxB,GACP,KAAM,IAAIE,OAAJ,oCLiMNzB,IAAK,UACLd,MAAO,WK9LC,GAAA+B,GAAAJ,KACH6C,EAAS7C,KAAK8C,YACpBD,GAAOE,QAAQ,SAAAC,GAAA,MAAS5C,GAAK6C,mBAAmBD,SLsMzCpB,GACNhC,EAAoBtC,QAEtBd,GAAQc,QKvRYsE,EAkFrBA,EAAQsB,eAAiB,OL4MnB,SAAS3G,EAAQC,GMpSvBD,EAAAC,QAAA4E,QAAA,cN0SM,SAAS7E,EAAQC,EAASE,GAE/B,YA4BA,SAAS2E,GAAwBjE,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAIkE,KAAa,IAAW,MAAPlE,EAAe,IAAK,GAAI+B,KAAO/B,GAAWc,OAAOD,UAAUsD,eAAexE,KAAKK,EAAK+B,KAAMmC,EAAOnC,GAAO/B,EAAI+B,GAAgC,OAAtBmC,GAAOhE,QAAUF,EAAYkE,EAElQ,QAASnE,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMb,GAAQ,IAAKa,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOd,GAAyB,gBAATA,IAAqC,kBAATA,GAA8Ba,EAAPb,EAElO,QAASe,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaG,aAAeC,MAAON,EAAUO,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeR,IAAYE,OAAOO,eAAiBP,OAAOO,eAAeV,EAAUC,GAAcD,EAASW,UAAYV,GAlCje,GAAIW,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWX,WAAaW,EAAWX,aAAc,EAAOW,EAAWT,cAAe,EAAU,SAAWS,KAAYA,EAAWV,UAAW,GAAML,OAAOgB,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUxB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBnB,EAAYQ,UAAWmB,GAAiBC,GAAaT,EAAiBnB,EAAa4B,GAAqB5B,MO9SjiB0F,EAAAzG,EAAA,GPkTK0G,EAAYjG,EAAuBgG,GOjTxCxD,EAAAjD,EAAA,GPqTKkD,EAAsBzC,EAAuBwC,GOpTlD0D,EAAA3G,EAAA,GPwTK4G,EAAWnG,EAAuBkG,GOvTvCE,EAAA7G,EAAA,GP2TK8G,EAAYrG,EAAuBoG,GO1TxCE,EAAA/G,EAAA,IP8TKgH,EAAavG,EAAuBsG,GO7TzC/B,EAAAhF,EAAA,GAAYiF,EPiUAN,EAAwBK,GO9T9BiC,EP0UY,SAAU7D,GOzU3B,QAAA6D,GAAY1C,EAAQR,GAAQlD,EAAAyC,KAAA2D,EAAA,IAAA1D,GAAAtC,EAAAqC,MAAA2D,EAAAjF,WAAAR,OAAAgC,eAAAyD,IAAA5G,KAAAiD,MAAA,OAG3BC,GAAKpD,GAAK8E,EAAKc,KAEfxC,EAAKgB,OAASA,EACdhB,EAAKQ,OAASA,EAEdR,EAAK2D,oBACL3D,EAAKgB,OAAOH,GAAG,UAAWb,EAAK4D,UAAU7C,KAAff,IAC1BA,EAAKgB,OAAOH,GAAG,QAASb,EAAK6D,QAAQ9C,KAAbf,IACxBA,EAAKgB,OAAOH,GAAG,QAASb,EAAK8D,QAAQ/C,KAAbf,IAExBA,EAAK+D,SAAS,KAba/D,EPoc3B,MA1HAnC,GAAU6F,EAAY7D,GAqBtBnB,EAAagF,IACZxE,IAAK,YACLd,MAAO,SOhVC6D,EAAM+B,GAAO,GAAA7D,GAAAJ,KAChBkE,EAAUd,EAAA9F,QAAQ8E,MAAMF,EAG9B,KAAKgC,EAAQrH,IAAMuG,EAAA9F,QAAQ4F,cAAciB,QAAQD,EAAQpC,QAAS,EACjE,MAAO9B,MAAKmB,KAAK+C,EAAQpC,KAAMoC,EAGhC,IAAoB,MAAhBA,EAAQpC,KAAc,IAAAsC,GACCpE,KAAK4D,iBAAiBM,EAAQrH,IAAjD0D,EADkB6D,EAClB7D,QAASC,EADS4D,EACT5D,MAEhB,IAAI0D,EAAQxD,IAAK,CAChB,GAAMA,IAAM,EAAA4C,EAAAhG,SAAO,GAAIsD,OAASsD,EAAQxD,IACxCF,GAAOE,OAEPH,GAAQ2D,EAAQnC,QAIjB,mBADO/B,MAAK4D,iBAAiBM,EAAQnE,QAAQlD,IAK9CqH,EAAQG,KAAK,WAAY,SAAAtC,GACxB3B,EAAKkE,MAAMJ,EAAQK,eAAe,KAAMxC,IACxCmC,EAAQM,YAGTN,EAAQG,KAAK,WAAY,SAAA3D,IACd,EAAAgD,EAAApG,SAASoD,IAAQA,YAAeE,QAAqB,SAAZF,EAAIoB,OAC9CpB,GAAOwD,QAASxD,EAAIwD,QAASpC,KAAM,UAC5C1B,EAAKkE,MAAMJ,EAAQK,eAAe7D,IAClCwD,EAAQM,YAGTxE,KAAKmB,KAAK+C,EAAQpC,KAAMoC,MPsVvB/E,IAAK,UACLd,MAAO,SOpVDoG,GACPzE,KAAKmB,KAAK,SAAUsD,MPuVnBtF,IAAK,UACLd,MAAO,SOrVDqG,EAAMR,GACblE,KAAKS,OAAON,MAAMwE,cAAc3E,OAEhC,EAAAwD,EAAAlG,SAAQ0C,KAAK4D,iBAAkB,SAACgB,GAC/BA,EAAUpE,OAAO,GAAII,OAAM,gCAE5BZ,KAAK4D,oBAEL5D,KAAKmB,KAAK,SAAUuD,EAAMR,MPwVzB/E,IAAK,WACLd,MAAO,SOtVAwG,GACR7E,KAAKS,OAAON,MAAM2E,IAAID,EAAU7E,SPyV/Bb,IAAK,YACLd,MAAO,SOtVCwG,GACT7E,KAAKS,OAAON,MAAM4E,OAAOF,EAAU7E,SPyVlCb,IAAK,WACLd,MAAO,WOtVR2B,KAAKS,OAAON,MAAM6E,WAAWhF,SP0V5Bb,IAAK,OACLd,MAAO,SOxVJ4G,EAAWlD,GAAS,GAAAmD,GAAAlF,KAClBkE,EAAU,GAAAd,GAAA9F,SAAawE,KAAMmD,EAAWlD,YACxCoD,EAAYjB,EAAQkB,OAC1B,OAAOpF,MACLsE,MAAMJ,GACNmB,KAAK,SAAAC,GACL,MAAO,IAAIhF,SAAQ,SAACC,EAASC,GAC5B0E,EAAKtB,iBAAiBuB,IAAc5E,UAASC,iBP6V/CrB,IAAK,QACLd,MAAO,SOzVH6F,GAAS,GAAAqB,GAAAvF,IACd,OAAO,IAAIM,SAAQ,SAACC,EAASC,GAC5B+E,EAAKtE,OAAOuE,KAAKtB,EAAQuB,WAAY,SAAA/E,GACpC,MAAIA,GAAYF,EAAOE,OACvBH,aPiWKoD,GACN/D,EAAoBtC,QO5VvBf,GAAOC,QAAUmH,GPkWX,SAASpH,EAAQC,EAASE,GAE/B,YAgBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAhBhHQ,OAAOgB,eAAe1C,EAAS,cAC9B6B,OAAO,GAGR,IAAIM,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWX,WAAaW,EAAWX,aAAc,EAAOW,EAAWT,cAAe,EAAU,SAAWS,KAAYA,EAAWV,UAAW,GAAML,OAAOgB,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUxB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBnB,EAAYQ,UAAWmB,GAAiBC,GAAaT,EAAiBnB,EAAa4B,GAAqB5B,MQ5djiB8F,EAAA7G,EAAA,GRgeK8G,EAAYrG,EAAuBoG,GQ/dxCJ,EAAAzG,EAAA,GRmeK0G,EAAYjG,EAAuBgG,GQhenBuC,ERseT,WQreX,QAAAA,GAAY5D,GAAwB,GAAlB6D,GAAkBpD,UAAAvD,OAAA,GAAAwD,SAAAD,UAAA,GAAAA,UAAA,KAAAhF,GAAAyC,KAAA0F,GACnC1F,KAAK8B,KAAOA,EACZ9B,KAAK2F,YAAcA,ERkhBnB,MArCAhH,GAAa+G,IACZvG,IAAK,MACLd,MAAO,SQ5eL6C,GACHlB,KAAK2F,YAAYzE,EAAWrE,IAAMqE,KR+ejC/B,IAAK,SACLd,MAAO,SQ7eF6C,SACClB,MAAK2F,YAAYzE,EAAWrE,ORgflCsC,IAAK,oBACLd,MAAO,SQ9eSuH,GACjB,MAAO5F,MAAK2F,YAAYC,MRifvBzG,IAAK,sBACLd,MAAO,WQ9eR,MAAOH,QAAO2H,KAAK7F,KAAK2F,aAAa3G,URkfpCG,IAAK,aACLd,MAAO,SQhfE6F,IACV,EAAAV,EAAAlG,SAAQ0C,KAAK2F,YAAa,SAAAzE,GACzBA,EAAWoD,MAAMJ,QRofjB/E,IAAK,YACLd,MAAO,SQjfC4G,EAAWlD,GACpB,GAAMmC,GAAU,GAAAd,GAAA9F,SAAawE,KAAMmD,EAAWlD,aAC9C,EAAAyB,EAAAlG,SAAQ0C,KAAK2F,YAAa,SAACzE,EAAY4E,GACtC5E,EAAWoD,MAAMJ,SRsfXwB,IAGRlJ,GAAQc,QQxhBYoI,GR4hBf,SAASnJ,EAAQC,EAASE,GAE/B,YAwBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAxBhHQ,OAAOgB,eAAe1C,EAAS,cAC9B6B,OAAO,GAGR,IAAIM,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWX,WAAaW,EAAWX,aAAc,EAAOW,EAAWT,cAAe,EAAU,SAAWS,KAAYA,EAAWV,UAAW,GAAML,OAAOgB,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUxB,EAAa2B,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBnB,EAAYQ,UAAWmB,GAAiBC,GAAaT,EAAiBnB,EAAa4B,GAAqB5B,MSxiBjiBsI,EAAArJ,EAAA,GT4iBKsJ,EAAW7I,EAAuB4I,GS3iBvCxC,EAAA7G,EAAA,GT+iBK8G,EAAYrG,EAAuBoG,GS9iBxC0C,EAAAvJ,EAAA,ITkjBKwJ,EAAQ/I,EAAuB8I,GSjjBpCE,EAAAzJ,EAAA,GTqjBK0J,EAASjJ,EAAuBgJ,GSljBhBE,ETwjBR,WSvjBZ,QAAAA,KAAc9I,EAAAyC,KAAAqG,GACbrG,KAAKG,OAASmG,IAAK,GAAAF,GAAA9I,QAAS,MTqmB5B,MAxCAqB,GAAa0H,IACZlH,IAAK,MACLd,MAAO,SS5jBLwG,EAAU3D,GACTlB,KAAKG,MAAM0E,KACd7E,KAAKG,MAAM0E,GAAY,GAAAuB,GAAA9I,QAASuH,IAEjC7E,KAAKG,MAAM0E,GAAUC,IAAI5D,MT8jBxB/B,IAAK,SACLd,MAAO,SS5jBFwG,EAAU3D,GACZlB,KAAKG,MAAM0E,KAGf7E,KAAKG,MAAM0E,GAAUE,OAAO7D,EAAWrE,IAEvB,KAAZgI,GAAoB7E,KAAKG,MAAM0E,GAAU0B,6BACrCvG,MAAKG,MAAM0E,OT6jBlB1F,IAAK,aACLd,MAAO,SS3jBE6C,GACV,OAAO,EAAAgF,EAAA5I,UAAI,EAAA0I,EAAA1I,SAAO0C,KAAKG,MAAO,SAAAqG,GAAA,MAAQA,GAAKC,kBAAkBvF,EAAWrE,MAAM,WTgkB7EsC,IAAK,UACLd,MAAO,SS9jBDmI,GACP,MAAOxG,MAAKG,MAAMqG,MTikBjBrH,IAAK,gBACLd,MAAO,SS/jBK6C,GAAY,GAAAjB,GAAAD,KACnBG,EAAQH,KAAKgF,WAAW9D,IAC9B,EAAAsC,EAAAlG,SAAQ6C,EAAO,SAAA0E,GAAA,MAAY5E,GAAKE,MAAM0E,GAAUE,OAAO7D,STukBhDmF,IAGR7J,GAAQc,QS1mBY+I,GT8mBf,SAAS9J,EAAQC,GUpnBvBD,EAAAC,QAAA4E,QAAA,kBV0nBM,SAAS7E,EAAQC,GW1nBvBD,EAAAC,QAAA4E,QAAA,kBXgoBM,SAAS7E,EAAQC,GYhoBvBD,EAAAC,QAAA4E,QAAA,oBZsoBM,SAAS7E,EAAQC,GatoBvBD,EAAAC,QAAA4E,QAAA,uBb4oBM,SAAS7E,EAAQC,Gc5oBvBD,EAAAC,QAAA4E,QAAA,edkpBM,SAAS7E,EAAQC,GelpBvBD,EAAAC,QAAA4E,QAAA","file":"server.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _uws = __webpack_require__(13);\n\t\n\tvar _connection = __webpack_require__(5);\n\t\n\tvar _connection2 = _interopRequireDefault(_connection);\n\t\n\tvar _rooms = __webpack_require__(7);\n\t\n\tvar _rooms2 = _interopRequireDefault(_rooms);\n\t\n\tvar _eventEmitterExtra = __webpack_require__(1);\n\t\n\tvar _eventEmitterExtra2 = _interopRequireDefault(_eventEmitterExtra);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Server = function (_EventEmitter) {\n\t\t_inherits(Server, _EventEmitter);\n\t\n\t\tfunction Server(options) {\n\t\t\t_classCallCheck(this, Server);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Server.__proto__ || Object.getPrototypeOf(Server)).call(this));\n\t\n\t\t\t_this.rooms = new _rooms2.default();\n\t\t\t_this.options = options;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Server, [{\n\t\t\tkey: 'start',\n\t\t\tvalue: function start() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tif (!this.options.port) {\n\t\t\t\t\tthis.server = new _uws.Server(this.options);\n\t\t\t\t\tthis.bindEvents();\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this2.server = new _uws.Server(_this2.options, function (err) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t\t_this2.bindEvents();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'stop',\n\t\t\tvalue: function stop() {\n\t\t\t\tif (!this.server) {\n\t\t\t\t\tvar err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\n\t\t\t\tthis.server.close();\n\t\t\t\tthis.server = null;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'bindEvents',\n\t\t\tvalue: function bindEvents() {\n\t\t\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onConnection',\n\t\t\tvalue: function onConnection(socket) {\n\t\t\t\tvar connection = new _connection2.default(socket, this);\n\t\t\t\tthis.emit('connection', connection);\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Server;\n\t}(_eventEmitterExtra2.default);\n\t\n\tmodule.exports = Server;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"event-emitter-extra\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/forEach\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _isUndefined = __webpack_require__(11);\n\t\n\tvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\t\n\tvar _nodeUuid = __webpack_require__(4);\n\t\n\tvar uuid = _interopRequireWildcard(_nodeUuid);\n\t\n\tvar _eventEmitterExtra = __webpack_require__(1);\n\t\n\tvar _eventEmitterExtra2 = _interopRequireDefault(_eventEmitterExtra);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Message = function (_EventEmitter) {\n\t\t_inherits(Message, _EventEmitter);\n\t\n\t\t_createClass(Message, null, [{\n\t\t\tkey: 'parse',\n\t\t\tvalue: function parse(raw) {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = JSON.parse(raw);\n\t\t\t\t\treturn new Message({\n\t\t\t\t\t\tname: data.n,\n\t\t\t\t\t\tpayload: data.p,\n\t\t\t\t\t\terr: data.e,\n\t\t\t\t\t\tid: data.i\n\t\t\t\t\t});\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not parse message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}]);\n\t\n\t\tfunction Message(_ref) {\n\t\t\tvar name = _ref.name,\n\t\t\t    payload = _ref.payload,\n\t\t\t    id = _ref.id,\n\t\t\t    err = _ref.err;\n\t\n\t\t\t_classCallCheck(this, Message);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\t\n\t\t\t_this.name = name;\n\t\t\t_this.payload = payload;\n\t\t\t_this.id = id;\n\t\t\t_this.err = err;\n\t\n\t\t\t_this.isResponded_ = false;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Message, [{\n\t\t\tkey: 'setId',\n\t\t\tvalue: function setId() {\n\t\t\t\tvar id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : uuid.v4();\n\t\n\t\t\t\tthis.id = id;\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'createResponse',\n\t\t\tvalue: function createResponse(err, payload) {\n\t\t\t\treturn new Message({ name: '_r', payload: payload, err: err, id: this.id });\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'resolve',\n\t\t\tvalue: function resolve(payload) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('resolved', payload);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'reject',\n\t\t\tvalue: function reject(err) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('rejected', err);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'toString',\n\t\t\tvalue: function toString() {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = { n: this.name };\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\t\n\t\t\t\t\treturn JSON.stringify(data);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not stringify message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'dispose',\n\t\t\tvalue: function dispose() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar events = this.eventNames();\n\t\t\t\tevents.forEach(function (event) {\n\t\t\t\t\treturn _this2.removeAllListeners(event);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Message;\n\t}(_eventEmitterExtra2.default);\n\t\n\texports.default = Message;\n\t\n\t\n\tMessage.reservedNames = ['_r'];\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"node-uuid\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _message = __webpack_require__(3);\n\t\n\tvar _message2 = _interopRequireDefault(_message);\n\t\n\tvar _eventEmitterExtra = __webpack_require__(1);\n\t\n\tvar _eventEmitterExtra2 = _interopRequireDefault(_eventEmitterExtra);\n\t\n\tvar _assign = __webpack_require__(8);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _isObject = __webpack_require__(10);\n\t\n\tvar _isObject2 = _interopRequireDefault(_isObject);\n\t\n\tvar _nodeUuid = __webpack_require__(4);\n\t\n\tvar uuid = _interopRequireWildcard(_nodeUuid);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Connection = function (_EventEmitter) {\n\t\t_inherits(Connection, _EventEmitter);\n\t\n\t\tfunction Connection(socket, server) {\n\t\t\t_classCallCheck(this, Connection);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Connection.__proto__ || Object.getPrototypeOf(Connection)).call(this));\n\t\n\t\t\t_this.id = uuid.v4();\n\t\n\t\t\t_this.socket = socket;\n\t\t\t_this.server = server;\n\t\n\t\t\t_this.promiseCallbacks = {};\n\t\t\t_this.socket.on('message', _this.onMessage.bind(_this));\n\t\t\t_this.socket.on('error', _this.onError.bind(_this));\n\t\t\t_this.socket.on('close', _this.onClose.bind(_this));\n\t\n\t\t\t_this.joinRoom('/');\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Connection, [{\n\t\t\tkey: 'onMessage',\n\t\t\tvalue: function onMessage(data, flags) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar message = _message2.default.parse(data);\n\t\n\t\t\t\t// Message without response (no id fields)\n\t\t\t\tif (!message.id && _message2.default.reservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\t\n\t\t\t\t// Message response\n\t\t\t\tif (message.name == '_r') {\n\t\t\t\t\tvar _promiseCallbacks$mes = this.promiseCallbacks[message.id],\n\t\t\t\t\t    resolve = _promiseCallbacks$mes.resolve,\n\t\t\t\t\t    reject = _promiseCallbacks$mes.reject;\n\t\n\t\n\t\t\t\t\tif (message.err) {\n\t\t\t\t\t\tvar err = (0, _assign2.default)(new Error(), message.err);\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(message.payload);\n\t\t\t\t\t}\n\t\n\t\t\t\t\tdelete this.promiseCallbacks[message.options.id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\t// Message with response\n\t\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\t\t_this2.send_(message.createResponse(null, payload));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\t\tif ((0, _isObject2.default)(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\t\t\t\t\t_this2.send_(message.createResponse(err));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tthis.emit(message.name, message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onError',\n\t\t\tvalue: function onError(error) {\n\t\t\t\tthis.emit('_error', error);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onClose',\n\t\t\tvalue: function onClose(code, message) {\n\t\t\t\tthis.server.rooms.removeFromAll(this);\n\t\n\t\t\t\t(0, _forEach2.default)(this.promiseCallbacks, function (callbacks) {\n\t\t\t\t\tcallbacks.reject(new Error('Socket connection closed!'));\n\t\t\t\t});\n\t\t\t\tthis.promiseCallbacks = {};\n\t\n\t\t\t\tthis.emit('_close', code, message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'joinRoom',\n\t\t\tvalue: function joinRoom(roomName) {\n\t\t\t\tthis.server.rooms.add(roomName, this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'leaveRoom',\n\t\t\tvalue: function leaveRoom(roomName) {\n\t\t\t\tthis.server.rooms.remove(roomName, this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRooms',\n\t\t\tvalue: function getRooms() {\n\t\t\t\tthis.server.rooms.getRoomsOf(this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send',\n\t\t\tvalue: function send(eventName, payload) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\tvar messageId = message.setId();\n\t\t\t\treturn this.send_(message).then(function (_) {\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t_this3.promiseCallbacks[messageId] = { resolve: resolve, reject: reject };\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send_',\n\t\t\tvalue: function send_(message) {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this4.socket.send(message.toString(), function (err) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Connection;\n\t}(_eventEmitterExtra2.default);\n\t\n\tmodule.exports = Connection;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _message = __webpack_require__(3);\n\t\n\tvar _message2 = _interopRequireDefault(_message);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Room = function () {\n\t\tfunction Room(name) {\n\t\t\tvar connections = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t\t\t_classCallCheck(this, Room);\n\t\n\t\t\tthis.name = name;\n\t\t\tthis.connections = connections;\n\t\t}\n\t\n\t\t_createClass(Room, [{\n\t\t\tkey: 'add',\n\t\t\tvalue: function add(connection) {\n\t\t\t\tthis.connections[connection.id] = connection;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remove',\n\t\t\tvalue: function remove(connection) {\n\t\t\t\tdelete this.connections[connection.id];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getConnectionById',\n\t\t\tvalue: function getConnectionById(connectionId) {\n\t\t\t\treturn this.connections[connectionId];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getConnectionsCount',\n\t\t\tvalue: function getConnectionsCount() {\n\t\t\t\treturn Object.keys(this.connections).length;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'broadcast_',\n\t\t\tvalue: function broadcast_(message) {\n\t\t\t\t(0, _forEach2.default)(this.connections, function (connection) {\n\t\t\t\t\tconnection.send_(message);\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'broadcast',\n\t\t\tvalue: function broadcast(eventName, payload) {\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\t(0, _forEach2.default)(this.connections, function (connection, index) {\n\t\t\t\t\tconnection.send_(message);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Room;\n\t}();\n\t\n\texports.default = Room;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _filter = __webpack_require__(9);\n\t\n\tvar _filter2 = _interopRequireDefault(_filter);\n\t\n\tvar _forEach = __webpack_require__(2);\n\t\n\tvar _forEach2 = _interopRequireDefault(_forEach);\n\t\n\tvar _map = __webpack_require__(12);\n\t\n\tvar _map2 = _interopRequireDefault(_map);\n\t\n\tvar _room = __webpack_require__(6);\n\t\n\tvar _room2 = _interopRequireDefault(_room);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Rooms = function () {\n\t\tfunction Rooms() {\n\t\t\t_classCallCheck(this, Rooms);\n\t\n\t\t\tthis.rooms = { '/': new _room2.default('/') };\n\t\t}\n\t\n\t\t_createClass(Rooms, [{\n\t\t\tkey: 'add',\n\t\t\tvalue: function add(roomName, connection) {\n\t\t\t\tif (!this.rooms[roomName]) this.rooms[roomName] = new _room2.default(roomName);\n\t\n\t\t\t\tthis.rooms[roomName].add(connection);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remove',\n\t\t\tvalue: function remove(roomName, connection) {\n\t\t\t\tif (!this.rooms[roomName]) return;\n\t\n\t\t\t\tthis.rooms[roomName].remove(connection.id);\n\t\n\t\t\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount()) delete this.rooms[roomName];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRoomsOf',\n\t\t\tvalue: function getRoomsOf(connection) {\n\t\t\t\treturn (0, _map2.default)((0, _filter2.default)(this.rooms, function (room) {\n\t\t\t\t\treturn room.getConnectionById(connection.id);\n\t\t\t\t}), 'name');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getRoom',\n\t\t\tvalue: function getRoom(room) {\n\t\t\t\treturn this.rooms[room];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'removeFromAll',\n\t\t\tvalue: function removeFromAll(connection) {\n\t\t\t\tvar _this = this;\n\t\n\t\t\t\tvar rooms = this.getRoomsOf(connection);\n\t\t\t\t(0, _forEach2.default)(rooms, function (roomName) {\n\t\t\t\t\treturn _this.rooms[roomName].remove(connection);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Rooms;\n\t}();\n\t\n\texports.default = Rooms;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/filter\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/isObject\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/map\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"uws\");\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2780ac7dffd16a32a39a","import {Server as WebSocketServer} from 'uws';\nimport Connection from './connection';\nimport Rooms from './rooms';\nimport EventEmitter from 'event-emitter-extra';\n\n\nclass Server extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\t\tthis.rooms = new Rooms();\n\t\tthis.options = options;\n\t}\n\n\tstart() {\n\t\tif (!this.options.port) {\n\t\t\tthis.server = new WebSocketServer(this.options);\n\t\t\tthis.bindEvents();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.server = new WebSocketServer(this.options, err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tthis.bindEvents();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\n\tstop() {\n\t\tif (!this.server) {\n\t\t\tconst err = new Error('Could not stop server. Server is probably not started, or already stopped.');\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\tthis.server.close();\n\t\tthis.server = null;\n\t\treturn Promise.resolve();\n\t}\n\n\n\tbindEvents() {\n\t\tthis.server.on('connection', this.onConnection.bind(this));\n\t}\n\n\tonConnection(socket) {\n\t\tconst connection = new Connection(socket, this);\n\t\tthis.emit('connection', connection);\n\t}\n}\n\nmodule.exports = Server;\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"event-emitter-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 2\n// module chunks = 0","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 4\n// module chunks = 0","import Message from '../lib/message';\nimport EventEmitter from 'event-emitter-extra';\nimport assign from 'lodash/assign';\nimport forEach from 'lodash/forEach';\nimport isObject from 'lodash/isObject';\nimport * as uuid from 'node-uuid';\n\n\nclass Connection extends EventEmitter {\n\tconstructor(socket, server) {\n\t\tsuper();\n\n\t\tthis.id = uuid.v4();\n\n\t\tthis.socket = socket;\n\t\tthis.server = server;\n\n\t\tthis.promiseCallbacks = {};\n\t\tthis.socket.on('message', this.onMessage.bind(this));\n\t\tthis.socket.on('error', this.onError.bind(this));\n\t\tthis.socket.on('close', this.onClose.bind(this));\n\n\t\tthis.joinRoom('/');\n\t}\n\n\n\tonMessage(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Message response\n\t\tif (message.name == '_r') {\n\t\t\tconst {resolve, reject} = this.promiseCallbacks[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = assign(new Error(), message.err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks[message.options.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\tonError(error) {\n\t\tthis.emit('_error', error);\n\t}\n\n\tonClose(code, message) {\n\t\tthis.server.rooms.removeFromAll(this);\n\n\t\tforEach(this.promiseCallbacks, (callbacks) => {\n\t\t\tcallbacks.reject(new Error('Socket connection closed!'));\n\t\t});\n\t\tthis.promiseCallbacks = {};\n\n\t\tthis.emit('_close', code, message);\n\t}\n\n\tjoinRoom(roomName) {\n\t\tthis.server.rooms.add(roomName, this);\n\t}\n\n\n\tleaveRoom(roomName) {\n\t\tthis.server.rooms.remove(roomName, this);\n\t}\n\n\tgetRooms() {\n\t\tthis.server.rooms.getRoomsOf(this);\n\t}\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.promiseCallbacks[messageId] = {resolve, reject};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\nmodule.exports = Connection;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/connection.js","import forEach from 'lodash/forEach';\nimport Message from '../lib/message';\n\n\nexport default class Room {\n\tconstructor(name, connections = {}) {\n\t\tthis.name = name;\n\t\tthis.connections = connections;\n\t}\n\n\tadd(connection) {\n\t\tthis.connections[connection.id] = connection;\n\t}\n\n\tremove(connection) {\n\t\tdelete this.connections[connection.id];\n\t}\n\n\tgetConnectionById(connectionId) {\n\t\treturn this.connections[connectionId];\n\t}\n\n\tgetConnectionsCount() {\n\t\treturn Object.keys(this.connections).length;\n\t}\n\n\tbroadcast_(message) {\n\t\tforEach(this.connections, connection => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n\n\tbroadcast(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tforEach(this.connections, (connection, index) => {\n\t\t\tconnection.send_(message)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/room.js","import filter from 'lodash/filter';\nimport forEach from 'lodash/forEach';\nimport map from 'lodash/map';\nimport Room from './room';\n\n\nexport default class Rooms {\n\tconstructor() {\n\t\tthis.rooms = {'/': new Room('/')};\n\t}\n\n\tadd(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\tthis.rooms[roomName] = new Room(roomName);\n\n\t\tthis.rooms[roomName].add(connection);\n\t}\n\n\tremove(roomName, connection) {\n\t\tif(!this.rooms[roomName])\n\t\t\treturn;\n\n\t\tthis.rooms[roomName].remove(connection.id);\n\n\t\tif (roomName != '/' && !this.rooms[roomName].getConnectionsCount())\n\t\t\tdelete this.rooms[roomName];\n\t}\n\n\tgetRoomsOf(connection) {\n\t\treturn map(filter(this.rooms, room => room.getConnectionById(connection.id)), 'name');\n\t}\n\n\tgetRoom(room) {\n\t\treturn this.rooms[room];\n\t}\n\n\tremoveFromAll(connection) {\n\t\tconst rooms = this.getRoomsOf(connection);\n\t\tforEach(rooms, roomName => this.rooms[roomName].remove(connection));\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/rooms.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 13\n// module chunks = 0"],"sourceRoot":""}