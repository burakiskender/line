{"version":3,"sources":["webpack:///webpack/bootstrap 311e106aab86a94efc4e","webpack:///./src/lib/utils.js","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///external \"lodash/isObject\"","webpack:///./src/client/client-web.js","webpack:///external \"uws\"","webpack:///./src/lib/deferred.js","webpack:///./src/lib/message.js","webpack:///external \"debug\"","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/debounce\"","webpack:///external \"lodash/isBoolean\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/values\"","webpack:///./src/client/client-node.js"],"names":["assign","require","promiseDelay","ms","Promise","setTimeout","resolve","retry","task","options","defaults","maxDelay","maxCount","initialDelay","increaseFactor","timeout","counter","delay","once","catch","clearTimeout","err","then","generateDummyId","length","Math","random","pow","toString","slice","module","exports","Message","Utils","EventEmitterExtra","Deferred","debounce","isObject","isBoolean","debug","Client","url","ws_","id","reconnect","reconnectDisabled_","serverTimeout_","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","pingInterval","deferreds_","connectDeferred_","connectError_","disconnectDeferred_","state","States","READY","uptimeInterval_","uptimeBuffer_","uptimeBufferLength_","uptimeCheck_","keepUptime","setInterval","uptimeTick_","bind","autoPing_","CONNECTED","ping","CONNECTING","reject","Error","CLOSING","CLOSED","handler","emit","Events","WebSocket","bindEvents_","code","reason","opt_retry","ERROR","close","onopen","onOpen","onclose","onClose","onerror","onError","onmessage","onMessage","send","Names","HANDSHAKE","handshakePayload","data","disconnect","console","log","unBindEvents_","retrying_","connect","eventName","CONNECTING_ERROR","e","message","parse","ReservedNames","indexOf","name","PING","onPing_","RESPONSE","deferred","Object","payload","send_","createResponse","dispose","setId","onExpire","push","splice","filter","val","removeAllListeners","clearInterval","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","args","apply","isUndefined","isFunction","values","raw","JSON","n","p","i","isResponded_","warn","stringify","events","eventNames","forEach","event","global","WebClient","NodeClient","on"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;AC9DA,IAAMA,SAAS,mBAAAC,CAAQ,CAAR,CAAf;;AAGA,SAASC,YAAT,CAAsBC,EAAtB,EAA0B;AACtB,WAAO,IAAIC,OAAJ,CAAY;AAAA,eAAWC,WAAW;AAAA,mBAAKC,SAAL;AAAA,SAAX,EAA2BH,EAA3B,CAAX;AAAA,KAAZ,CAAP;AACH;;AAGD,SAASI,KAAT,CAAeC,IAAf,EAAmC;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AAC/B,QAAMC,WAAW,EAACC,UAAU,GAAX,EAAgBC,UAAU,CAA1B,EAA6BC,cAAc,CAA3C,EAA8CC,gBAAgB,CAA9D,EAAjB;AACAL,cAAUT,OAAOU,QAAP,EAAiBD,OAAjB,CAAV;AACA,QAAIM,gBAAJ;AACA,QAAIC,UAAU,CAAd;AACA,QAAIC,QAAQR,QAAQI,YAApB;;AAEA,QAAMK,OAAO,SAAPA,IAAO,GAAW;AACpB,eAAOV,OACFW,KADE,CACI,eAAO;AACVH;AACAC,oBAAQA,QAAQR,QAAQK,cAAxB;;AAEA,gBAAIL,QAAQG,QAAR,IAAoB,CAApB,IAAyBI,UAAUP,QAAQG,QAA/C,EAAyD;AACrDG,2BAAWK,aAAaL,OAAb,CAAX;AACA,sBAAMM,GAAN;AACH;AACD,mBAAOnB,aAAae,QAAQ,IAAR,GAAe,CAA5B,EAA+BK,IAA/B,CAAoC;AAAA,uBAAKJ,MAAL;AAAA,aAApC,CAAP;AACH,SAVE,CAAP;AAWH,KAZD;;AAcA,WAAOA,MAAP;AACH;;AAGD;AACA,SAASK,eAAT,GAAqC;AAAA,QAAZC,MAAY,uEAAH,CAAG;;AACjC,WAAO,CAAC,SAAS,CAACC,KAAKC,MAAL,KAAcD,KAAKE,GAAL,CAAS,EAAT,EAAYH,MAAZ,CAAd,IAAqC,CAAtC,EAAyCI,QAAzC,CAAkD,EAAlD,CAAV,EAAiEC,KAAjE,CAAuE,CAACL,MAAxE,CAAP;AACH;;AAGDM,OAAOC,OAAP,GAAiB,EAAC7B,0BAAD,EAAeK,YAAf,EAAsBgB,gCAAtB,EAAjB,C;;;;;;ACvCA,qE;;;;;;ACAA,4C;;;;;;;;;;;;;;;;;ACAA,IAAMS,UAAU,mBAAA/B,CAAQ,CAAR,CAAhB;AACA,IAAMgC,QAAQ,mBAAAhC,CAAQ,CAAR,CAAd;AACA,IAAMiC,oBAAoB,mBAAAjC,CAAQ,CAAR,CAA1B;AACA,IAAMkC,WAAW,mBAAAlC,CAAQ,CAAR,CAAjB;AACA,IAAMmC,WAAW,mBAAAnC,CAAQ,CAAR,CAAjB;AACA,IAAMoC,WAAW,mBAAApC,CAAQ,CAAR,CAAjB;AACA,IAAMqC,YAAY,mBAAArC,CAAQ,EAAR,CAAlB;AACA,IAAMsC,QAAQ,mBAAAtC,CAAQ,CAAR,EAAiB,iBAAjB,CAAd;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA6BMuC,M;;;AACF,sBAAkD;AAAA,YAAtCC,GAAsC,uEAAhC,gBAAgC;AAAA,YAAdhC,OAAc,uEAAJ,EAAI;;AAAA;;AAAA;;AAG9C,cAAKgC,GAAL,GAAWA,GAAX;;AAEA,cAAKhC,OAAL,GAAeA,OAAf;;AAEA,cAAKiC,GAAL,GAAW,IAAX;AACA,cAAKC,EAAL,GAAU,IAAV;AACA,cAAKC,SAAL,GAAiBN,UAAU7B,QAAQmC,SAAlB,IAA+BnC,QAAQmC,SAAvC,GAAmD,IAApE;AACA,cAAKC,kBAAL,GAA0B,KAA1B;;AAEA,cAAKC,cAAL,GAAsB,KAAtB;AACA,cAAKC,iBAAL,GAAyB,EAAzB;AACA,cAAKC,qBAAL,GAA6B,CAA7B;AACA,cAAKC,wBAAL,GAAgC,CAAhC;AACA,cAAKC,YAAL,GAAoB,KAApB;;AAEA,cAAKC,UAAL,GAAkB,EAAlB;AACA,cAAKC,gBAAL,GAAwB,IAAxB;AACA,cAAKC,aAAL,GAAqB,IAArB;AACA,cAAKC,mBAAL,GAA2B,IAA3B;;AAGA,cAAKC,KAAL,GAAaf,OAAOgB,MAAP,CAAcC,KAA3B;;AAEA,cAAKC,eAAL,GAAuB,IAAvB;AACA,cAAKC,aAAL,GAAqB,EAArB;AACA,cAAKC,mBAAL,GAA2B,IAAI,KAAJ,GAAY,MAAKF,eAA5C;AACA,cAAKG,YAAL,GAAoBpD,QAAQqD,UAAR,GAAqBC,YAAY,MAAKC,WAAL,CAAiBC,IAAjB,OAAZ,EAAyC,MAAKP,eAA9C,CAArB,GAAsF,IAA1G;;AAEA,cAAKQ,SAAL,GAAiB,MAAKhB,YAAL,GAAoB,CAApB,GACbd,SAAS,YAAM;AACX,gBAAI,MAAKmB,KAAL,IAAcf,OAAOgB,MAAP,CAAcW,SAAhC,EACI;;AAEJ,kBACKC,IADL,GAEK9C,IAFL,CAEU,YAAM;AACR,oBAAI,MAAK4B,YAAL,GAAoB,CAApB,IAAyB,MAAKK,KAAL,IAAcf,OAAOgB,MAAP,CAAcW,SAAzD,EAAoE;AAChE,0BAAKD,SAAL;AACH;AACJ,aANL,EAOK/C,KAPL,CAOW,YAAM,CAAE,CAPnB;AAQH,SAZD,EAYG,MAAK+B,YAZR,CADa,GAcb,YAAM,CAAE,CAdZ;AA/B8C;AA8CjD;;AAGD;;;;;;;;;;;;;;;;;;;kCAeU;AAAA;;AACN,oBAAQ,KAAKK,KAAb;AACI,qBAAKf,OAAOgB,MAAP,CAAca,UAAnB;AACI,2BAAOjE,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,2DAAV,CAAf,CAAP;AACJ,qBAAK/B,OAAOgB,MAAP,CAAcW,SAAnB;AACI,2BAAO/D,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,oBAAV,CAAf,CAAP;AACJ,qBAAK/B,OAAOgB,MAAP,CAAcgB,OAAnB;AACI,2BAAOpE,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,oDAAV,CAAf,CAAP;AACJ,qBAAK/B,OAAOgB,MAAP,CAAciB,MAAnB;AACA,qBAAKjC,OAAOgB,MAAP,CAAcC,KAAnB;AACI,yBAAKJ,aAAL,GAAqB,IAArB;AACA,yBAAKD,gBAAL,GAAwB,IAAIjB,QAAJ,CAAa;AACjCuC,iCAAS,mBAAM;AACX,mCAAKnB,KAAL,GAAaf,OAAOgB,MAAP,CAAca,UAA3B;AACA,mCAAKM,IAAL,CAAUnC,OAAOoC,MAAP,CAAcP,UAAxB;AACA,mCAAKxB,kBAAL,GAA0B,KAA1B;;AAEAxC,uCAAW,aAAK;AACZkC,0DAAwB,OAAKE,GAA7B;AACA,uCAAKC,GAAL,GAAW,IAAImC,SAAJ,CAAc,OAAKpC,GAAnB,CAAX;AACA,uCAAKqC,WAAL;AACH,6BAJD,EAIG,CAJH;AAKH;AAXgC,qBAAb,CAAxB;;AAcA,2BAAO,KAAK1B,gBAAZ;AACJ;AACI,2BAAOhD,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,mCAAV,CAAf,CAAP;AA1BR;AA4BH;;AAGD;;;;;;;;;;;;;;;;;;;;;mCAkBWQ,I,EAAMC,M,EAAQC,S,EAAW;AAChC,oBAAQ,KAAK1B,KAAb;AACI,qBAAKf,OAAOgB,MAAP,CAAc0B,KAAnB;AACA,qBAAK1C,OAAOgB,MAAP,CAAcW,SAAnB;AACA,qBAAK3B,OAAOgB,MAAP,CAAca,UAAnB;AACI9B,0BAAM,kBAAN;AACA,yBAAKG,GAAL,CAASyC,KAAT,CAAeJ,QAAQ,IAAvB,EAA6BC,MAA7B;AACAzC,0BAAM,mBAAN;AACA,yBAAKM,kBAAL,GAA0B,CAACoC,SAA3B;AACA,yBAAK3B,mBAAL,GAA2B,IAAInB,QAAJ,EAA3B;AACA,yBAAKoB,KAAL,GAAaf,OAAOgB,MAAP,CAAcgB,OAA3B;AACA,2BAAO,KAAKlB,mBAAZ;AACJ,qBAAKd,OAAOgB,MAAP,CAAciB,MAAnB;AACI,2BAAOrE,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,uCAAV,CAAf,CAAP;AACJ,qBAAK/B,OAAOgB,MAAP,CAAcgB,OAAnB;AACI,2BAAOpE,QAAQkE,MAAR,CAAe,IAAIC,KAAJ,CAAU,oDAAV,CAAf,CAAP;AAdR;AAgBH;;;sCAGa;AACVhC,kBAAM,gCAAN;AACA,iBAAKG,GAAL,CAAS0C,MAAT,GAAkB,KAAKC,MAAL,CAAYpB,IAAZ,CAAiB,IAAjB,CAAlB;AACA,iBAAKvB,GAAL,CAAS4C,OAAT,GAAmB,KAAKC,OAAL,CAAatB,IAAb,CAAkB,IAAlB,CAAnB;AACA,iBAAKvB,GAAL,CAAS8C,OAAT,GAAmB,KAAKC,OAAL,CAAaxB,IAAb,CAAkB,IAAlB,CAAnB;AACA,iBAAKvB,GAAL,CAASgD,SAAT,GAAqB,KAAKC,SAAL,CAAe1B,IAAf,CAAoB,IAApB,CAArB;AACH;;;wCAGe;AACZ,gBAAI,CAAC,KAAKvB,GAAV,EAAe;AACfH,kBAAM,kCAAN;AACA,iBAAKG,GAAL,CAAS0C,MAAT,GAAkB,YAAW,CAAE,CAA/B;AACA,iBAAK1C,GAAL,CAAS4C,OAAT,GAAmB,YAAW,CAAE,CAAhC;AACA,iBAAK5C,GAAL,CAAS8C,OAAT,GAAmB,YAAW,CAAE,CAAhC;AACA,iBAAK9C,GAAL,CAASgD,SAAT,GAAqB,YAAW,CAAE,CAAlC;AACH;;;sDAG6B;AAC1BnD,kBAAM,mCAAN;AACA,gBAAI,KAAKa,gBAAT,EAA2B;AACvBb,sBAAM,8BAAN;AACA,qBAAKa,gBAAL,CAAsBkB,MAAtB,CAA6B,KAAKjB,aAAlC;AACA,qBAAKD,gBAAL,GAAwB,IAAxB;AACA,qBAAKC,aAAL,GAAqB,IAArB;AACH;;AAED,gBAAI,KAAKC,mBAAT,EAA8B;AAC1Bf,sBAAM,iCAAN;AACA,qBAAKe,mBAAL,CAAyBgB,MAAzB;AACA,qBAAKhB,mBAAL,GAA2B,IAA3B;AACH;AACJ;;;iCAGQ;AAAA;;AACLf,kBAAM,+BAAN;AACAA,6BAAe,KAAKgB,KAApB;AACAhB,kBAAM,2BAAN;AACA,iBAAKqD,IAAL,CAAU5D,QAAQ6D,KAAR,CAAcC,SAAxB,EAAmC,KAAKrF,OAAL,CAAasF,gBAAhD,EACKzE,IADL,CACU,gBAAQ;AACViB,sBAAM,uBAAN;AACA,uBAAKI,EAAL,GAAUqD,KAAKrD,EAAf;AACA,uBAAKG,cAAL,GAAsBkD,KAAKjF,OAA3B;AACA,uBAAKgC,iBAAL,GAAyBiD,KAAKjD,iBAA9B;AACA,uBAAKC,qBAAL,GAA6BgD,KAAKhD,qBAAlC;AACA,uBAAKC,wBAAL,GAAgC+C,KAAK/C,wBAArC;AACA,uBAAKC,YAAL,GAAoB8C,KAAK9C,YAAzB;;AAEA,oBAAI,OAAKE,gBAAT,EAA2B;AACvBb,0BAAM,8BAAN;AACA,2BAAKa,gBAAL,CAAsB9C,OAAtB,CAA8B0F,KAAKD,gBAAnC;AACA,2BAAK3C,gBAAL,GAAwB,IAAxB;AACA,2BAAKC,aAAL,GAAqB,IAArB;AACH;;AAED,uBAAKE,KAAL,GAAaf,OAAOgB,MAAP,CAAcW,SAA3B;AACA5B,sBAAM,+BAAN;AACA,uBAAKoC,IAAL,CAAUnC,OAAOoC,MAAP,CAAcT,SAAxB,EAAmC6B,KAAKD,gBAAxC;AACH,aApBL,EAqBK5E,KArBL,CAqBW,eAAO;AACVoB,sBAAM,mBAAN;AACA,uBAAKc,aAAL,GAAqBhC,GAArB;AACAkB,sBAAM,2BAAN;AACA,uBAAKoC,IAAL,CAAUnC,OAAOoC,MAAP,CAAcM,KAAxB,EAA+B7D,GAA/B;AACA,uBAAO,OAAK4E,UAAL,EAAP;AACH,aA3BL,EA4BK9E,KA5BL,CA4BW,eAAO;AACVoB,sBAAM,+CAAN;AACA2D,wBAAQC,GAAR,CAAY,6CAAZ,EAA2D9E,GAA3D;AACH,aA/BL;AAgCH;;;gCAGOA,G,EAAK;AAAA;;AACTkB,kBAAM,gCAAN;AACAA,6BAAe,KAAKgB,KAApB;AACA,iBAAK6C,aAAL;AACA,iBAAKzD,EAAL,GAAU,IAAV;AACA,iBAAKD,GAAL,GAAW,IAAX;;AAEAH,kBAAM,4BAAN;AACA,iBAAKoC,IAAL,CAAUnC,OAAOoC,MAAP,CAAcH,MAAxB,EAAgCpD,GAAhC;;AAEA,oBAAO,KAAKkC,KAAZ;AACI,qBAAKf,OAAOgB,MAAP,CAAcgB,OAAnB;AACI,yBAAKjB,KAAL,GAAaf,OAAOgB,MAAP,CAAciB,MAA3B;;AAEA,wBAAI,KAAKnB,mBAAT,EAA8B;AAC1Bf,8BAAM,iCAAN;AACA,6BAAKe,mBAAL,CAAyBhD,OAAzB;AACA,6BAAKgD,mBAAL,GAA2B,IAA3B;AACH;;AAED,wBAAI,KAAKF,gBAAT,EAA2B;AACvBb,8BAAM,8BAAN;AACA,6BAAKa,gBAAL,CAAsBkB,MAAtB,CAA6B,KAAKjB,aAAL,IAAsB,IAAIkB,KAAJ,CAAU,uCAAV,CAAnD;AACA,6BAAKnB,gBAAL,GAAwB,IAAxB;AACA,6BAAKC,aAAL,GAAqB,IAArB;AACH;;AAED,wBAAI,CAAC,KAAKT,SAAN,IAAmB,KAAKyD,SAAxB,IAAqC,KAAKxD,kBAA9C,EACI;;AAEJ;AACJ,qBAAKL,OAAOgB,MAAP,CAAca,UAAnB;AACI,yBAAKd,KAAL,GAAaf,OAAOgB,MAAP,CAAciB,MAA3B;;AAEA,wBAAI,KAAKnB,mBAAT,EAA8B;AAC1Bf,8BAAM,iCAAN;AACA,6BAAKe,mBAAL,CAAyBgB,MAAzB,CAAgC,IAAIC,KAAJ,CAAU,sBAAV,CAAhC;AACA,6BAAKjB,mBAAL,GAA2B,IAA3B;AACH;;AAED,wBAAI,CAAC,KAAKV,SAAN,IAAmB,KAAKyD,SAAxB,IAAqC,KAAKxD,kBAA9C,EAAkE;AAC9D,4BAAI,KAAKO,gBAAT,EAA2B;AACvBb,kCAAM,8BAAN;AACA,iCAAKa,gBAAL,CAAsBkB,MAAtB,CAA6B,KAAKjB,aAAlC;AACA,iCAAKD,gBAAL,GAAwB,IAAxB;AACA,iCAAKC,aAAL,GAAqB,IAArB;AACH;AACD;AACH;;AAED;AACJ;AACI,yBAAKE,KAAL,GAAaf,OAAOgB,MAAP,CAAciB,MAA3B;;AAEA,wBAAI,KAAKnB,mBAAT,EAA8B;AAC1Bf,8BAAM,iCAAN;AACA,6BAAKe,mBAAL,CAAyBgB,MAAzB,CAAgC,IAAIC,KAAJ,CAAU,sBAAV,CAAhC;AACA,6BAAKjB,mBAAL,GAA2B,IAA3B;AACH;;AAED,wBAAI,KAAKF,gBAAT,EAA2B;AACvBb,8BAAM,8BAAN;AACA,6BAAKa,gBAAL,CAAsBkB,MAAtB,CAA6B,IAAIC,KAAJ,CAAU,mBAAV,CAA7B;AACA,6BAAKnB,gBAAL,GAAwB,IAAxB;AACA,6BAAKC,aAAL,GAAqB,IAArB;AACH;;AAED,wBAAI,CAAC,KAAKT,SAAN,IAAmB,KAAKyD,SAAxB,IAAqC,KAAKxD,kBAA9C,EACI;AA1DZ;AA4DAN,kBAAM,wBAAN;AACA,iBAAK8D,SAAL,GAAiB,IAAjB;AACApE,kBACK1B,KADL,CAEQ;AAAA,uBAAK,OAAK+F,OAAL,EAAL;AAAA,aAFR,EAGQ;AACI1F,0BAAU,KAAKmC,iBADnB;AAEIlC,8BAAc,KAAKmC,qBAFvB;AAGIlC,gCAAgB,KAAKmC;AAHzB,aAHR,EAQK3B,IARL,CAQU,aAAK;AACPiB,sBAAM,mBAAN;AACA,uBAAK8D,SAAL,GAAiB,KAAjB;AACH,aAXL;AAYH;;;gCAGOhF,G,EAAK;AACTkB,kBAAM,gCAAN;AACAA,6BAAe,KAAKgB,KAApB;;AAEA,gBAAMgD,YAAY,KAAKhD,KAAL,IAAcf,OAAOgB,MAAP,CAAca,UAA5B,GACV7B,OAAOoC,MAAP,CAAc4B,gBADJ,GACuBhE,OAAOoC,MAAP,CAAcM,KADvD;;AAGA,iBAAKP,IAAL,CAAU4B,SAAV,EAAqBlF,OAAO,IAAIkD,KAAJ,CAAU,eAAV,CAA5B;AACH;;;kCAGSkC,C,EAAG;AAAA;;AACTlE,kBAAM,kCAAN;;AAEA,gBAAMmE,UAAU1E,QAAQ2E,KAAR,CAAcF,EAAET,IAAhB,CAAhB;AACA,iBAAK9B,SAAL;;AAEA;AACA,gBAAI,CAACwC,QAAQ/D,EAAT,IAAeX,QAAQ4E,aAAR,CAAsBC,OAAtB,CAA8BH,QAAQI,IAAtC,KAA+C,CAAC,CAAnE,EAAsE;AAClEvE,2DAAyCmE,QAAQI,IAAjD;AACA,uBAAO,KAAKnC,IAAL,CAAU+B,QAAQI,IAAlB,EAAwBJ,OAAxB,CAAP;AACH;;AAED;AACA,gBAAIA,QAAQI,IAAR,IAAgB9E,QAAQ6D,KAAR,CAAckB,IAAlC,EAAwC;AACpC,uBAAO,KAAKC,OAAL,CAAaN,OAAb,CAAP;AACH;;AAED;AACA,gBAAIA,QAAQI,IAAR,IAAgB9E,QAAQ6D,KAAR,CAAcoB,QAA9B,IAA0C,KAAK9D,UAAL,CAAgBuD,QAAQ/D,EAAxB,CAA9C,EAA2E;AACvE,oBAAMuE,WAAW,KAAK/D,UAAL,CAAgBuD,QAAQ/D,EAAxB,CAAjB;AACAJ,mDAAiCmE,QAAQI,IAAzC,cAAsDJ,QAAQ/D,EAA9D;AACA,oBAAI+D,QAAQrF,GAAZ,EAAiB;AACb,wBAAMA,MAAM8F,OAAOnH,MAAP,CAAc,IAAIuE,KAAJ,EAAd,EAA2BmC,QAAQrF,GAAnC,CAAZ;AACA6F,6BAAS5C,MAAT,CAAgBjD,GAAhB;AACH,iBAHD,MAGO;AACH6F,6BAAS5G,OAAT,CAAiBoG,QAAQU,OAAzB;AACH;;AAED,uBAAO,KAAKjE,UAAL,CAAgBuD,QAAQ/D,EAAxB,CAAP;AACA;AACH;;AAEDJ,oDAAsCmE,QAAQI,IAA9C,cAA2DJ,QAAQ/D,EAAnE;AACA;AACA+D,oBAAQxF,IAAR,CAAa,UAAb,EAAyB,mBAAW;AAChCqB,mDAAiCmE,QAAQI,IAAzC,cAAsDJ,QAAQ/D,EAA9D;AACA,uBAAK0E,KAAL,CAAWX,QAAQY,cAAR,CAAuB,IAAvB,EAA6BF,OAA7B,CAAX;AACAV,wBAAQa,OAAR;AACH,aAJD;;AAMAb,oBAAQxF,IAAR,CAAa,UAAb,EAAyB,eAAO;AAC5B,oBAAImB,SAAShB,GAAT,KAAiBA,eAAekD,KAAhC,IAAyClD,IAAIyF,IAAJ,IAAY,OAAzD,EACGzF,MAAM,EAACqF,SAASrF,IAAIqF,OAAd,EAAuBI,MAAM,OAA7B,EAAN;AACHvE,mDAAiCmE,QAAQI,IAAzC,cAAsDJ,QAAQ/D,EAA9D;AACA,uBAAK0E,KAAL,CAAWX,QAAQY,cAAR,CAAuBjG,GAAvB,CAAX;AACAqF,wBAAQa,OAAR;AACH,aAND;;AAQA,iBAAK5C,IAAL,CAAU+B,QAAQI,IAAlB,EAAwBJ,OAAxB;AACH;;;gCAGOA,O,EAAS;AACbnE,kBAAM,eAAN;AACA,iBACK8E,KADL,CACWX,QAAQY,cAAR,CAAuB,IAAvB,EAA6B,MAA7B,CADX,EAEKnG,KAFL,CAEW,eAAO;AACV+E,wBAAQC,GAAR,CAAY,8BAAZ,EAA4C9E,GAA5C;AACH,aAJL;AAKH;;AAGD;;;;;;;;;;;;;;;;;;;6BAgBKkF,S,EAAWa,O,EAAS;AAAA;;AACrB,gBAAMV,UAAU,IAAI1E,OAAJ,CAAY,EAAC8E,MAAMP,SAAP,EAAkBa,gBAAlB,EAAZ,CAAhB;AACAV,oBAAQc,KAAR;;AAEA,mBAAO,KACFH,KADE,CACIX,OADJ,EAEFpF,IAFE,CAEG,aAAK;AACP,oBAAM4F,WAAW,OAAK/D,UAAL,CAAgBuD,QAAQ/D,EAAxB,IAA8B,IAAIR,QAAJ,CAAa;AACxDsF,8BAAU,oBAAM;AACZ,+BAAO,OAAKtE,UAAL,CAAgBuD,QAAQ/D,EAAxB,CAAP;AACH,qBAHuD;AAIxD5B,6BAAS,OAAK+B;AAJ0C,iBAAb,CAA/C;;AAOA,uBAAOoE,QAAP;AACH,aAXE,CAAP;AAYH;;AAGD;;;;;;;;;;;;;;;;;;;4CAgBoBX,S,EAAWa,O,EAAS;AACpC,gBAAMV,UAAU,IAAI1E,OAAJ,CAAY,EAAC8E,MAAMP,SAAP,EAAkBa,gBAAlB,EAAZ,CAAhB;AACA,mBAAO,KAAKC,KAAL,CAAWX,OAAX,CAAP;AACH;;;8BAGKA,O,EAAS;AAAA;;AACX,mBAAO,IAAItG,OAAJ,CAAY,mBAAW;AAC1BmC,4CAA0BmE,QAAQ9E,QAAR,EAA1B;AACA,uBAAKc,GAAL,CAASkD,IAAT,CAAcc,QAAQ9E,QAAR,EAAd;AACAtB;AACH,aAJM,CAAP;AAKH;;AAGD;;;;;;;;;+BAMO;AAAA;;AACHiC,kBAAM,YAAN;AACA,mBAAO,KACFqD,IADE,CACG5D,QAAQ6D,KAAR,CAAckB,IADjB,EAEF5F,KAFE,CAEI,eAAO;AACVoB,sBAAM,6CAAN;AACA,uBAAK0D,UAAL,CAAgB,IAAhB,EAAsB,kBAAtB,EAA0C,IAA1C;AACA,sBAAM5E,GAAN;AACH,aANE,CAAP;AAOH;;;sCAGa;AACVkB,kBAAM,eAAN;AACA,iBAAKoB,aAAL,CAAmB+D,IAAnB,CAAwB,KAAKnE,KAAL,IAAcf,OAAOgB,MAAP,CAAcW,SAApD;;AAEA,gBAAI,KAAKR,aAAL,CAAmBnC,MAAnB,GAA4B,KAAKoC,mBAArC,EAA0D;AACtD,qBAAKD,aAAL,CAAmBgE,MAAnB,CAA0B,CAA1B,EAA6B,KAAK/D,mBAAL,GAA2B,KAAKD,aAAL,CAAmBnC,MAA3E;AACH;AACJ;;AAGD;;;;;;;;;oCAMY;AACR,gBAAI,CAAC,KAAKf,OAAL,CAAaqD,UAAlB,EAA8B,OAAO,IAAP;AAC9B,gBAAI,KAAKH,aAAL,CAAmBnC,MAAnB,IAA6B,CAAjC,EAAoC,OAAO,CAAP;AACpC,mBAAO,KAAKmC,aAAL,CAAmBiE,MAAnB,CAA0B;AAAA,uBAAOC,GAAP;AAAA,aAA1B,EAAsCrG,MAAtC,GAA+C,KAAKmC,aAAL,CAAmBnC,MAAzE;AACH;;;kCAGS;AACNe,kBAAM,cAAN;AACA,iBAAKuF,kBAAL;AACA;AACA,iBAAKnE,aAAL,GAAqB,EAArB;AACA,gBAAI,KAAKE,YAAT,EAAuBkE,cAAc,KAAKlE,YAAnB;AAC1B;;;;EAnegB3B,iB;;AAuerB;;;;;;;AAKAM,OAAOgB,MAAP,GAAgB;AACZ;;;AAGAC,WAAO,CAAC,CAJI;AAKZ;;;AAGAY,gBAAY,CARA;AASZ;;;AAGAF,eAAW,CAZC;AAaZ;;;AAGAK,aAAS,CAhBG;AAiBZ;;;AAGAC,YAAQ;AApBI,CAAhB;;AAwBA;;;;;AAKAjC,OAAOoC,MAAP,GAAgB;AACZ;;;AAGAP,gBAAY,aAJA;AAKZ;;;AAGAmC,sBAAkB,mBARN;AASZ;;;AAGArC,eAAW,YAZC;AAaZ;;;AAGAM,YAAQ,SAhBI;AAiBZ;;;AAGAS,WAAO;AApBK,CAAhB;;AAwBApD,OAAOC,OAAP,GAAiBS,MAAjB,C;;;;;;ACzkBA,gC;;;;;;;;;;;;;ICAML,Q;AACF,wBAIQ;AAAA;;AAAA,uFAAJ,EAAI;AAAA,gCAHJuC,OAGI;AAAA,YAHJA,OAGI,gCAHM,YAAM,CAAE,CAGd;AAAA,iCAFJ+C,QAEI;AAAA,YAFJA,QAEI,iCAFO,YAAM,CAAE,CAEf;AAAA,gCADJ1G,OACI;AAAA,YADJA,OACI,gCADM,CACN;;AAAA;;AACJ,aAAKiH,QAAL,GAAgB,IAAhB;AACA,aAAKC,OAAL,GAAe,IAAf;;AAEA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,SAAL,GAAiBV,QAAjB;AACA,aAAKW,WAAL,GAAmB,KAAnB;;AAEA,aAAKC,OAAL,GAAe,IAAIjI,OAAJ,CAAY,UAACE,OAAD,EAAUgE,MAAV,EAAqB;AAC5C,kBAAK0D,QAAL,GAAgB1H,OAAhB;AACA,kBAAK2H,OAAL,GAAe3D,MAAf;;AAEA,gBAAI;AACAI;AACH,aAFD,CAEE,OAAOrD,GAAP,EAAY;AACV,sBAAKiD,MAAL,CAAYjD,GAAZ;AACH;AACJ,SATc,CAAf;;AAWA,YAAIN,UAAU,CAAd,EAAiB;AACb,iBAAKmH,QAAL,GAAgB7H,WAAW,KAAKiI,MAAL,CAAYrE,IAAZ,CAAiB,IAAjB,CAAX,EAAmClD,OAAnC,CAAhB;AACH;AACJ;;;;gCAGOiF,I,EAAM;AACV,gBAAI,KAAKoC,WAAT,EAAsB;;AAEtB,iBAAKA,WAAL,GAAmB,IAAnB;AACA,iBAAKG,aAAL;AACA,iBAAKP,QAAL,CAAchC,IAAd;AACH;;;+BAGM3E,G,EAAK;AACR,gBAAI,KAAK+G,WAAT,EAAsB;;AAEtB,iBAAKA,WAAL,GAAmB,IAAnB;AACA,iBAAKG,aAAL;AACA,iBAAKN,OAAL,CAAa5G,GAAb;AACH;;;iCAGQ;AACL,iBAAK+G,WAAL,GAAmB,IAAnB;AACA,iBAAKG,aAAL;AACA,iBAAKJ,SAAL;AACA,iBAAKF,OAAL,CAAa,IAAI1D,KAAJ,CAAU,gBAAV,CAAb;AACH;;;+BAGa;AAAA,8CAANiE,IAAM;AAANA,oBAAM;AAAA;;AACV,mBAAO,KAAKH,OAAL,CAAa/G,IAAb,CAAkBmH,KAAlB,CAAwB,KAAKJ,OAA7B,EAAsCG,IAAtC,CAAP;AACH;;;iCAGc;AAAA,+CAANA,IAAM;AAANA,oBAAM;AAAA;;AACX,mBAAO,KAAKH,OAAL,CAAalH,KAAb,CAAmBsH,KAAnB,CAAyB,KAAKJ,OAA9B,EAAuCG,IAAvC,CAAP;AACH;;;wCAGe;AACZ,gBAAI,KAAKN,QAAT,EAAmB;AACf9G,6BAAa,KAAK8G,QAAlB;AACA,qBAAKA,QAAL,GAAgB,IAAhB;AACH;AACJ;;;;;;AAILpG,OAAOC,OAAP,GAAiBI,QAAjB,C;;;;;;;;;;;;;;;;;AC3EA,IAAMuG,cAAc,mBAAAzI,CAAQ,EAAR,CAApB;AACA,IAAMoC,WAAW,mBAAApC,CAAQ,CAAR,CAAjB;AACA,IAAM0I,aAAa,mBAAA1I,CAAQ,EAAR,CAAnB;AACA,IAAM2I,SAAS,mBAAA3I,CAAQ,EAAR,CAAf;;eAC0B,mBAAAA,CAAQ,CAAR,C;IAAnBsB,e,YAAAA,e;;AACP,IAAMW,oBAAoB,mBAAAjC,CAAQ,CAAR,CAA1B;;AAGA;;;;;;;;;;IASM+B,O;;;;;8BACW6G,G,EAAK;AACd,gBAAI;AACA,oBAAM7C,OAAO8C,KAAKnC,KAAL,CAAWkC,GAAX,CAAb;AACA,uBAAO,IAAI7G,OAAJ,CAAY;AACf8E,0BAAMd,KAAK+C,CADI;AAEf3B,6BAASpB,KAAKgD,CAFC;AAGf3H,yBAAK2E,KAAKS,CAHK;AAIf9D,wBAAIqD,KAAKiD;AAJM,iBAAZ,CAAP;AAMH,aARD,CAQE,OAAM5H,GAAN,EAAW;AACT,sBAAM,IAAIkD,KAAJ,4BAAN;AACH;AACJ;;;AAED,2BAAsC;AAAA,YAAzBuC,IAAyB,QAAzBA,IAAyB;AAAA,YAAnBM,OAAmB,QAAnBA,OAAmB;AAAA,YAAVzE,EAAU,QAAVA,EAAU;AAAA,YAANtB,GAAM,QAANA,GAAM;;AAAA;;AAAA;;AAGlC,cAAKyF,IAAL,GAAYA,IAAZ;AACA,cAAKM,OAAL,GAAeA,OAAf;AACA,cAAKzE,EAAL,GAAUA,EAAV;AACA,cAAKtB,GAAL,GAAWA,GAAX;;AAEA,cAAK6H,YAAL,GAAoB,KAApB;AARkC;AASrC;;;;gCAE6B;AAAA,gBAAxBvG,EAAwB,uEAAnBpB,iBAAmB;;AAC1B,iBAAKoB,EAAL,GAAUA,EAAV;AACA,mBAAOA,EAAP;AACH;;;uCAEctB,G,EAAK+F,O,EAAS;AACzB,mBAAO,IAAIpF,OAAJ,CAAY,EAAC8E,MAAM,IAAP,EAAaM,gBAAb,EAAsB/F,QAAtB,EAA2BsB,IAAI,KAAKA,EAApC,EAAZ,CAAP;AACH;;AAGD;;;;;;;;gCAKQyE,O,EAAS;AAAA;;AACb,gBAAIsB,YAAY,KAAK/F,EAAjB,CAAJ,EACI,OAAOuD,QAAQiD,IAAR,CAAa,oDAAb,CAAP;;AAEJ,gBAAI,KAAKD,YAAT,EACI,OAAOhD,QAAQiD,IAAR,CAAa,6CAAb,CAAP;;AAEJ;AACA,gBAAI9G,SAAS+E,OAAT,KAAqBuB,WAAWvB,QAAQ9F,IAAnB,CAAzB,EAAmD;AAC/C8F,wBACK9F,IADL,CACU,oBAAY;AACd,2BAAK4H,YAAL,GAAoB,IAApB;AACA,2BAAKvE,IAAL,CAAU,UAAV,EAAsByC,OAAtB;AACH,iBAJL,EAKKjG,KALL,CAKW,eAAO;AACV,2BAAK+H,YAAL,GAAoB,IAApB;AACA,2BAAKvE,IAAL,CAAU,UAAV,EAAsBtD,GAAtB;AACH,iBARL;;AAUA;AACH;;AAED,iBAAK6H,YAAL,GAAoB,IAApB;AACA,iBAAKvE,IAAL,CAAU,UAAV,EAAsByC,OAAtB;AACH;;AAGD;;;;;;;+BAIO/F,G,EAAK;AACR,gBAAIqH,YAAY,KAAK/F,EAAjB,CAAJ,EACI,OAAOuD,QAAQiD,IAAR,CAAa,oDAAb,CAAP;;AAEJ,gBAAI,KAAKD,YAAT,EACI,OAAOhD,QAAQiD,IAAR,CAAa,6CAAb,CAAP;;AAEJ,iBAAKD,YAAL,GAAoB,IAApB;AACA,iBAAKvE,IAAL,CAAU,UAAV,EAAsBtD,GAAtB;AACH;;;mCAEU;AACP,gBAAI;AACA,oBAAM2E,OAAO,EAAC+C,GAAG,KAAKjC,IAAT,EAAb;;AAEA,oBAAI,CAAC4B,YAAY,KAAKtB,OAAjB,CAAL,EACIpB,KAAKgD,CAAL,GAAS,KAAK5B,OAAd;;AAEJ,oBAAI,CAACsB,YAAY,KAAK/F,EAAjB,CAAL,EACIqD,KAAKiD,CAAL,GAAS,KAAKtG,EAAd;;AAEJ,oBAAI,CAAC+F,YAAY,KAAKrH,GAAjB,CAAL,EACI2E,KAAKS,CAAL,GAAS,KAAKpF,GAAd;;AAEJ,uBAAOyH,KAAKM,SAAL,CAAepD,IAAf,CAAP;AACH,aAbD,CAaE,OAAM3E,GAAN,EAAW;AACT,sBAAM,IAAIkD,KAAJ,gCAAN;AACH;AACJ;;;kCAES;AAAA;;AACN,gBAAM8E,SAAS,KAAKC,UAAL,EAAf;AACAD,mBAAOE,OAAP,CAAe;AAAA,uBAAS,OAAKzB,kBAAL,CAAwB0B,KAAxB,CAAT;AAAA,aAAf;AACH;;;;EAzGiBtH,iB;;AA6GtBF,QAAQ6D,KAAR,GAAgB;AACZoB,cAAU,IADE;AAEZnB,eAAW,IAFC;AAGZiB,UAAM;AAHM,CAAhB;;AAOA/E,QAAQ4E,aAAR,GAAwBgC,OAAO5G,QAAQ6D,KAAf,CAAxB;;AAGA/D,OAAOC,OAAP,GAAiBC,OAAjB,C;;;;;;ACxIA,kC;;;;;;ACAA,0C;;;;;;ACAA,4C;;;;;;ACAA,6C;;;;;;ACAA,8C;;;;;;ACAA,+C;;;;;;ACAA,0C;;;;;;;;;;;;;;;;;;;ACAAyH,OAAO5E,SAAP,GAAmB,mBAAA5E,CAAQ,CAAR,CAAnB;AACA,IAAMyJ,YAAY,mBAAAzJ,CAAQ,CAAR,CAAlB;;IAGM0J,U;;;;;;;;;;;sCACY;AAAA;;AACV,iBAAKjH,GAAL,CAASkH,EAAT,CAAY,MAAZ,EAAoB,KAAKvE,MAAL,CAAYpB,IAAZ,CAAiB,IAAjB,CAApB;AACA,iBAAKvB,GAAL,CAASkH,EAAT,CAAY,OAAZ,EAAqB,KAAKnE,OAAL,CAAaxB,IAAb,CAAkB,IAAlB,CAArB;;AAEA,iBAAKvB,GAAL,CAASkH,EAAT,CAAY,OAAZ,EAAqB,UAAC7E,IAAD,EAAOC,MAAP,EAAkB;AACnC,oBAAID,QAAQ,CAAZ,EAAeA,OAAO,IAAP;AACf,uBAAKQ,OAAL,CAAa,EAACR,UAAD,EAAOC,cAAP,EAAb;AACH,aAHD;;AAKA,iBAAKtC,GAAL,CAASkH,EAAT,CAAY,SAAZ,EAAuB,UAAC5D,IAAD,EAAU;AAC7B,uBAAKL,SAAL,CAAe,EAACK,UAAD,EAAf;AACH,aAFD;AAGH;;;8BAGKU,O,EAAS;AAAA;;AACX,mBAAO,IAAItG,OAAJ,CAAY,UAACE,OAAD,EAAUgE,MAAV,EAAqB;AACpC,uBAAK5B,GAAL,CAASkD,IAAT,CAAcc,QAAQ9E,QAAR,EAAd,EAAkC,eAAO;AACrC,wBAAIP,GAAJ,EAAS,OAAOiD,OAAOjD,GAAP,CAAP;AACTf;AACH,iBAHD;AAIH,aALM,CAAP;AAMH;;;gCAGOe,G,EAAK;AAAA;;AACT,gBAAI,CAACA,GAAL,EAAUA,MAAM,EAAC0D,MAAM,IAAP,EAAaC,QAAQ,EAArB,EAAN;;AAEV;;AAEA;AACA3E,uBAAW;AAAA,uBAAK,OAAKkF,OAAL,CAAalE,GAAb,CAAL;AAAA,aAAX;AACH;;;;EAjCoBqI,S;;AAsCzB5H,OAAOC,OAAP,GAAiB4H,UAAjB,C","file":"client-node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 311e106aab86a94efc4e","const assign = require('lodash/assign');\n\n\nfunction promiseDelay(ms) {\n    return new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n    const defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n    options = assign(defaults, options);\n    let timeout;\n    let counter = 1;\n    let delay = options.initialDelay;\n\n    const once = function() {\n        return task()\n            .catch(err => {\n                counter++;\n                delay = delay * options.increaseFactor;\n\n                if (options.maxCount != 0 && counter > options.maxCount) {\n                    timeout && clearTimeout(timeout);\n                    throw err;\n                }\n                return promiseDelay(delay * 1000 / 2).then(_ => once());\n            });\n    }\n\n    return once();\n}\n\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId(length = 4) {\n    return (\"0000\" + (Math.random()*Math.pow(36,length) << 0).toString(36)).slice(-length);\n}\n\n\nmodule.exports = {promiseDelay, retry, generateDummyId};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 2\n// module chunks = 0","const Message = require('../lib/message');\nconst Utils = require('../lib/utils');\nconst EventEmitterExtra = require('event-emitter-extra/dist/commonjs.modern');\nconst Deferred = require('../lib/deferred');\nconst debounce = require('lodash/debounce');\nconst isObject = require('lodash/isObject');\nconst isBoolean = require('lodash/isBoolean');\nconst debug = require('debug')('line:client-web');\n\n\n\n/**\n * Line client class.\n *\n * @class Client\n * @extends {EventEmitterExtra}\n * @param {string=} url Server url, default: `ws://localhost`.\n * @param {Object=} options Options object.\n * @param {boolean=} options.reconnect Try to reconnect server after unexpected disconnection, default `true`.\n * @param {boolean=} options.keepUptime Keeps uptime, default `false`.\n * @param {any=} options.handshakePayload Handshake payload to be sent to server.\n * @property {string} url Server url\n * @property {string} id Unique connection id assigned by the server\n * @property {Client.States} state Connection state\n * @example\n * // Add line-client to your html document\n * <script src=\"./node_modules/line-socket/dist/client-web-globals.js\"></script>\n *\n * // For web browsers (consuming as a commonjs module)\n * const LineClient = require('line-socket/client-web');\n *\n * // For node.js\n * const LineClient = require('line-socket/client-node');\n *\n *\n * const client = new LineClient('ws://localhost:8080', {\n *   reconnect: false,\n *   handshakePayload: { token: 'a6g3X' }\n * });\n */\nclass Client extends EventEmitterExtra {\n    constructor(url = 'ws://localhost', options = {}) {\n        super();\n\n        this.url = url;\n\n        this.options = options;\n\n        this.ws_ = null;\n        this.id = null;\n        this.reconnect = isBoolean(options.reconnect) ? options.reconnect : true;\n        this.reconnectDisabled_ = false;\n\n        this.serverTimeout_ = 30000;\n        this.maxReconnectDelay = 60;\n        this.initialReconnectDelay = 1;\n        this.reconnectIncrementFactor = 2;\n        this.pingInterval = 60000;\n\n        this.deferreds_ = {};\n        this.connectDeferred_ = null;\n        this.connectError_ = null;\n        this.disconnectDeferred_ = null;\n\n\n        this.state = Client.States.READY;\n\n        this.uptimeInterval_ = 5000;\n        this.uptimeBuffer_ = [];\n        this.uptimeBufferLength_ = 5 * 60000 / this.uptimeInterval_;\n        this.uptimeCheck_ = options.keepUptime ? setInterval(this.uptimeTick_.bind(this), this.uptimeInterval_) : null;\n\n        this.autoPing_ = this.pingInterval > 0 ?\n            debounce(() => {\n                if (this.state != Client.States.CONNECTED)\n                    return;\n\n                this\n                    .ping()\n                    .then(() => {\n                        if (this.pingInterval > 0 && this.state == Client.States.CONNECTED) {\n                            this.autoPing_();\n                        }\n                    })\n                    .catch(() => {});\n            }, this.pingInterval) :\n            () => {};\n    }\n\n\n    /**\n     * Connects to server.\n     * @returns {Promise}\n     * @example\n     * client\n     *   .connect()\n     *   .then((handshakeResponse) => {\n     *     // handshakeResponse will be undefined if you do not resolve\n     *     // the handshake with a payload in server\n     *     console.log('Connected');\n     *   })\n     *   .catch((err) => {\n     *     console.log('Could not connect');\n     *   })\n     */\n    connect() {\n        switch (this.state) {\n            case Client.States.CONNECTING:\n                return Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n            case Client.States.CONNECTED:\n                return Promise.reject(new Error('Already connected.'));\n            case Client.States.CLOSING:\n                return Promise.reject(new Error('Terminating an active connecting, try again later.'));\n            case Client.States.CLOSED:\n            case Client.States.READY:\n                this.connectError_ = null;\n                this.connectDeferred_ = new Deferred({\n                    handler: () => {\n                        this.state = Client.States.CONNECTING;\n                        this.emit(Client.Events.CONNECTING);\n                        this.reconnectDisabled_ = false;\n\n                        setTimeout(_ => {\n                            debug(`Connecting to \"${this.url}\" ...`);\n                            this.ws_ = new WebSocket(this.url);\n                            this.bindEvents_();\n                        }, 0);\n                    }\n                });\n\n                return this.connectDeferred_;\n            default:\n                return Promise.reject(new Error('Could not connect, unknown state.'))\n        }\n    }\n\n\n    /**\n     * Gracefully closes the connection\n     *\n     * @param {number=} code\n     * @param {any=} reason\n     * @param {boolean=} opt_retry\n     * @returns {Promise}\n     * @example\n     * client\n     *   .disconnect()\n     *   .then(() => {\n     *     // Client will not try to reconnect\n     *     console.log('Disconnected');\n     *   })\n     *   .catch((err) => {\n     *     console.log('Could not disconnect');\n     *   })\n     */\n    disconnect(code, reason, opt_retry) {\n        switch (this.state) {\n            case Client.States.ERROR:\n            case Client.States.CONNECTED:\n            case Client.States.CONNECTING:\n                debug('Disconnecting...');\n                this.ws_.close(code || 1000, reason);\n                debug('Websocket closed!');\n                this.reconnectDisabled_ = !opt_retry;\n                this.disconnectDeferred_ = new Deferred();\n                this.state = Client.States.CLOSING;\n                return this.disconnectDeferred_;\n            case Client.States.CLOSED:\n                return Promise.reject(new Error('There is no connection to disconnect.'));\n            case Client.States.CLOSING:\n                return Promise.reject(new Error('Already terminating a connecting, try again later.'));\n        }\n    }\n\n\n    bindEvents_() {\n        debug('Binding native event handlers.');\n        this.ws_.onopen = this.onOpen.bind(this);\n        this.ws_.onclose = this.onClose.bind(this);\n        this.ws_.onerror = this.onError.bind(this);\n        this.ws_.onmessage = this.onMessage.bind(this);\n    }\n\n\n    unBindEvents_() {\n        if (!this.ws_) return;\n        debug('Unbinding native event handlers.');\n        this.ws_.onopen = function() {};\n        this.ws_.onclose = function() {};\n        this.ws_.onerror = function() {};\n        this.ws_.onmessage = function() {};\n    }\n\n\n    disposeConnectionPromisses_() {\n        debug('Disposing connection promisses...');\n        if (this.connectDeferred_) {\n            debug('Rejecting connect promise...');\n            this.connectDeferred_.reject(this.connectError_);\n            this.connectDeferred_ = null;\n            this.connectError_ = null;\n        }\n\n        if (this.disconnectDeferred_) {\n            debug('Rejecting disconnect promise...');\n            this.disconnectDeferred_.reject();\n            this.disconnectDeferred_ = null;\n        }\n    }\n\n\n    onOpen() {\n        debug('Native \"open\" event received.');\n        debug(`State=${this.state}`);\n        debug('Sending handshake data...');\n        this.send(Message.Names.HANDSHAKE, this.options.handshakePayload)\n            .then(data => {\n                debug('Handshake successful.');\n                this.id = data.id;\n                this.serverTimeout_ = data.timeout;\n                this.maxReconnectDelay = data.maxReconnectDelay;\n                this.initialReconnectDelay = data.initialReconnectDelay;\n                this.reconnectIncrementFactor = data.reconnectIncrementFactor;\n                this.pingInterval = data.pingInterval;\n\n                if (this.connectDeferred_) {\n                    debug('Resolving connect promise...');\n                    this.connectDeferred_.resolve(data.handshakePayload);\n                    this.connectDeferred_ = null;\n                    this.connectError_ = null;\n                }\n\n                this.state = Client.States.CONNECTED;\n                debug('Emitting \"connected\" event...');\n                this.emit(Client.Events.CONNECTED, data.handshakePayload);\n            })\n            .catch(err => {\n                debug('Handshake failed.');\n                this.connectError_ = err;\n                debug('Emitting \"error\" event...');\n                this.emit(Client.Events.ERROR, err);\n                return this.disconnect();\n            })\n            .catch(err => {\n                debug('Could not disconnect after handshake failure.');\n                console.log('Could not disconnect after failed handshake', err);\n            });\n    }\n\n\n    onClose(err) {\n        debug('Native \"close\" event reveived.');\n        debug(`State=${this.state}`);\n        this.unBindEvents_();\n        this.id = null;\n        this.ws_ = null;\n\n        debug('Emitting \"closed\" event...');\n        this.emit(Client.Events.CLOSED, err);\n\n        switch(this.state) {\n            case Client.States.CLOSING:\n                this.state = Client.States.CLOSED;\n\n                if (this.disconnectDeferred_) {\n                    debug('Resolving disconnect promise...');\n                    this.disconnectDeferred_.resolve();\n                    this.disconnectDeferred_ = null;\n                }\n\n                if (this.connectDeferred_) {\n                    debug('Rejecting connect promise...');\n                    this.connectDeferred_.reject(this.connectError_ || new Error('Connection closed while connecting...'));\n                    this.connectDeferred_ = null;\n                    this.connectError_ = null;\n                }\n\n                if (!this.reconnect || this.retrying_ || this.reconnectDisabled_)\n                    return;\n\n                break;\n            case Client.States.CONNECTING:\n                this.state = Client.States.CLOSED;\n\n                if (this.disconnectDeferred_) {\n                    debug('Rejecting disconnect promise...');\n                    this.disconnectDeferred_.reject(new Error('Already disconnected'));\n                    this.disconnectDeferred_ = null;\n                }\n\n                if (!this.reconnect || this.retrying_ || this.reconnectDisabled_) {\n                    if (this.connectDeferred_) {\n                        debug('Rejecting connect promise...');\n                        this.connectDeferred_.reject(this.connectError_);\n                        this.connectDeferred_ = null;\n                        this.connectError_ = null;\n                    }\n                    return;\n                }\n\n                break;\n            default:\n                this.state = Client.States.CLOSED;\n\n                if (this.disconnectDeferred_) {\n                    debug('Rejecting disconnect promise...');\n                    this.disconnectDeferred_.reject(new Error('Already disconnected'));\n                    this.disconnectDeferred_ = null;\n                }\n\n                if (this.connectDeferred_) {\n                    debug('Rejecting connect promise...');\n                    this.connectDeferred_.reject(new Error('Already connected'));\n                    this.connectDeferred_ = null;\n                    this.connectError_ = null;\n                }\n\n                if (!this.reconnect || this.retrying_ || this.reconnectDisabled_)\n                    return;\n        }\n        debug('Retrying to connect...');\n        this.retrying_ = true;\n        Utils\n            .retry(\n                _ => this.connect(),\n                {\n                    maxCount: this.maxReconnectDelay,\n                    initialDelay: this.initialReconnectDelay,\n                    increaseFactor: this.reconnectIncrementFactor\n                })\n            .then(_ => {\n                debug('Retry successful.');\n                this.retrying_ = false;\n            });\n    }\n\n\n    onError(err) {\n        debug('Native \"error\" event reveived.');\n        debug(`State=${this.state}`);\n\n        const eventName = this.state == Client.States.CONNECTING ?\n                Client.Events.CONNECTING_ERROR : Client.Events.ERROR;\n\n        this.emit(eventName, err || new Error('Unknown error'));\n    }\n\n\n    onMessage(e) {\n        debug('Native \"message\" event reveived.');\n\n        const message = Message.parse(e.data);\n        this.autoPing_();\n\n        // Message without response (no id fields)\n        if (!message.id && Message.ReservedNames.indexOf(message.name) == -1) {\n            debug(`Message without response: name=\"${message.name}\"`);\n            return this.emit(message.name, message);\n        }\n\n        // Ping\n        if (message.name == Message.Names.PING) {\n            return this.onPing_(message);\n        }\n\n        // Message response\n        if (message.name == Message.Names.RESPONSE && this.deferreds_[message.id]) {\n            const deferred = this.deferreds_[message.id];\n            debug(`Message response: name=\"${message.name}\" id=\"${message.id}\"`);\n            if (message.err) {\n                const err = Object.assign(new Error(), message.err);\n                deferred.reject(err);\n            } else {\n                deferred.resolve(message.payload);\n            }\n\n            delete this.deferreds_[message.id];\n            return;\n        }\n\n        debug(`Message with response: name=\"${message.name}\" id=\"${message.id}\"`);\n        // Message with response\n        message.once('resolved', payload => {\n            debug(`Client resolving: name=\"${message.name}\" id=\"${message.id}\"`);\n            this.send_(message.createResponse(null, payload));\n            message.dispose();\n        });\n\n        message.once('rejected', err => {\n            if (isObject(err) && err instanceof Error && err.name == 'Error')\n               err = {message: err.message, name: 'Error'};\n            debug(`Client rejecting: name=\"${message.name}\" id=\"${message.id}\"`);\n            this.send_(message.createResponse(err));\n            message.dispose();\n        });\n\n        this.emit(message.name, message);\n    }\n\n\n    onPing_(message) {\n        debug('Ping received');\n        this\n            .send_(message.createResponse(null, 'pong'))\n            .catch(err => {\n                console.log('Ping responce failed to send', err);\n            });\n    }\n\n\n    /**\n     * Sends a message to server with awaiting its response.\n     *\n     * @param {string} eventName\n     * @param {any=} payload\n     * @returns {Promise}\n     * @example\n     * client\n     *   .send('hello', {some: data})\n     *   .then((response) => {\n     *     console.log('Sent and got the response');\n     *   })\n     *   .catch((err) => {\n     *     console.log('Could not send message OR server rejected the message');\n     *   });\n     */\n    send(eventName, payload) {\n        const message = new Message({name: eventName, payload});\n        message.setId();\n\n        return this\n            .send_(message)\n            .then(_ => {\n                const deferred = this.deferreds_[message.id] = new Deferred({\n                    onExpire: () => {\n                        delete this.deferreds_[message.id];\n                    },\n                    timeout: this.serverTimeout_\n                });\n\n                return deferred;\n            });\n    }\n\n\n    /**\n     * Sends a message to server without waiting its response.\n     *\n     * @param {string} eventName\n     * @param {any=} payload\n     * @returns {Promise}\n     * @example\n     * client\n     *   .sendWithoutResponse('hello', {some: data})\n     *   .then(() => {\n     *     console.log('Message is sent');\n     *   })\n     *   .catch((err) => {\n     *     console.log('Could not send message');\n     *   });\n     */\n    sendWithoutResponse(eventName, payload) {\n        const message = new Message({name: eventName, payload});\n        return this.send_(message);\n    }\n\n\n    send_(message) {\n        return new Promise(resolve => {\n            debug(`Sending message: ${message.toString()}`);\n            this.ws_.send(message.toString());\n            resolve();\n        });\n    }\n\n\n    /**\n     * Sends a ping message to server, if its failed, the connection will be closed.\n     * Server and client ping each other automatically with an interval specified by the server.\n     *\n     * @returns {Promise}\n     */\n    ping() {\n        debug('Pinging...');\n        return this\n            .send(Message.Names.PING)\n            .catch(err => {\n                debug('Auto-ping failed, manually disconnecting...');\n                this.disconnect(4500, 'Auto ping failed', true);\n                throw err;\n            });\n    }\n\n\n    uptimeTick_() {\n        debug('•Uptime Tick•');\n        this.uptimeBuffer_.push(this.state == Client.States.CONNECTED);\n\n        if (this.uptimeBuffer_.length > this.uptimeBufferLength_) {\n            this.uptimeBuffer_.splice(0, this.uptimeBufferLength_ - this.uptimeBuffer_.length);\n        }\n    }\n\n\n    /**\n     * Calculates (connection) uptime for last 5 minutes with 5 seconds interval.\n     * Returns a number between 0 and 1. If `options.keepUptime` is false, this method\n     * returns null.\n     * @returns {number?}\n     */\n    getUptime() {\n        if (!this.options.keepUptime) return null;\n        if (this.uptimeBuffer_.length == 0) return 0;\n        return this.uptimeBuffer_.filter(val => val).length / this.uptimeBuffer_.length;\n    }\n\n\n    dispose() {\n        debug('Disposing...');\n        this.removeAllListeners();\n        // TODO: Maybe reject all deferreds?\n        this.uptimeBuffer_ = [];\n        if (this.uptimeCheck_) clearInterval(this.uptimeCheck_);\n    }\n}\n\n\n/**\n * @static\n * @readonly\n * @enum {number}\n */\nClient.States = {\n    /**\n     * `-1`\n     */\n    READY: -1,\n    /**\n     * `0`\n     */\n    CONNECTING: 0,\n    /**\n     * `1`\n     */\n    CONNECTED: 1,\n    /**\n     * `2`\n     */\n    CLOSING: 2,\n    /**\n     * `3`\n     */\n    CLOSED: 3\n};\n\n\n/**\n * @static\n * @readonly\n * @enum {string}\n */\nClient.Events = {\n    /**\n     * `_connecting`\n     */\n    CONNECTING: '_connecting',\n    /**\n     * `_connecting_error`\n     */\n    CONNECTING_ERROR: '_connecting_error',\n    /**\n     * `_connected`\n     */\n    CONNECTED: '_connected',\n    /**\n     * `_closed`\n     */\n    CLOSED: '_closed',\n    /**\n     * `_error`\n     */\n    ERROR: '_error'\n};\n\n\nmodule.exports = Client;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-web.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 4\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","const isUndefined = require('lodash/isUndefined');\nconst isObject = require('lodash/isObject');\nconst isFunction = require('lodash/isFunction');\nconst values = require('lodash/values');\nconst {generateDummyId} = require('./utils');\nconst EventEmitterExtra = require('event-emitter-extra/dist/commonjs.modern');\n\n\n/**\n * Message class.\n *\n * @private\n * @class Message\n * @extends {EventEmitterExtra}\n * @property {string} name Event name\n * @property {?any} payload Message payload.\n */\nclass Message extends EventEmitterExtra {\n    static parse(raw) {\n        try {\n            const data = JSON.parse(raw);\n            return new Message({\n                name: data.n,\n                payload: data.p,\n                err: data.e,\n                id: data.i\n            });\n        } catch(err) {\n            throw new Error(`Could not parse message.`);\n        }\n    }\n\n    constructor({name, payload, id, err}) {\n        super();\n\n        this.name = name;\n        this.payload = payload;\n        this.id = id;\n        this.err = err;\n\n        this.isResponded_ = false;\n    }\n\n    setId(id = generateDummyId()) {\n        this.id = id;\n        return id;\n    }\n\n    createResponse(err, payload) {\n        return new Message({name: '_r', payload, err, id: this.id});\n    }\n\n\n    /**\n     * Resolves the message with sending a response back. If event source\n     * does not expecting a response, you don't need to call these methods.\n     * @param {any=} payload\n     */\n    resolve(payload) {\n        if (isUndefined(this.id))\n            return console.warn('[line] A message without an id cannot be resolved.');\n\n        if (this.isResponded_)\n            return console.warn('[line] This message has already been ended.');\n\n        // If thenable\n        if (isObject(payload) && isFunction(payload.then)) {\n            payload\n                .then(response => {\n                    this.isResponded_ = true;\n                    this.emit('resolved', payload);\n                })\n                .catch(err => {\n                    this.isResponded_ = true;\n                    this.emit('rejected', err);\n                });\n\n            return;\n        }\n\n        this.isResponded_ = true;\n        this.emit('resolved', payload);\n    }\n\n\n    /**\n     * Rejects the message, with sending error response back to event source.\n     * @param {any=} err\n     */\n    reject(err) {\n        if (isUndefined(this.id))\n            return console.warn('[line] A message without an id cannot be rejected.');\n\n        if (this.isResponded_)\n            return console.warn('[line] This message has already been ended.');\n\n        this.isResponded_ = true;\n        this.emit('rejected', err);\n    }\n\n    toString() {\n        try {\n            const data = {n: this.name};\n\n            if (!isUndefined(this.payload))\n                data.p = this.payload;\n\n            if (!isUndefined(this.id))\n                data.i = this.id;\n\n            if (!isUndefined(this.err))\n                data.e = this.err;\n\n            return JSON.stringify(data);\n        } catch(err) {\n            throw new Error(`Could not stringify message.`);\n        }\n    }\n\n    dispose() {\n        const events = this.eventNames();\n        events.forEach(event => this.removeAllListeners(event));\n    }\n}\n\n\nMessage.Names = {\n    RESPONSE: '_r',\n    HANDSHAKE: '_h',\n    PING: '_p'\n};\n\n\nMessage.ReservedNames = values(Message.Names);\n\n\nmodule.exports = Message;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"lodash/debounce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/debounce\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"lodash/isBoolean\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isBoolean\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/values\"\n// module id = 13\n// module chunks = 0","global.WebSocket = require('uws');\nconst WebClient = require('./client-web');\n\n\nclass NodeClient extends WebClient {\n    bindEvents_() {\n        this.ws_.on('open', this.onOpen.bind(this));\n        this.ws_.on('error', this.onError.bind(this));\n\n        this.ws_.on('close', (code, reason) => {\n            if (code == 0) code = 1005;\n            this.onClose({code, reason});\n        });\n\n        this.ws_.on('message', (data) => {\n            this.onMessage({data});\n        });\n    }\n\n\n    send_(message) {\n        return new Promise((resolve, reject) => {\n            this.ws_.send(message.toString(), err => {\n                if (err) return reject(err);\n                resolve();\n            });\n        });\n    }\n\n\n    onError(err) {\n        if (!err) err = {code: 1006, reason: ''};\n\n        super.onError();\n\n        /* Work-around for node; onClose not being called after error */\n        setTimeout(_ => this.onClose(err));\n    }\n\n}\n\n\nmodule.exports = NodeClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-node.js"],"sourceRoot":""}