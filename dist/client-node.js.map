{"version":3,"sources":["webpack:///webpack/bootstrap cd024ee300cf1e4c4b89","webpack:///./src/client/client-node.js","webpack:///external \"uws\"","webpack:///./src/client/client-web.js","webpack:///./src/lib/message.js","webpack:///external \"lodash/isUndefined\"","webpack:///external \"node-uuid\"","webpack:///external \"event-emitter-extra\"","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\""],"names":["global","WebSocket","NodeClient","ws_","on","onOpen","bind","onError","code","reason","onClose","data","onMessage","message","Promise","resolve","reject","send","toString","err","module","exports","WebClient","url","options","id","readyState","reconnect","serverTimeout_","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","promiseCallbacks_","connectPromiseCallback_","disconnectPromiseCallback_","state","States","READY","CONNECTING","Error","CONNECTED","CLOSING","CLOSED","setTimeout","bindEvents_","emit","Events","ERROR","close","onopen","onclose","onerror","onmessage","e","unBindEvents_","retrying_","retry","connect","maxCount","initialDelay","increaseFactor","then","eventName","CONENCTING","CONNECTING_ERROR","parse","reservedNames","indexOf","name","payload","timeout","send_","createResponse","dispose","clearTimeout","_","assign","once","isObject","messageId","setId","promiseCallbacks","uuid","Message","raw","JSON","n","p","i","isResponded_","v4","console","warn","stringify","events","eventNames","forEach","removeAllListeners","event","promiseDelay","ms","task","defaults","maxDelay","counter","delay","catch"],"mappings":"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","file":"client-node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cd024ee300cf1e4c4b89","import WebSocket from 'uws';\nimport WebClient from './client-web';\nglobal.WebSocket = WebSocket;\n\n\nclass NodeClient extends WebClient {\n\tbindEvents_() {\n\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\tthis.ws_.on('error', this.onError.bind(this));\n\n\t\tthis.ws_.on('close', (code, reason) => {\n\t\t\tthis.onClose({code, reason});\n\t\t});\n\n\t\tthis.ws_.on('message', (data) => {\n\t\t\tthis.onMessage({data});\n\t\t});\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.ws_.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\nmodule.exports = NodeClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-node.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 1\n// module chunks = 0","import Message from '../lib/message';\nimport Utils from '../lib/utils';\nimport EventEmitter from 'event-emitter-extra';\n\n\nclass WebClient extends EventEmitter {\n\tconstructor(url = 'ws://localhost', options = {}) {\n\t\tsuper();\n\n\t\tthis.url = url;\n\n\t\tthis.options = options;\n\n\t\tthis.ws_ = null;\n\t\tthis.id = null;\n\t\tthis.readyState = null;\n\t\tthis.reconnect = options.reconnect;\n\n\t\tthis.serverTimeout_ = 30000;\n\t\tthis.maxReconnectDelay = 60;\n\t\tthis.initialReconnectDelay = 1;\n\t\tthis.reconnectIncrementFactor = 2;\n\n\t\tthis.promiseCallbacks_ = {};\n\t\tthis.connectPromiseCallback_ = {};\n\t\tthis.disconnectPromiseCallback_ = {};\n\n\t\tthis.state = WebClient.States.READY;\n\t}\n\n\n\tconnect() {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\tcase WebClient.States.READY:\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tsetTimeout(_ => {\n\t\t\t\t\t\tthis.ws_ = new WebSocket(this.url);\n\t\t\t\t\t\tthis.connectPromiseCallback_ = {resolve, reject};\n\t\t\t\t\t\tthis.bindEvents_();\n\n\t\t\t\t\t\tthis.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\tthis.emit(WebClient.Events.CONNECTING);\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'))\n\t\t}\n\t}\n\n\n\tdisconnect(code, reason) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.ERROR:\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.ws_.close(code, reason);\n\t\t\t\t\tthis.state = WebClient.States.CLOSING;\n\t\t\t\t\tthis.disconnectPromiseCallback_ = {resolve, reject};\n\t\t\t\t});\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t}\n\t}\n\n\n\tbindEvents_() {\n\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t}\n\n\n\tunBindEvents_() {\n\t\tif (!this.ws_) return;\n\t\tdelete this.ws_.onopen;\n\t\tdelete this.ws_.onclose;\n\t\tdelete this.ws_.onerror;\n\t\tdelete this.ws_.onmessage;\n\t}\n\n\n\tdisposeConnectionPromisses_() {\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.resolve) {\n\t\t\tthis.disconnectPromiseCallback_.resolve();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\t}\n\n\n\tonOpen() {\n\t\t// this.updateState_();\n\t\t// this.emit('_open');\n\t}\n\n\n\tonClose(e) {\n\t\tthis.unBindEvents_();\n\t\tthis.id = null;\n\t\tthis.ws_ = null;\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.resolve) {\n\t\t\tthis.disconnectPromiseCallback_.resolve();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (!this.reconnect || this.retrying_) return;\n\n\t\tthis.retrying_ = true;\n\t\tUtils\n\t\t\t.retry(\n\t\t\t\t_ => this.connect(),\n\t\t\t\t{\n\t\t\t\t\tmaxCount: this.maxReconnectDelay,\n\t\t\t\t\tinitialDelay: this.initialReconnectDelay,\n\t\t\t\t\tincreaseFactor: this.reconnectIncrementFactor\n\t\t\t\t})\n\t\t\t.then(_ => {\n\t\t\t\tthis.retrying_ = false;\n\t\t\t});\n\t}\n\n\n\tonError(err) {\n\t\tconst eventName = this.state == WebClient.States.CONENCTING ?\n\t\t\t\tWebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(eventName, err);\n\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.reject) {\n\t\t\tthis.disconnectPromiseCallback_.reject();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\t}\n\n\n\tonMessage(e) {\n\t\tconst message = Message.parse(e.data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Handshake\n\t\tif (message.name == '_h') {\n\t\t\tthis.id = message.payload.id;\n\t\t\tthis.serverTimeout_ = message.payload.timeout;\n\t\t\tthis.maxReconnectDelay = message.payload.maxReconnectDelay;\n\t\t\tthis.initialReconnectDelay = message.payload.initialReconnectDelay;\n\t\t\tthis.reconnectIncrementFactor = message.payload.reconnectIncrementFactor;\n\n\t\t\treturn this\n\t\t\t\t.send_(message.createResponse())\n\t\t\t\t.then(_ => {\n\t\t\t\t\tmessage.dispose();\n\n\t\t\t\t\tif (this.connectPromiseCallback_.resolve) {\n\t\t\t\t\t\tthis.connectPromiseCallback_.resolve();\n\t\t\t\t\t\tthis.connectPromiseCallback_ = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.state = WebClient.States.CONNECTED;\n\t\t\t\t\tthis.emit(WebClient.Events.CONNECTED);\n\t\t\t\t});\n\t\t}\n\n\t\t// Message response\n\t\tif (message.name == '_r' && this.promiseCallbacks_[message.id]) {\n\t\t\tconst {resolve, reject, timeout} = this.promiseCallbacks_[message.id];\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = _.assign(new Error(), message.err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks_[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst timeout = setTimeout(_ => {\n\t\t\t\t\t\t/* Connections has been closed. */\n\t\t\t\t\t\tif (!this.promiseCallbacks[messageId]) return;\n\n\t\t\t\t\t\tconst {reject, timeout} = this.promiseCallbacks_[messageId];\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\treject(new Error('Timeout reached'));\n\t\t\t\t\t\tdelete this.promiseCallbacks_[messageId];\n\t\t\t\t\t}, this.serverTimeout_);\n\n\t\t\t\t\tthis.promiseCallbacks_[messageId] = {resolve, reject, timeout};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise(resolve => {\n\t\t\tthis.ws_.send(message.toString());\n\t\t\tresolve();\n\t\t});\n\t}\n}\n\nWebClient.States = {\n\tREADY: -1,\n\tCONNECTING: 0,\n\tCONNECTED: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nWebClient.Events = {\n\tREADY: '_ready',\n\tCONNECTING: '_connecting',\n\tCONNECTING_ERROR: '_connecting_error',\n\tCONNECTED: '_connected',\n\tCLOSING: '_closing',\n\tCLOSED: '_closed',\n\tERROR: '_error'\n};\n\n\nmodule.exports = WebClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-web.js","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r', '_h'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"event-emitter-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra\"\n// module id = 6\n// module chunks = 0","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\nmodule.exports = {promiseDelay, retry};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}