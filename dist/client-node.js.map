{"version":3,"sources":["webpack:///webpack/bootstrap 8ad4237f91159f416ee5","webpack:///./src/client/client-node.js","webpack:///external \"uws\"","webpack:///./src/client/client-web.js","webpack:///./src/lib/message.js","webpack:///external \"lodash/isUndefined\"","webpack:///external \"node-uuid\"","webpack:///external \"event-emitter-extra\"","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\""],"names":["global","WebSocket","NodeClient","ws_","on","onOpen","bind","onError","code","reason","onClose","data","onMessage","message","Promise","resolve","reject","send","toString","err","module","exports","WebClient","url","options","id","readyState","reconnect","serverTimeout_","promiseCallbacks_","connectPromiseCallback_","disconnectPromiseCallback_","state","States","READY","CONNECTING","Error","CONNECTED","CLOSING","CLOSED","setTimeout","bindEvents_","emit","Events","ERROR","close","onopen","onclose","onerror","onmessage","e","unBindEvents_","retrying_","retry","connect","maxDelay","initialDelay","increaseFactor","then","eventName","CONENCTING","CONNECTING_ERROR","parse","reservedNames","indexOf","name","payload","timeout","send_","createResponse","dispose","clearTimeout","_","assign","once","isObject","messageId","setId","uuid","Message","raw","JSON","n","p","i","isResponded_","v4","console","warn","stringify","events","eventNames","forEach","removeAllListeners","event","promiseDelay","ms","task","defaults","maxCount","counter","delay","catch"],"mappings":"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","file":"client-node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8ad4237f91159f416ee5","import WebSocket from 'uws';\nimport WebClient from './client-web';\nglobal.WebSocket = WebSocket;\n\n\nclass NodeClient extends WebClient {\n\tbindEvents_() {\n\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\tthis.ws_.on('error', this.onError.bind(this));\n\n\t\tthis.ws_.on('close', (code, reason) => {\n\t\t\tthis.onClose({code, reason});\n\t\t});\n\n\t\tthis.ws_.on('message', (data) => {\n\t\t\tthis.onMessage({data});\n\t\t});\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.ws_.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\nmodule.exports = NodeClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-node.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 1\n// module chunks = 0","import Message from '../lib/message';\nimport Utils from '../lib/utils';\nimport EventEmitter from 'event-emitter-extra';\n\n\nclass WebClient extends EventEmitter {\n\tconstructor(url = 'ws://localhost', options = {}) {\n\t\tsuper();\n\n\t\tthis.url = url;\n\n\t\tthis.options = options;\n\n\t\tthis.ws_ = null;\n\t\tthis.id = null;\n\t\tthis.readyState = null;\n\t\tthis.reconnect = options.reconnect;\n\t\tthis.serverTimeout_ = 30000;\n\t\tthis.promiseCallbacks_ = {};\n\t\tthis.connectPromiseCallback_ = {};\n\t\tthis.disconnectPromiseCallback_ = {};\n\n\t\tthis.state = WebClient.States.READY;\n\t}\n\n\n\tconnect() {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\tcase WebClient.States.READY:\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tsetTimeout(_ => {\n\t\t\t\t\t\tthis.ws_ = new WebSocket(this.url);\n\t\t\t\t\t\tthis.connectPromiseCallback_ = {resolve, reject};\n\t\t\t\t\t\tthis.bindEvents_();\n\n\t\t\t\t\t\tthis.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\tthis.emit(WebClient.Events.CONNECTING);\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'))\n\t\t}\n\t}\n\n\n\tdisconnect(code, reason) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.ERROR:\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.ws_.close(code, reason);\n\t\t\t\t\tthis.state = WebClient.States.CLOSING;\n\t\t\t\t\tthis.disconnectPromiseCallback_ = {resolve, reject};\n\t\t\t\t});\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t}\n\t}\n\n\n\tbindEvents_() {\n\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t}\n\n\n\tunBindEvents_() {\n\t\tif (!this.ws_) return;\n\t\tdelete this.ws_.onopen;\n\t\tdelete this.ws_.onclose;\n\t\tdelete this.ws_.onerror;\n\t\tdelete this.ws_.onmessage;\n\t}\n\n\n\tdisposeConnectionPromisses_() {\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.resolve) {\n\t\t\tthis.disconnectPromiseCallback_.resolve();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\t}\n\n\n\tonOpen() {\n\t\t// this.updateState_();\n\t\t// this.emit('_open');\n\t}\n\n\n\tonClose(e) {\n\t\tthis.unBindEvents_();\n\t\tthis.id = null;\n\t\tthis.ws_ = null;\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.resolve) {\n\t\t\tthis.disconnectPromiseCallback_.resolve();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (!this.reconnect || this.retrying_) return;\n\n\t\tthis.retrying_ = true;\n\t\tUtils\n\t\t\t.retry(_ => this.connect(),\n\t\t\t\t{maxDelay: 60, initialDelay: 1, increaseFactor: 2})\n\t\t\t.then(_ => {\n\t\t\t\tthis.retrying_ = false;\n\t\t\t});\n\t}\n\n\n\tonError(err) {\n\t\tconst eventName = this.state == WebClient.States.CONENCTING ?\n\t\t\t\tWebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(eventName, err);\n\n\t\tif (this.connectPromiseCallback_.reject) {\n\t\t\tthis.connectPromiseCallback_.reject();\n\t\t\tthis.connectPromiseCallback_ = {};\n\t\t}\n\n\t\tif (this.disconnectPromiseCallback_.reject) {\n\t\t\tthis.disconnectPromiseCallback_.reject();\n\t\t\tthis.disconnectPromiseCallback_ = {};\n\t\t}\n\t}\n\n\n\tonMessage(e) {\n\t\tconst message = Message.parse(e.data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Handshake\n\t\tif (message.name == '_h') {\n\t\t\tthis.id = message.payload.id;\n\t\t\tthis.serverTimeout_ = message.payload.timeout;\n\n\t\t\treturn this\n\t\t\t\t.send_(message.createResponse())\n\t\t\t\t.then(_ => {\n\t\t\t\t\tmessage.dispose();\n\n\t\t\t\t\tif (this.connectPromiseCallback_.resolve) {\n\t\t\t\t\t\tthis.connectPromiseCallback_.resolve();\n\t\t\t\t\t\tthis.connectPromiseCallback_ = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.state = WebClient.States.CONNECTED;\n\t\t\t\t\tthis.emit(WebClient.Events.CONNECTED);\n\t\t\t\t});\n\t\t}\n\n\t\t// Message response\n\t\tif (message.name == '_r' && this.promiseCallbacks_[message.id]) {\n\t\t\tconst {resolve, reject, timeout} = this.promiseCallbacks_[message.id];\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = _.assign(new Error(), message.err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks_[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst timeout = setTimeout(_ => {\n\t\t\t\t\t\tconst {reject, timeout} = this.promiseCallbacks_[messageId];\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\treject(new Error('Timeout reached'));\n\t\t\t\t\t\tdelete this.promiseCallbacks_[messageId];\n\t\t\t\t\t}, this.serverTimeout_);\n\n\t\t\t\t\tthis.promiseCallbacks_[messageId] = {resolve, reject, timeout};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise(resolve => {\n\t\t\tthis.ws_.send(message.toString());\n\t\t\tresolve();\n\t\t});\n\t}\n}\n\nWebClient.States = {\n\tREADY: -1,\n\tCONNECTING: 0,\n\tCONNECTED: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nWebClient.Events = {\n\tREADY: '_ready',\n\tCONNECTING: '_connecting',\n\tCONNECTING_ERROR: '_connecting_error',\n\tCONNECTED: '_connected',\n\tCLOSING: '_closing',\n\tCLOSED: '_closed',\n\tERROR: '_error'\n};\n\n\nmodule.exports = WebClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-web.js","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r', '_h'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"event-emitter-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra\"\n// module id = 6\n// module chunks = 0","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\nmodule.exports = {promiseDelay, retry};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}