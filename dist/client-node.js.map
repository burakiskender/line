{"version":3,"sources":["webpack:///client-node.js","webpack:///webpack/bootstrap 24e23e06bd4647b47b5c","webpack:///./src/client/client-node.js","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///./src/client/client-web.js","webpack:///./src/lib/deferred.js","webpack:///./src/lib/message.js","webpack:///./src/lib/utils.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"node-uuid\"","webpack:///external \"uws\""],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","_uws","_uws2","_clientWeb","_clientWeb2","global","WebSocket","NodeClient","_WebClient","this","getPrototypeOf","apply","arguments","_this2","ws_","on","onOpen","bind","onError","code","reason","onClose","data","onMessage","message","_this3","Promise","resolve","reject","send","toString","err","require","_message","_message2","_utils","_utils2","_commonjs","_commonjs2","_deferred","_deferred2","WebClient","_EventEmitter","url","undefined","options","_this","readyState","reconnect","serverTimeout_","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","deferreds_","connectDeferred_","disconnectDeferred_","state","States","READY","opt_handshakePayload","CONNECTING","Error","CONNECTED","CLOSING","CLOSED","handler","emit","Events","setTimeout","_","bindEvents_","ERROR","deferred","close","onopen","onclose","onerror","onmessage","_this4","retry","maxCount","initialDelay","increaseFactor","then","timeout","catch","console","log","disconnect","e","_this5","unBindEvents_","retrying_","connect","eventName","CONNECTING_ERROR","disposeConnectionPromisses_","_this6","parse","reservedNames","indexOf","name","assign","payload","once","send_","createResponse","dispose","isObject","_this7","setId","onExpire","_this8","Deferred","_ref","_ref$handler","_ref$onExpire","_ref$timeout","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","_len","args","Array","_key","_len2","_key2","clearTimeout","_interopRequireWildcard","newObj","hasOwnProperty","_isUndefined","_isUndefined2","_nodeUuid","uuid","Message","isResponded_","raw","JSON","n","v4","warn","stringify","events","eventNames","forEach","event","removeAllListeners","promiseDelay","ms","task","defaults","maxDelay","_assign2","counter","delay","_assign"],"mappings":"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","file":"client-node.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _uws = __webpack_require__(9);\n\t\n\tvar _uws2 = _interopRequireDefault(_uws);\n\t\n\tvar _clientWeb = __webpack_require__(2);\n\t\n\tvar _clientWeb2 = _interopRequireDefault(_clientWeb);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tglobal.WebSocket = _uws2.default;\n\t\n\tvar NodeClient = function (_WebClient) {\n\t\t_inherits(NodeClient, _WebClient);\n\t\n\t\tfunction NodeClient() {\n\t\t\t_classCallCheck(this, NodeClient);\n\t\n\t\t\treturn _possibleConstructorReturn(this, (NodeClient.__proto__ || Object.getPrototypeOf(NodeClient)).apply(this, arguments));\n\t\t}\n\t\n\t\t_createClass(NodeClient, [{\n\t\t\tkey: 'bindEvents_',\n\t\t\tvalue: function bindEvents_() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\t\t\tthis.ws_.on('error', this.onError.bind(this));\n\t\n\t\t\t\tthis.ws_.on('close', function (code, reason) {\n\t\t\t\t\t_this2.onClose({ code: code, reason: reason });\n\t\t\t\t});\n\t\n\t\t\t\tthis.ws_.on('message', function (data) {\n\t\t\t\t\t_this2.onMessage({ data: data });\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send_',\n\t\t\tvalue: function send_(message) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this3.ws_.send(message.toString(), function (err) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn NodeClient;\n\t}(_clientWeb2.default);\n\t\n\tmodule.exports = NodeClient;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _message = __webpack_require__(4);\n\t\n\tvar _message2 = _interopRequireDefault(_message);\n\t\n\tvar _utils = __webpack_require__(5);\n\t\n\tvar _utils2 = _interopRequireDefault(_utils);\n\t\n\tvar _commonjs = __webpack_require__(1);\n\t\n\tvar _commonjs2 = _interopRequireDefault(_commonjs);\n\t\n\tvar _deferred = __webpack_require__(3);\n\t\n\tvar _deferred2 = _interopRequireDefault(_deferred);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar WebClient = function (_EventEmitter) {\n\t\t_inherits(WebClient, _EventEmitter);\n\t\n\t\tfunction WebClient() {\n\t\t\tvar url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'ws://localhost';\n\t\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t\t\t_classCallCheck(this, WebClient);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (WebClient.__proto__ || Object.getPrototypeOf(WebClient)).call(this));\n\t\n\t\t\t_this.url = url;\n\t\n\t\t\t_this.options = options;\n\t\n\t\t\t_this.ws_ = null;\n\t\t\t_this.id = null;\n\t\t\t_this.readyState = null;\n\t\t\t_this.reconnect = options.reconnect;\n\t\n\t\t\t_this.serverTimeout_ = 30000;\n\t\t\t_this.maxReconnectDelay = 60;\n\t\t\t_this.initialReconnectDelay = 1;\n\t\t\t_this.reconnectIncrementFactor = 2;\n\t\n\t\t\t_this.deferreds_ = {};\n\t\t\t_this.connectDeferred_ = null;\n\t\t\t_this.disconnectDeferred_ = null;\n\t\n\t\t\t_this.state = WebClient.States.READY;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(WebClient, [{\n\t\t\tkey: 'connect',\n\t\t\tvalue: function connect(opt_handshakePayload) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tswitch (this.state) {\n\t\t\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\t\tcase WebClient.States.READY:\n\t\t\t\t\t\tthis.connectDeferred_ = new _deferred2.default({\n\t\t\t\t\t\t\thandler: function handler() {\n\t\t\t\t\t\t\t\t_this2.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\t\t\t_this2.emit(WebClient.Events.CONNECTING);\n\t\n\t\t\t\t\t\t\t\tsetTimeout(function (_) {\n\t\t\t\t\t\t\t\t\t_this2.ws_ = new WebSocket(_this2.url);\n\t\t\t\t\t\t\t\t\t_this2.bindEvents_();\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\n\t\t\t\t\t\treturn this.connectDeferred_;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'));\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'disconnect',\n\t\t\tvalue: function disconnect(code, reason) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tswitch (this.state) {\n\t\t\t\t\tcase WebClient.States.ERROR:\n\t\t\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\t\t\tvar deferred = this.disconnectDeferred_ = new _deferred2.default({\n\t\t\t\t\t\t\thandler: function handler() {\n\t\t\t\t\t\t\t\t_this3.ws_.close(code, reason);\n\t\t\t\t\t\t\t\t_this3.state = WebClient.States.CLOSING;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn deferred;\n\t\t\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'bindEvents_',\n\t\t\tvalue: function bindEvents_() {\n\t\t\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\t\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\t\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\t\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'unBindEvents_',\n\t\t\tvalue: function unBindEvents_() {\n\t\t\t\tif (!this.ws_) return;\n\t\t\t\tdelete this.ws_.onopen;\n\t\t\t\tdelete this.ws_.onclose;\n\t\t\t\tdelete this.ws_.onerror;\n\t\t\t\tdelete this.ws_.onmessage;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'disposeConnectionPromisses_',\n\t\t\tvalue: function disposeConnectionPromisses_() {\n\t\t\t\tif (this.connectDeferred_) {\n\t\t\t\t\tthis.connectDeferred_.reject();\n\t\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t\t}\n\t\n\t\t\t\tif (this.disconnectDeferred_) {\n\t\t\t\t\tthis.disconnectDeferred_.reject();\n\t\t\t\t\tthis.disconnectDeferred_ = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onOpen',\n\t\t\tvalue: function onOpen() {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\t// this.updateState_();\n\t\t\t\t// this.emit('_open');\n\t\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\t\treturn _this4.send('_h');\n\t\t\t\t}, { maxCount: 3, initialDelay: 1, increaseFactor: 1 }).then(function (data) {\n\t\t\t\t\t_this4.id = data.id;\n\t\t\t\t\t_this4.serverTimeout_ = data.timeout;\n\t\t\t\t\t_this4.maxReconnectDelay = data.maxReconnectDelay;\n\t\t\t\t\t_this4.initialReconnectDelay = data.initialReconnectDelay;\n\t\t\t\t\t_this4.reconnectIncrementFactor = data.reconnectIncrementFactor;\n\t\n\t\t\t\t\tif (_this4.connectDeferred_) {\n\t\t\t\t\t\t_this4.connectDeferred_.resolve();\n\t\t\t\t\t\t_this4.connectDeferred_ = null;\n\t\t\t\t\t}\n\t\n\t\t\t\t\t_this4.state = WebClient.States.CONNECTED;\n\t\t\t\t\t_this4.emit(WebClient.Events.CONNECTED);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tconsole.log('Handshake failed', err);\n\t\t\t\t\treturn _this4.disconnect();\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tconsole.log('Could not disconnect after failed handshake', err);\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onClose',\n\t\t\tvalue: function onClose(e) {\n\t\t\t\tvar _this5 = this;\n\t\n\t\t\t\tthis.unBindEvents_();\n\t\t\t\tthis.id = null;\n\t\t\t\tthis.ws_ = null;\n\t\t\t\tthis.state = WebClient.States.CLOSED;\n\t\n\t\t\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\t\n\t\t\t\tif (this.connectDeferred_) {\n\t\t\t\t\tthis.connectDeferred_.reject();\n\t\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t\t}\n\t\n\t\t\t\tif (this.disconnectDeferred_) {\n\t\t\t\t\tthis.disconnectDeferred_.resolve();\n\t\t\t\t\tthis.disconnectDeferred_ = null;\n\t\t\t\t}\n\t\n\t\t\t\tif (!this.reconnect || this.retrying_) return;\n\t\n\t\t\t\tthis.retrying_ = true;\n\t\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\t\treturn _this5.connect();\n\t\t\t\t}, {\n\t\t\t\t\tmaxCount: this.maxReconnectDelay,\n\t\t\t\t\tinitialDelay: this.initialReconnectDelay,\n\t\t\t\t\tincreaseFactor: this.reconnectIncrementFactor\n\t\t\t\t}).then(function (_) {\n\t\t\t\t\t_this5.retrying_ = false;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onError',\n\t\t\tvalue: function onError(err) {\n\t\t\t\tvar eventName = this.state == WebClient.States.CONNECTING ? WebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\t\n\t\t\t\tthis.state = WebClient.States.CLOSED;\n\t\n\t\t\t\tthis.emit(eventName, err);\n\t\t\t\tthis.disposeConnectionPromisses_();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onMessage',\n\t\t\tvalue: function onMessage(e) {\n\t\t\t\tvar _this6 = this;\n\t\n\t\t\t\tvar message = _message2.default.parse(e.data);\n\t\n\t\t\t\t// Message without response (no id fields)\n\t\t\t\tif (!message.id && _message2.default.reservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\t\n\t\t\t\t// Message response\n\t\t\t\tif (message.name == '_r' && this.deferreds_[message.id]) {\n\t\t\t\t\tvar deferred = this.deferreds_[message.id];\n\t\n\t\t\t\t\tif (message.err) {\n\t\t\t\t\t\tvar err = _.assign(new Error(), message.err);\n\t\t\t\t\t\tdeferred.reject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t\t\t}\n\t\n\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\t// Message with response\n\t\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\t\t_this6.send_(message.createResponse(null, payload));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\t\tif (_.isObject(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\t\t\t\t\t_this6.send_(message.createResponse(err));\n\t\t\t\t\tmessage.dispose();\n\t\t\t\t});\n\t\n\t\t\t\tthis.emit(message.name, message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send',\n\t\t\tvalue: function send(eventName, payload) {\n\t\t\t\tvar _this7 = this;\n\t\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\tmessage.setId();\n\t\n\t\t\t\treturn this.send_(message).then(function (_) {\n\t\t\t\t\tvar deferred = _this7.deferreds_[message.id] = new _deferred2.default({\n\t\t\t\t\t\tonExpire: function onExpire() {\n\t\t\t\t\t\t\tdelete _this7.deferreds_[message.id];\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttimeout: _this7.serverTimeout_\n\t\t\t\t\t});\n\t\n\t\t\t\t\treturn deferred;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'sendWithoutResponse',\n\t\t\tvalue: function sendWithoutResponse(eventName, payload) {\n\t\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\t\treturn this.send_(message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'send_',\n\t\t\tvalue: function send_(message) {\n\t\t\t\tvar _this8 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve) {\n\t\t\t\t\t_this8.ws_.send(message.toString());\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn WebClient;\n\t}(_commonjs2.default);\n\t\n\tWebClient.States = {\n\t\tREADY: -1,\n\t\tCONNECTING: 0,\n\t\tCONNECTED: 1,\n\t\tCLOSING: 2,\n\t\tCLOSED: 3\n\t};\n\t\n\tWebClient.Events = {\n\t\tREADY: '_ready',\n\t\tCONNECTING: '_connecting',\n\t\tCONNECTING_ERROR: '_connecting_error',\n\t\tCONNECTED: '_connected',\n\t\tCLOSING: '_closing',\n\t\tCLOSED: '_closed',\n\t\tERROR: '_error'\n\t};\n\t\n\tmodule.exports = WebClient;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Deferred = function () {\n\t    function Deferred() {\n\t        var _this = this;\n\t\n\t        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n\t            _ref$handler = _ref.handler,\n\t            handler = _ref$handler === undefined ? function () {} : _ref$handler,\n\t            _ref$onExpire = _ref.onExpire,\n\t            onExpire = _ref$onExpire === undefined ? function () {} : _ref$onExpire,\n\t            _ref$timeout = _ref.timeout,\n\t            timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\t\n\t        _classCallCheck(this, Deferred);\n\t\n\t        this.resolve_ = null;\n\t        this.reject_ = null;\n\t\n\t        this.timeout_ = null;\n\t        this.onExpire_ = onExpire;\n\t        this.isFinished_ = false;\n\t\n\t        this.promise = new Promise(function (resolve, reject) {\n\t            _this.resolve_ = resolve;\n\t            _this.reject_ = reject;\n\t\n\t            try {\n\t                handler(_this);\n\t            } catch (err) {\n\t                _this.reject(err);\n\t            }\n\t        });\n\t\n\t        if (timeout > 0) {\n\t            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n\t        }\n\t    }\n\t\n\t    _createClass(Deferred, [{\n\t        key: 'resolve',\n\t        value: function resolve(data) {\n\t            if (this.isFinished_) return;\n\t\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.resolve_(data);\n\t        }\n\t    }, {\n\t        key: 'reject',\n\t        value: function reject(err) {\n\t            if (this.isFinished_) return;\n\t\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.reject_(err);\n\t        }\n\t    }, {\n\t        key: 'expire',\n\t        value: function expire() {\n\t            this.isFinished_ = true;\n\t            this.clearTimeout_();\n\t            this.onExpire_();\n\t            this.reject_(new Error('Timeout exceed'));\n\t        }\n\t    }, {\n\t        key: 'then',\n\t        value: function then() {\n\t            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t                args[_key] = arguments[_key];\n\t            }\n\t\n\t            return this.promise.then.apply(this.promise, args);\n\t        }\n\t    }, {\n\t        key: 'catch',\n\t        value: function _catch() {\n\t            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t                args[_key2] = arguments[_key2];\n\t            }\n\t\n\t            return this.promise.catch.apply(this.promise, args);\n\t        }\n\t    }, {\n\t        key: 'clearTimeout_',\n\t        value: function clearTimeout_() {\n\t            if (this.timeout_) {\n\t                clearTimeout(this.timeout_);\n\t                this.timeout_ = null;\n\t            }\n\t        }\n\t    }]);\n\t\n\t    return Deferred;\n\t}();\n\t\n\tmodule.exports = Deferred;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _isUndefined = __webpack_require__(7);\n\t\n\tvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\t\n\tvar _nodeUuid = __webpack_require__(8);\n\t\n\tvar uuid = _interopRequireWildcard(_nodeUuid);\n\t\n\tvar _commonjs = __webpack_require__(1);\n\t\n\tvar _commonjs2 = _interopRequireDefault(_commonjs);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Message = function (_EventEmitter) {\n\t\t_inherits(Message, _EventEmitter);\n\t\n\t\t_createClass(Message, null, [{\n\t\t\tkey: 'parse',\n\t\t\tvalue: function parse(raw) {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = JSON.parse(raw);\n\t\t\t\t\treturn new Message({\n\t\t\t\t\t\tname: data.n,\n\t\t\t\t\t\tpayload: data.p,\n\t\t\t\t\t\terr: data.e,\n\t\t\t\t\t\tid: data.i\n\t\t\t\t\t});\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not parse message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}]);\n\t\n\t\tfunction Message(_ref) {\n\t\t\tvar name = _ref.name,\n\t\t\t    payload = _ref.payload,\n\t\t\t    id = _ref.id,\n\t\t\t    err = _ref.err;\n\t\n\t\t\t_classCallCheck(this, Message);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\t\n\t\t\t_this.name = name;\n\t\t\t_this.payload = payload;\n\t\t\t_this.id = id;\n\t\t\t_this.err = err;\n\t\n\t\t\t_this.isResponded_ = false;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(Message, [{\n\t\t\tkey: 'setId',\n\t\t\tvalue: function setId() {\n\t\t\t\tvar id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : uuid.v4();\n\t\n\t\t\t\tthis.id = id;\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'createResponse',\n\t\t\tvalue: function createResponse(err, payload) {\n\t\t\t\treturn new Message({ name: '_r', payload: payload, err: err, id: this.id });\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'resolve',\n\t\t\tvalue: function resolve(payload) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('resolved', payload);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'reject',\n\t\t\tvalue: function reject(err) {\n\t\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\t\n\t\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\t\n\t\t\t\tthis.isResponded_ = true;\n\t\t\t\tthis.emit('rejected', err);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'toString',\n\t\t\tvalue: function toString() {\n\t\t\t\ttry {\n\t\t\t\t\tvar data = { n: this.name };\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\t\n\t\t\t\t\tif (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\t\n\t\t\t\t\treturn JSON.stringify(data);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error('Could not stringify message.');\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'dispose',\n\t\t\tvalue: function dispose() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar events = this.eventNames();\n\t\t\t\tevents.forEach(function (event) {\n\t\t\t\t\treturn _this2.removeAllListeners(event);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Message;\n\t}(_commonjs2.default);\n\t\n\texports.default = Message;\n\t\n\t\n\tMessage.reservedNames = ['_r', '_h'];\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _assign = __webpack_require__(6);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction promiseDelay(ms) {\n\t\treturn new Promise(function (resolve) {\n\t\t\treturn setTimeout(function (_) {\n\t\t\t\treturn resolve();\n\t\t\t}, ms);\n\t\t});\n\t}\n\t\n\tfunction retry(task) {\n\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t\tvar defaults = { maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2 };\n\t\toptions = (0, _assign2.default)(defaults, options);\n\t\tvar timeout = void 0;\n\t\tvar counter = 1;\n\t\tvar delay = options.initialDelay;\n\t\n\t\tvar once = function once() {\n\t\t\treturn task().catch(function (err) {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\t\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(function (_) {\n\t\t\t\t\treturn once();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\n\t\treturn once();\n\t}\n\t\n\tmodule.exports = { promiseDelay: promiseDelay, retry: retry };\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"node-uuid\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"uws\");\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// client-node.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 24e23e06bd4647b47b5c","import WebSocket from 'uws';\nimport WebClient from './client-web';\nglobal.WebSocket = WebSocket;\n\n\nclass NodeClient extends WebClient {\n\tbindEvents_() {\n\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\tthis.ws_.on('error', this.onError.bind(this));\n\n\t\tthis.ws_.on('close', (code, reason) => {\n\t\t\tthis.onClose({code, reason});\n\t\t});\n\n\t\tthis.ws_.on('message', (data) => {\n\t\t\tthis.onMessage({data});\n\t\t});\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.ws_.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\nmodule.exports = NodeClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-node.js","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 1\n// module chunks = 0","import Message from '../lib/message';\nimport Utils from '../lib/utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport Deferred from '../lib/deferred';\n\n\nclass WebClient extends EventEmitter {\n\tconstructor(url = 'ws://localhost', options = {}) {\n\t\tsuper();\n\n\t\tthis.url = url;\n\n\t\tthis.options = options;\n\n\t\tthis.ws_ = null;\n\t\tthis.id = null;\n\t\tthis.readyState = null;\n\t\tthis.reconnect = options.reconnect;\n\n\t\tthis.serverTimeout_ = 30000;\n\t\tthis.maxReconnectDelay = 60;\n\t\tthis.initialReconnectDelay = 1;\n\t\tthis.reconnectIncrementFactor = 2;\n\n\t\tthis.deferreds_ = {};\n\t\tthis.connectDeferred_ = null;\n\t\tthis.disconnectDeferred_ = null;\n\n\t\tthis.state = WebClient.States.READY;\n\t}\n\n\n\tconnect(opt_handshakePayload) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\tcase WebClient.States.READY:\n\t\t\t\tthis.connectDeferred_ = new Deferred({\n\t\t\t\t\thandler: () => {\n\t\t\t\t\t\tthis.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\tthis.emit(WebClient.Events.CONNECTING);\n\n\t\t\t\t\t\tsetTimeout(_ => {\n\t\t\t\t\t\t\tthis.ws_ = new WebSocket(this.url);\n\t\t\t\t\t\t\tthis.bindEvents_();\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn this.connectDeferred_;\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'))\n\t\t}\n\t}\n\n\n\tdisconnect(code, reason) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.ERROR:\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\tconst deferred = this.disconnectDeferred_ = new Deferred({\n\t\t\t\t\thandler: () => {\n\t\t\t\t\t\tthis.ws_.close(code, reason);\n\t\t\t\t\t\tthis.state = WebClient.States.CLOSING;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn deferred;\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t}\n\t}\n\n\n\tbindEvents_() {\n\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t}\n\n\n\tunBindEvents_() {\n\t\tif (!this.ws_) return;\n\t\tdelete this.ws_.onopen;\n\t\tdelete this.ws_.onclose;\n\t\tdelete this.ws_.onerror;\n\t\tdelete this.ws_.onmessage;\n\t}\n\n\n\tdisposeConnectionPromisses_() {\n\t\tif (this.connectDeferred_) {\n\t\t\tthis.connectDeferred_.reject();\n\t\t\tthis.connectDeferred_ = null;\n\t\t}\n\n\t\tif (this.disconnectDeferred_) {\n\t\t\tthis.disconnectDeferred_.reject();\n\t\t\tthis.disconnectDeferred_ = null;\n\t\t}\n\t}\n\n\n\tonOpen() {\n\t\t// this.updateState_();\n\t\t// this.emit('_open');\n\t\tUtils.retry(_ => this.send('_h'), {maxCount: 3, initialDelay: 1, increaseFactor: 1})\n\t\t\t.then(data => {\n\t\t\t\tthis.id = data.id;\n\t\t\t\tthis.serverTimeout_ = data.timeout;\n\t\t\t\tthis.maxReconnectDelay = data.maxReconnectDelay;\n\t\t\t\tthis.initialReconnectDelay = data.initialReconnectDelay;\n\t\t\t\tthis.reconnectIncrementFactor = data.reconnectIncrementFactor;\n\n\t\t\t\tif (this.connectDeferred_) {\n\t\t\t\t\tthis.connectDeferred_.resolve();\n\t\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t\t}\n\n\t\t\t\tthis.state = WebClient.States.CONNECTED;\n\t\t\t\tthis.emit(WebClient.Events.CONNECTED);\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Handshake failed', err);\n\t\t\t\treturn this.disconnect();\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Could not disconnect after failed handshake', err);\n\t\t\t});\n\t}\n\n\n\tonClose(e) {\n\t\tthis.unBindEvents_();\n\t\tthis.id = null;\n\t\tthis.ws_ = null;\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\n\t\tif (this.connectDeferred_) {\n\t\t\tthis.connectDeferred_.reject();\n\t\t\tthis.connectDeferred_ = null;\n\t\t}\n\n\t\tif (this.disconnectDeferred_) {\n\t\t\tthis.disconnectDeferred_.resolve();\n\t\t\tthis.disconnectDeferred_ = null;\n\t\t}\n\n\t\tif (!this.reconnect || this.retrying_) return;\n\n\t\tthis.retrying_ = true;\n\t\tUtils\n\t\t\t.retry(\n\t\t\t\t_ => this.connect(),\n\t\t\t\t{\n\t\t\t\t\tmaxCount: this.maxReconnectDelay,\n\t\t\t\t\tinitialDelay: this.initialReconnectDelay,\n\t\t\t\t\tincreaseFactor: this.reconnectIncrementFactor\n\t\t\t\t})\n\t\t\t.then(_ => {\n\t\t\t\tthis.retrying_ = false;\n\t\t\t});\n\t}\n\n\n\tonError(err) {\n\t\tconst eventName = this.state == WebClient.States.CONNECTING ?\n\t\t\t\tWebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(eventName, err);\n\t\tthis.disposeConnectionPromisses_();\n\t}\n\n\n\tonMessage(e) {\n\t\tconst message = Message.parse(e.data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.reservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Message response\n\t\tif (message.name == '_r' && this.deferreds_[message.id]) {\n\t\t\tconst deferred = this.deferreds_[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = _.assign(new Error(), message.err);\n\t\t\t\tdeferred.reject(err);\n\t\t\t} else {\n\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.deferreds_[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tmessage.setId();\n\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\tconst deferred = this.deferreds_[message.id] = new Deferred({\n\t\t\t\t\tonExpire: () => {\n\t\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: this.serverTimeout_\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise(resolve => {\n\t\t\tthis.ws_.send(message.toString());\n\t\t\tresolve();\n\t\t});\n\t}\n}\n\nWebClient.States = {\n\tREADY: -1,\n\tCONNECTING: 0,\n\tCONNECTED: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nWebClient.Events = {\n\tREADY: '_ready',\n\tCONNECTING: '_connecting',\n\tCONNECTING_ERROR: '_connecting_error',\n\tCONNECTED: '_connected',\n\tCLOSING: '_closing',\n\tCLOSED: '_closed',\n\tERROR: '_error'\n};\n\n\nmodule.exports = WebClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-web.js","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import isUndefined from 'lodash/isUndefined';\nimport * as uuid from 'node-uuid';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = uuid.v4()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\nMessage.reservedNames = ['_r', '_h'];\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\nmodule.exports = {promiseDelay, retry};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}