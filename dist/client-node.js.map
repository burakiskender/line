{"version":3,"sources":["webpack:///client-node.js","webpack:///webpack/bootstrap d43b8e21f4b78a7ec492","webpack:///./src/lib/utils.js","webpack:///external \"event-emitter-extra/dist/commonjs.modern\"","webpack:///./src/client/client-web.js","webpack:///external \"uws\"","webpack:///./src/lib/deferred.js","webpack:///./src/lib/message.js","webpack:///external \"lodash/assign\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isObject\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"lodash/values\"","webpack:///./src/client/client-node.js"],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","Object","defineProperty","configurable","enumerable","get","n","__esModule","o","object","property","prototype","hasOwnProperty","p","s","_interopRequireDefault","obj","default","promiseDelay","ms","Promise","resolve","setTimeout","_","retry","task","options","arguments","length","undefined","defaults","maxDelay","maxCount","initialDelay","increaseFactor","_assign2","timeout","counter","delay","once","catch","err","clearTimeout","then","generateDummyId","Math","random","pow","toString","slice","_assign","require","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_message","_message2","_utils","_utils2","_commonjs","_commonjs2","_deferred","_deferred2","WebClient","_EventEmitter","url","this","_this","getPrototypeOf","ws_","id","readyState","reconnect","serverTimeout_","maxReconnectDelay","initialReconnectDelay","reconnectIncrementFactor","deferreds_","connectDeferred_","disconnectDeferred_","state","States","READY","opt_handshakePayload","_this2","CONNECTING","reject","Error","CONNECTED","CLOSING","CLOSED","handler","emit","Events","WebSocket","bindEvents_","code","reason","_this3","ERROR","deferred","close","onopen","onOpen","bind","onclose","onClose","onerror","onError","onmessage","onMessage","_this4","send","Names","HANDSHAKE","data","console","log","disconnect","e","_this5","unBindEvents_","retrying_","connect","eventName","CONNECTING_ERROR","disposeConnectionPromisses_","_this6","message","parse","ReservedNames","indexOf","RESPONSE","assign","payload","send_","createResponse","dispose","isObject","_this7","setId","onExpire","_this8","Deferred","_ref","_ref$handler","_ref$onExpire","_ref$timeout","resolve_","reject_","timeout_","onExpire_","isFinished_","promise","expire","clearTimeout_","_len","args","Array","_key","apply","_len2","_key2","_isUndefined","_isUndefined2","_isObject","_isObject2","_isFunction","_isFunction2","_values","_values2","Message","isResponded_","raw","JSON","warn","response","stringify","events","eventNames","forEach","event","removeAllListeners","_uws","_uws2","_clientWeb","_clientWeb2","global","NodeClient","_WebClient","on"],"mappings":"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","file":"client-node.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmory imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmory exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tObject.defineProperty(exports, name, {\n/******/ \t\t\tconfigurable: false,\n/******/ \t\t\tenumerable: true,\n/******/ \t\t\tget: getter\n/******/ \t\t});\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 11);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\"use strict\";\n\nvar _assign = __webpack_require__(6);\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction promiseDelay(ms) {\n\treturn new Promise(function (resolve) {\n\t\treturn setTimeout(function (_) {\n\t\t\treturn resolve();\n\t\t}, ms);\n\t});\n}\n\nfunction retry(task) {\n\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\tvar defaults = { maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2 };\n\toptions = (0, _assign2.default)(defaults, options);\n\tvar timeout = void 0;\n\tvar counter = 1;\n\tvar delay = options.initialDelay;\n\n\tvar once = function once() {\n\t\treturn task().catch(function (err) {\n\t\t\tcounter++;\n\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn promiseDelay(delay * 1000 / 2).then(function (_) {\n\t\t\t\treturn once();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn once();\n}\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId() {\n\tvar length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4;\n\n\treturn (\"0000\" + (Math.random() * Math.pow(36, length) << 0).toString(36)).slice(-length);\n}\n\nmodule.exports = { promiseDelay: promiseDelay, retry: retry, generateDummyId: generateDummyId };\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _message = __webpack_require__(5);\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _utils = __webpack_require__(0);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _commonjs = __webpack_require__(1);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nvar _deferred = __webpack_require__(4);\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar WebClient = function (_EventEmitter) {\n\t_inherits(WebClient, _EventEmitter);\n\n\tfunction WebClient() {\n\t\tvar url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'ws://localhost';\n\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\t_classCallCheck(this, WebClient);\n\n\t\tvar _this = _possibleConstructorReturn(this, (WebClient.__proto__ || Object.getPrototypeOf(WebClient)).call(this));\n\n\t\t_this.url = url;\n\n\t\t_this.options = options;\n\n\t\t_this.ws_ = null;\n\t\t_this.id = null;\n\t\t_this.readyState = null;\n\t\t_this.reconnect = options.reconnect;\n\n\t\t_this.serverTimeout_ = 30000;\n\t\t_this.maxReconnectDelay = 60;\n\t\t_this.initialReconnectDelay = 1;\n\t\t_this.reconnectIncrementFactor = 2;\n\n\t\t_this.deferreds_ = {};\n\t\t_this.connectDeferred_ = null;\n\t\t_this.disconnectDeferred_ = null;\n\n\t\t_this.state = WebClient.States.READY;\n\t\treturn _this;\n\t}\n\n\t_createClass(WebClient, [{\n\t\tkey: 'connect',\n\t\tvalue: function connect(opt_handshakePayload) {\n\t\t\tvar _this2 = this;\n\n\t\t\tswitch (this.state) {\n\t\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\tcase WebClient.States.READY:\n\t\t\t\t\tthis.connectDeferred_ = new _deferred2.default({\n\t\t\t\t\t\thandler: function handler() {\n\t\t\t\t\t\t\t_this2.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\t\t_this2.emit(WebClient.Events.CONNECTING);\n\n\t\t\t\t\t\t\tsetTimeout(function (_) {\n\t\t\t\t\t\t\t\t_this2.ws_ = new WebSocket(_this2.url);\n\t\t\t\t\t\t\t\t_this2.bindEvents_();\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this.connectDeferred_;\n\t\t\t\tdefault:\n\t\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'));\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'disconnect',\n\t\tvalue: function disconnect(code, reason) {\n\t\t\tvar _this3 = this;\n\n\t\t\tswitch (this.state) {\n\t\t\t\tcase WebClient.States.ERROR:\n\t\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\t\tvar deferred = this.disconnectDeferred_ = new _deferred2.default({\n\t\t\t\t\t\thandler: function handler() {\n\t\t\t\t\t\t\t_this3.ws_.close(code, reason);\n\t\t\t\t\t\t\t_this3.state = WebClient.States.CLOSING;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred;\n\t\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'bindEvents_',\n\t\tvalue: function bindEvents_() {\n\t\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t\t}\n\t}, {\n\t\tkey: 'unBindEvents_',\n\t\tvalue: function unBindEvents_() {\n\t\t\tif (!this.ws_) return;\n\t\t\tdelete this.ws_.onopen;\n\t\t\tdelete this.ws_.onclose;\n\t\t\tdelete this.ws_.onerror;\n\t\t\tdelete this.ws_.onmessage;\n\t\t}\n\t}, {\n\t\tkey: 'disposeConnectionPromisses_',\n\t\tvalue: function disposeConnectionPromisses_() {\n\t\t\tif (this.connectDeferred_) {\n\t\t\t\tthis.connectDeferred_.reject();\n\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t}\n\n\t\t\tif (this.disconnectDeferred_) {\n\t\t\t\tthis.disconnectDeferred_.reject();\n\t\t\t\tthis.disconnectDeferred_ = null;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'onOpen',\n\t\tvalue: function onOpen() {\n\t\t\tvar _this4 = this;\n\n\t\t\t// this.updateState_();\n\t\t\t// this.emit('_open');\n\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\treturn _this4.send(_message2.default.Names.HANDSHAKE);\n\t\t\t}, { maxCount: 3, initialDelay: 1, increaseFactor: 1 }).then(function (data) {\n\t\t\t\t_this4.id = data.id;\n\t\t\t\t_this4.serverTimeout_ = data.timeout;\n\t\t\t\t_this4.maxReconnectDelay = data.maxReconnectDelay;\n\t\t\t\t_this4.initialReconnectDelay = data.initialReconnectDelay;\n\t\t\t\t_this4.reconnectIncrementFactor = data.reconnectIncrementFactor;\n\n\t\t\t\tif (_this4.connectDeferred_) {\n\t\t\t\t\t_this4.connectDeferred_.resolve();\n\t\t\t\t\t_this4.connectDeferred_ = null;\n\t\t\t\t}\n\n\t\t\t\t_this4.state = WebClient.States.CONNECTED;\n\t\t\t\t_this4.emit(WebClient.Events.CONNECTED);\n\t\t\t}).catch(function (err) {\n\t\t\t\tconsole.log('Handshake failed', err);\n\t\t\t\treturn _this4.disconnect();\n\t\t\t}).catch(function (err) {\n\t\t\t\tconsole.log('Could not disconnect after failed handshake', err);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'onClose',\n\t\tvalue: function onClose(e) {\n\t\t\tvar _this5 = this;\n\n\t\t\tthis.unBindEvents_();\n\t\t\tthis.id = null;\n\t\t\tthis.ws_ = null;\n\t\t\tthis.state = WebClient.States.CLOSED;\n\n\t\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\n\t\t\tif (this.connectDeferred_) {\n\t\t\t\tthis.connectDeferred_.reject();\n\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t}\n\n\t\t\tif (this.disconnectDeferred_) {\n\t\t\t\tthis.disconnectDeferred_.resolve();\n\t\t\t\tthis.disconnectDeferred_ = null;\n\t\t\t}\n\n\t\t\tif (!this.reconnect || this.retrying_) return;\n\n\t\t\tthis.retrying_ = true;\n\t\t\t_utils2.default.retry(function (_) {\n\t\t\t\treturn _this5.connect();\n\t\t\t}, {\n\t\t\t\tmaxCount: this.maxReconnectDelay,\n\t\t\t\tinitialDelay: this.initialReconnectDelay,\n\t\t\t\tincreaseFactor: this.reconnectIncrementFactor\n\t\t\t}).then(function (_) {\n\t\t\t\t_this5.retrying_ = false;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'onError',\n\t\tvalue: function onError(err) {\n\t\t\tvar eventName = this.state == WebClient.States.CONNECTING ? WebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\n\t\t\tthis.state = WebClient.States.CLOSED;\n\n\t\t\tthis.emit(eventName, err);\n\t\t\tthis.disposeConnectionPromisses_();\n\t\t}\n\t}, {\n\t\tkey: 'onMessage',\n\t\tvalue: function onMessage(e) {\n\t\t\tvar _this6 = this;\n\n\t\t\tvar message = _message2.default.parse(e.data);\n\n\t\t\t// Message without response (no id fields)\n\t\t\tif (!message.id && _message2.default.ReservedNames.indexOf(message.name) == -1) return this.emit(message.name, message);\n\n\t\t\t// Message response\n\t\t\tif (message.name == _message2.default.Names.RESPONSE && this.deferreds_[message.id]) {\n\t\t\t\tvar deferred = this.deferreds_[message.id];\n\n\t\t\t\tif (message.err) {\n\t\t\t\t\tvar err = _.assign(new Error(), message.err);\n\t\t\t\t\tdeferred.reject(err);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t\t}\n\n\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Message with response\n\t\t\tmessage.once('resolved', function (payload) {\n\t\t\t\t_this6.send_(message.createResponse(null, payload));\n\t\t\t\tmessage.dispose();\n\t\t\t});\n\n\t\t\tmessage.once('rejected', function (err) {\n\t\t\t\tif (_.isObject(err) && err instanceof Error && err.name == 'Error') err = { message: err.message, name: 'Error' };\n\t\t\t\t_this6.send_(message.createResponse(err));\n\t\t\t\tmessage.dispose();\n\t\t\t});\n\n\t\t\tthis.emit(message.name, message);\n\t\t}\n\t}, {\n\t\tkey: 'send',\n\t\tvalue: function send(eventName, payload) {\n\t\t\tvar _this7 = this;\n\n\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\tmessage.setId();\n\n\t\t\treturn this.send_(message).then(function (_) {\n\t\t\t\tvar deferred = _this7.deferreds_[message.id] = new _deferred2.default({\n\t\t\t\t\tonExpire: function onExpire() {\n\t\t\t\t\t\tdelete _this7.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: _this7.serverTimeout_\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'sendWithoutResponse',\n\t\tvalue: function sendWithoutResponse(eventName, payload) {\n\t\t\tvar message = new _message2.default({ name: eventName, payload: payload });\n\t\t\treturn this.send_(message);\n\t\t}\n\t}, {\n\t\tkey: 'send_',\n\t\tvalue: function send_(message) {\n\t\t\tvar _this8 = this;\n\n\t\t\treturn new Promise(function (resolve) {\n\t\t\t\t_this8.ws_.send(message.toString());\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn WebClient;\n}(_commonjs2.default);\n\nWebClient.States = {\n\tREADY: -1,\n\tCONNECTING: 0,\n\tCONNECTED: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nWebClient.Events = {\n\tREADY: '_ready',\n\tCONNECTING: '_connecting',\n\tCONNECTING_ERROR: '_connecting_error',\n\tCONNECTED: '_connected',\n\tCLOSING: '_closing',\n\tCLOSED: '_closed',\n\tERROR: '_error'\n};\n\nmodule.exports = WebClient;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"uws\");\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Deferred = function () {\n    function Deferred() {\n        var _this = this;\n\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            _ref$handler = _ref.handler,\n            handler = _ref$handler === undefined ? function () {} : _ref$handler,\n            _ref$onExpire = _ref.onExpire,\n            onExpire = _ref$onExpire === undefined ? function () {} : _ref$onExpire,\n            _ref$timeout = _ref.timeout,\n            timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\n        _classCallCheck(this, Deferred);\n\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise(function (resolve, reject) {\n            _this.resolve_ = resolve;\n            _this.reject_ = reject;\n\n            try {\n                handler(_this);\n            } catch (err) {\n                _this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n    _createClass(Deferred, [{\n        key: 'resolve',\n        value: function resolve(data) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.resolve_(data);\n        }\n    }, {\n        key: 'reject',\n        value: function reject(err) {\n            if (this.isFinished_) return;\n\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.reject_(err);\n        }\n    }, {\n        key: 'expire',\n        value: function expire() {\n            this.isFinished_ = true;\n            this.clearTimeout_();\n            this.onExpire_();\n            this.reject_(new Error('Timeout exceed'));\n        }\n    }, {\n        key: 'then',\n        value: function then() {\n            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                args[_key] = arguments[_key];\n            }\n\n            return this.promise.then.apply(this.promise, args);\n        }\n    }, {\n        key: 'catch',\n        value: function _catch() {\n            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                args[_key2] = arguments[_key2];\n            }\n\n            return this.promise.catch.apply(this.promise, args);\n        }\n    }, {\n        key: 'clearTimeout_',\n        value: function clearTimeout_() {\n            if (this.timeout_) {\n                clearTimeout(this.timeout_);\n                this.timeout_ = null;\n            }\n        }\n    }]);\n\n    return Deferred;\n}();\n\nmodule.exports = Deferred;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _isUndefined = __webpack_require__(9);\n\nvar _isUndefined2 = _interopRequireDefault(_isUndefined);\n\nvar _isObject = __webpack_require__(8);\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nvar _isFunction = __webpack_require__(7);\n\nvar _isFunction2 = _interopRequireDefault(_isFunction);\n\nvar _values = __webpack_require__(10);\n\nvar _values2 = _interopRequireDefault(_values);\n\nvar _utils = __webpack_require__(0);\n\nvar _commonjs = __webpack_require__(1);\n\nvar _commonjs2 = _interopRequireDefault(_commonjs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Message = function (_EventEmitter) {\n\t_inherits(Message, _EventEmitter);\n\n\t_createClass(Message, null, [{\n\t\tkey: 'parse',\n\t\tvalue: function parse(raw) {\n\t\t\ttry {\n\t\t\t\tvar data = JSON.parse(raw);\n\t\t\t\treturn new Message({\n\t\t\t\t\tname: data.n,\n\t\t\t\t\tpayload: data.p,\n\t\t\t\t\terr: data.e,\n\t\t\t\t\tid: data.i\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tthrow new Error('Could not parse message.');\n\t\t\t}\n\t\t}\n\t}]);\n\n\tfunction Message(_ref) {\n\t\tvar name = _ref.name,\n\t\t    payload = _ref.payload,\n\t\t    id = _ref.id,\n\t\t    err = _ref.err;\n\n\t\t_classCallCheck(this, Message);\n\n\t\tvar _this = _possibleConstructorReturn(this, (Message.__proto__ || Object.getPrototypeOf(Message)).call(this));\n\n\t\t_this.name = name;\n\t\t_this.payload = payload;\n\t\t_this.id = id;\n\t\t_this.err = err;\n\n\t\t_this.isResponded_ = false;\n\t\treturn _this;\n\t}\n\n\t_createClass(Message, [{\n\t\tkey: 'setId',\n\t\tvalue: function setId() {\n\t\t\tvar id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (0, _utils.generateDummyId)();\n\n\t\t\tthis.id = id;\n\t\t\treturn id;\n\t\t}\n\t}, {\n\t\tkey: 'createResponse',\n\t\tvalue: function createResponse(err, payload) {\n\t\t\treturn new Message({ name: '_r', payload: payload, err: err, id: this.id });\n\t\t}\n\t}, {\n\t\tkey: 'resolve',\n\t\tvalue: function resolve(payload) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be resolved.');\n\n\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n\t\t\t// If thenable\n\t\t\tif ((0, _isObject2.default)(payload) && (0, _isFunction2.default)(payload.then)) {\n\t\t\t\tpayload.then(function (response) {\n\t\t\t\t\t_this2.isResponded_ = true;\n\t\t\t\t\t_this2.emit('resolved', payload);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t_this2.isResponded_ = true;\n\t\t\t\t\t_this2.emit('rejected', err);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isResponded_ = true;\n\t\t\tthis.emit('resolved', payload);\n\t\t}\n\t}, {\n\t\tkey: 'reject',\n\t\tvalue: function reject(err) {\n\t\t\tif ((0, _isUndefined2.default)(this.id)) return console.warn('[line] A message without an id cannot be rejected.');\n\n\t\t\tif (this.isResponded_) return console.warn('[line] This message has already been ended.');\n\n\t\t\tthis.isResponded_ = true;\n\t\t\tthis.emit('rejected', err);\n\t\t}\n\t}, {\n\t\tkey: 'toString',\n\t\tvalue: function toString() {\n\t\t\ttry {\n\t\t\t\tvar data = { n: this.name };\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.payload)) data.p = this.payload;\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.id)) data.i = this.id;\n\n\t\t\t\tif (!(0, _isUndefined2.default)(this.err)) data.e = this.err;\n\n\t\t\t\treturn JSON.stringify(data);\n\t\t\t} catch (err) {\n\t\t\t\tthrow new Error('Could not stringify message.');\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'dispose',\n\t\tvalue: function dispose() {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar events = this.eventNames();\n\t\t\tevents.forEach(function (event) {\n\t\t\t\treturn _this3.removeAllListeners(event);\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Message;\n}(_commonjs2.default);\n\nexports.default = Message;\n\n\nMessage.Names = {\n\tRESPONSE: '_r',\n\tHANDSHAKE: '_h'\n};\n\nMessage.ReservedNames = (0, _values2.default)(Message.Names);\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/assign\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isFunction\");\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isObject\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/isUndefined\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"lodash/values\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _uws = __webpack_require__(3);\n\nvar _uws2 = _interopRequireDefault(_uws);\n\nvar _clientWeb = __webpack_require__(2);\n\nvar _clientWeb2 = _interopRequireDefault(_clientWeb);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nglobal.WebSocket = _uws2.default;\n\nvar NodeClient = function (_WebClient) {\n\t_inherits(NodeClient, _WebClient);\n\n\tfunction NodeClient() {\n\t\t_classCallCheck(this, NodeClient);\n\n\t\treturn _possibleConstructorReturn(this, (NodeClient.__proto__ || Object.getPrototypeOf(NodeClient)).apply(this, arguments));\n\t}\n\n\t_createClass(NodeClient, [{\n\t\tkey: 'bindEvents_',\n\t\tvalue: function bindEvents_() {\n\t\t\tvar _this2 = this;\n\n\t\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\t\tthis.ws_.on('error', this.onError.bind(this));\n\n\t\t\tthis.ws_.on('close', function (code, reason) {\n\t\t\t\t_this2.onClose({ code: code, reason: reason });\n\t\t\t});\n\n\t\t\tthis.ws_.on('message', function (data) {\n\t\t\t\t_this2.onMessage({ data: data });\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'send_',\n\t\tvalue: function send_(message) {\n\t\t\tvar _this3 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this3.ws_.send(message.toString(), function (err) {\n\t\t\t\t\tif (err) return reject(err);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn NodeClient;\n}(_clientWeb2.default);\n\nmodule.exports = NodeClient;\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// client-node.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d43b8e21f4b78a7ec492","import assign from 'lodash/assign';\n\n\nfunction promiseDelay(ms) {\n\treturn new Promise(resolve => setTimeout(_ => resolve(), ms))\n}\n\n\nfunction retry(task, options = {}) {\n\tconst defaults = {maxDelay: 160, maxCount: 0, initialDelay: 3, increaseFactor: 2};\n\toptions = assign(defaults, options);\n\tlet timeout;\n\tlet counter = 1;\n\tlet delay = options.initialDelay;\n\n\tconst once = function() {\n\t\treturn task()\n\t\t\t.catch(err => {\n\t\t\t\tcounter++;\n\t\t\t\tdelay = delay * options.increaseFactor;\n\n\t\t\t\tif (options.maxCount != 0 && counter > options.maxCount) {\n\t\t\t\t\ttimeout && clearTimeout(timeout);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\treturn promiseDelay(delay * 1000 / 2).then(_ => once());\n\t\t\t});\n\t}\n\n\treturn once();\n}\n\n\n// http://stackoverflow.com/a/6248722\nfunction generateDummyId(length = 4) {\n\treturn (\"0000\" + (Math.random()*Math.pow(36,length) << 0).toString(36)).slice(-length);\n}\n\n\nmodule.exports = {promiseDelay, retry, generateDummyId};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils.js","module.exports = require(\"event-emitter-extra/dist/commonjs.modern\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-emitter-extra/dist/commonjs.modern\"\n// module id = 1\n// module chunks = 0","import Message from '../lib/message';\nimport Utils from '../lib/utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\nimport Deferred from '../lib/deferred';\n\n\nclass WebClient extends EventEmitter {\n\tconstructor(url = 'ws://localhost', options = {}) {\n\t\tsuper();\n\n\t\tthis.url = url;\n\n\t\tthis.options = options;\n\n\t\tthis.ws_ = null;\n\t\tthis.id = null;\n\t\tthis.readyState = null;\n\t\tthis.reconnect = options.reconnect;\n\n\t\tthis.serverTimeout_ = 30000;\n\t\tthis.maxReconnectDelay = 60;\n\t\tthis.initialReconnectDelay = 1;\n\t\tthis.reconnectIncrementFactor = 2;\n\n\t\tthis.deferreds_ = {};\n\t\tthis.connectDeferred_ = null;\n\t\tthis.disconnectDeferred_ = null;\n\n\t\tthis.state = WebClient.States.READY;\n\t}\n\n\n\tconnect(opt_handshakePayload) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, already trying to connect to a host...'));\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\t\treturn Promise.reject(new Error('Already connected.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Terminating an active connecting, try again later.'));\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\tcase WebClient.States.READY:\n\t\t\t\tthis.connectDeferred_ = new Deferred({\n\t\t\t\t\thandler: () => {\n\t\t\t\t\t\tthis.state = WebClient.States.CONNECTING;\n\t\t\t\t\t\tthis.emit(WebClient.Events.CONNECTING);\n\n\t\t\t\t\t\tsetTimeout(_ => {\n\t\t\t\t\t\t\tthis.ws_ = new WebSocket(this.url);\n\t\t\t\t\t\t\tthis.bindEvents_();\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn this.connectDeferred_;\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject(new Error('Could not connect, unknown state.'))\n\t\t}\n\t}\n\n\n\tdisconnect(code, reason) {\n\t\tswitch (this.state) {\n\t\t\tcase WebClient.States.ERROR:\n\t\t\tcase WebClient.States.CONNECTED:\n\t\t\tcase WebClient.States.CONNECTING:\n\t\t\t\tconst deferred = this.disconnectDeferred_ = new Deferred({\n\t\t\t\t\thandler: () => {\n\t\t\t\t\t\tthis.ws_.close(code, reason);\n\t\t\t\t\t\tthis.state = WebClient.States.CLOSING;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn deferred;\n\t\t\tcase WebClient.States.CLOSED:\n\t\t\t\treturn Promise.reject(new Error('There is no connection to disconnect.'));\n\t\t\tcase WebClient.States.CLOSING:\n\t\t\t\treturn Promise.reject(new Error('Already terminating a connecting, try again later.'));\n\t\t}\n\t}\n\n\n\tbindEvents_() {\n\t\tthis.ws_.onopen = this.onOpen.bind(this);\n\t\tthis.ws_.onclose = this.onClose.bind(this);\n\t\tthis.ws_.onerror = this.onError.bind(this);\n\t\tthis.ws_.onmessage = this.onMessage.bind(this);\n\t}\n\n\n\tunBindEvents_() {\n\t\tif (!this.ws_) return;\n\t\tdelete this.ws_.onopen;\n\t\tdelete this.ws_.onclose;\n\t\tdelete this.ws_.onerror;\n\t\tdelete this.ws_.onmessage;\n\t}\n\n\n\tdisposeConnectionPromisses_() {\n\t\tif (this.connectDeferred_) {\n\t\t\tthis.connectDeferred_.reject();\n\t\t\tthis.connectDeferred_ = null;\n\t\t}\n\n\t\tif (this.disconnectDeferred_) {\n\t\t\tthis.disconnectDeferred_.reject();\n\t\t\tthis.disconnectDeferred_ = null;\n\t\t}\n\t}\n\n\n\tonOpen() {\n\t\t// this.updateState_();\n\t\t// this.emit('_open');\n\t\tUtils.retry(_ => this.send(Message.Names.HANDSHAKE), {maxCount: 3, initialDelay: 1, increaseFactor: 1})\n\t\t\t.then(data => {\n\t\t\t\tthis.id = data.id;\n\t\t\t\tthis.serverTimeout_ = data.timeout;\n\t\t\t\tthis.maxReconnectDelay = data.maxReconnectDelay;\n\t\t\t\tthis.initialReconnectDelay = data.initialReconnectDelay;\n\t\t\t\tthis.reconnectIncrementFactor = data.reconnectIncrementFactor;\n\n\t\t\t\tif (this.connectDeferred_) {\n\t\t\t\t\tthis.connectDeferred_.resolve();\n\t\t\t\t\tthis.connectDeferred_ = null;\n\t\t\t\t}\n\n\t\t\t\tthis.state = WebClient.States.CONNECTED;\n\t\t\t\tthis.emit(WebClient.Events.CONNECTED);\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Handshake failed', err);\n\t\t\t\treturn this.disconnect();\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('Could not disconnect after failed handshake', err);\n\t\t\t});\n\t}\n\n\n\tonClose(e) {\n\t\tthis.unBindEvents_();\n\t\tthis.id = null;\n\t\tthis.ws_ = null;\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(WebClient.Events.CLOSED, e.code, e.reason);\n\n\t\tif (this.connectDeferred_) {\n\t\t\tthis.connectDeferred_.reject();\n\t\t\tthis.connectDeferred_ = null;\n\t\t}\n\n\t\tif (this.disconnectDeferred_) {\n\t\t\tthis.disconnectDeferred_.resolve();\n\t\t\tthis.disconnectDeferred_ = null;\n\t\t}\n\n\t\tif (!this.reconnect || this.retrying_) return;\n\n\t\tthis.retrying_ = true;\n\t\tUtils\n\t\t\t.retry(\n\t\t\t\t_ => this.connect(),\n\t\t\t\t{\n\t\t\t\t\tmaxCount: this.maxReconnectDelay,\n\t\t\t\t\tinitialDelay: this.initialReconnectDelay,\n\t\t\t\t\tincreaseFactor: this.reconnectIncrementFactor\n\t\t\t\t})\n\t\t\t.then(_ => {\n\t\t\t\tthis.retrying_ = false;\n\t\t\t});\n\t}\n\n\n\tonError(err) {\n\t\tconst eventName = this.state == WebClient.States.CONNECTING ?\n\t\t\t\tWebClient.Events.CONNECTING_ERROR : WebClient.Events.ERROR;\n\n\t\tthis.state = WebClient.States.CLOSED;\n\n\t\tthis.emit(eventName, err);\n\t\tthis.disposeConnectionPromisses_();\n\t}\n\n\n\tonMessage(e) {\n\t\tconst message = Message.parse(e.data);\n\n\t\t// Message without response (no id fields)\n\t\tif (!message.id && Message.ReservedNames.indexOf(message.name) == -1)\n\t\t\treturn this.emit(message.name, message);\n\n\t\t// Message response\n\t\tif (message.name == Message.Names.RESPONSE && this.deferreds_[message.id]) {\n\t\t\tconst deferred = this.deferreds_[message.id];\n\n\t\t\tif (message.err) {\n\t\t\t\tconst err = _.assign(new Error(), message.err);\n\t\t\t\tdeferred.reject(err);\n\t\t\t} else {\n\t\t\t\tdeferred.resolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.deferreds_[message.id];\n\t\t\treturn;\n\t\t}\n\n\t\t// Message with response\n\t\tmessage.once('resolved', payload => {\n\t\t\tthis.send_(message.createResponse(null, payload));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tmessage.once('rejected', err => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t           err = {message: err.message, name: 'Error'};\n\t\t\tthis.send_(message.createResponse(err));\n\t\t\tmessage.dispose();\n\t\t});\n\n\t\tthis.emit(message.name, message);\n\t}\n\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\tmessage.setId();\n\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\tconst deferred = this.deferreds_[message.id] = new Deferred({\n\t\t\t\t\tonExpire: () => {\n\t\t\t\t\t\tdelete this.deferreds_[message.id];\n\t\t\t\t\t},\n\t\t\t\t\ttimeout: this.serverTimeout_\n\t\t\t\t});\n\n\t\t\t\treturn deferred;\n\t\t\t});\n\t}\n\n\n\tsendWithoutResponse(eventName, payload) {\n\t\tconst message = new Message({name: eventName, payload});\n\t\treturn this.send_(message);\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise(resolve => {\n\t\t\tthis.ws_.send(message.toString());\n\t\t\tresolve();\n\t\t});\n\t}\n}\n\nWebClient.States = {\n\tREADY: -1,\n\tCONNECTING: 0,\n\tCONNECTED: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nWebClient.Events = {\n\tREADY: '_ready',\n\tCONNECTING: '_connecting',\n\tCONNECTING_ERROR: '_connecting_error',\n\tCONNECTED: '_connected',\n\tCLOSING: '_closing',\n\tCLOSED: '_closed',\n\tERROR: '_error'\n};\n\n\nmodule.exports = WebClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-web.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 3\n// module chunks = 0","class Deferred {\n    constructor({\n        handler = () => {},\n        onExpire = () => {},\n        timeout = 0\n    } = {}) {\n        this.resolve_ = null;\n        this.reject_ = null;\n\n        this.timeout_ = null;\n        this.onExpire_ = onExpire;\n        this.isFinished_ = false;\n\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve_ = resolve;\n            this.reject_ = reject;\n\n            try {\n                handler(this);\n            } catch (err) {\n                this.reject(err);\n            }\n        });\n\n        if (timeout > 0) {\n            this.timeout_ = setTimeout(this.expire.bind(this), timeout);\n        }\n    }\n\n\n    resolve(data) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.resolve_(data);\n    }\n\n\n    reject(err) {\n        if (this.isFinished_) return;\n\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.reject_(err);\n    }\n\n\n    expire() {\n        this.isFinished_ = true;\n        this.clearTimeout_();\n        this.onExpire_();\n        this.reject_(new Error('Timeout exceed'));\n    }\n\n\n    then(...args) {\n        return this.promise.then.apply(this.promise, args);\n    }\n\n\n    catch(...args) {\n        return this.promise.catch.apply(this.promise, args);\n    }\n\n\n    clearTimeout_() {\n        if (this.timeout_) {\n            clearTimeout(this.timeout_);\n            this.timeout_ = null;\n        }\n    }\n}\n\n\nmodule.exports = Deferred;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/deferred.js","import isUndefined from 'lodash/isUndefined';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport values from 'lodash/values';\nimport {generateDummyId} from './utils';\nimport EventEmitter from 'event-emitter-extra/dist/commonjs.modern';\n\n\n\nexport default class Message extends EventEmitter {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message({\n\t\t\t\tname: data.n,\n\t\t\t\tpayload: data.p,\n\t\t\t\terr: data.e,\n\t\t\t\tid: data.i\n\t\t\t});\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor({name, payload, id, err}) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.payload = payload;\n\t\tthis.id = id;\n\t\tthis.err = err;\n\n\t\tthis.isResponded_ = false;\n\t}\n\n\tsetId(id = generateDummyId()) {\n\t\tthis.id = id;\n\t\treturn id;\n\t}\n\n\tcreateResponse(err, payload) {\n\t\treturn new Message({name: '_r', payload, err, id: this.id});\n\t}\n\n\tresolve(payload) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be resolved.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\t// If thenable\n\t\tif (isObject(payload) && isFunction(payload.then)) {\n\t\t\tpayload\n\t\t\t\t.then(response => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('resolved', payload);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tthis.isResponded_ = true;\n\t\t\t\t\tthis.emit('rejected', err);\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('resolved', payload);\n\t}\n\n\treject(err) {\n\t\tif (isUndefined(this.id))\n\t\t\treturn console.warn('[line] A message without an id cannot be rejected.');\n\n\t\tif (this.isResponded_)\n\t\t\treturn console.warn('[line] This message has already been ended.');\n\n\t\tthis.isResponded_ = true;\n\t\tthis.emit('rejected', err);\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {n: this.name};\n\n\t\t\tif (!isUndefined(this.payload))\n\t\t\t\tdata.p = this.payload;\n\n\t\t\tif (!isUndefined(this.id))\n\t\t\t\tdata.i = this.id;\n\n\t\t\tif (!isUndefined(this.err))\n\t\t\t\tdata.e = this.err;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tconst events = this.eventNames();\n\t\tevents.forEach(event => this.removeAllListeners(event));\n\t}\n}\n\n\nMessage.Names = {\n\tRESPONSE: '_r',\n\tHANDSHAKE: '_h'\n};\n\n\nMessage.ReservedNames = values(Message.Names);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/assign\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"lodash/isObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isObject\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"lodash/isUndefined\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isUndefined\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"lodash/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/values\"\n// module id = 10\n// module chunks = 0","import WebSocket from 'uws';\nimport WebClient from './client-web';\nglobal.WebSocket = WebSocket;\n\n\nclass NodeClient extends WebClient {\n\tbindEvents_() {\n\t\tthis.ws_.on('open', this.onOpen.bind(this));\n\t\tthis.ws_.on('error', this.onError.bind(this));\n\n\t\tthis.ws_.on('close', (code, reason) => {\n\t\t\tthis.onClose({code, reason});\n\t\t});\n\n\t\tthis.ws_.on('message', (data) => {\n\t\t\tthis.onMessage({data});\n\t\t});\n\t}\n\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.ws_.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\nmodule.exports = NodeClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/client-node.js"],"sourceRoot":""}