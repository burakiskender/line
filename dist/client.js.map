{"version":3,"sources":["webpack:///webpack/bootstrap eca2ca63ac5fdb271933","webpack:///./src/client/client.js","webpack:///external \"uws\"","webpack:///./src/lib/message.js","webpack:///external \"lodash\"","webpack:///external \"node-uuid\"","webpack:///external \"events\""],"names":["Client","options","promiseCallbacks","url","ws","readyState","bindEvents","on","onOpen","bind","onClose","onError","onMessage","emit","code","message","err","data","flags","parse","id","event","payload","resolve","reject","failed","_","assign","Error","done","isObject","name","response","send_","eventName","messageId","setId","then","Promise","send","toString","module","exports","uuid","Message","raw","JSON","v4","isUndefined","isEmpty","stringify"],"mappings":"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","file":"client.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap eca2ca63ac5fdb271933","import WebSocket from 'uws';\nimport Message from '../lib/message';\nimport {EventEmitter} from 'events';\n\n\nclass Client extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\n\t\tthis.promiseCallbacks = {};\n\t\tthis.options = options;\n\t}\n\n\tconnect(url = 'localhost') {\n\t\tthis.ws = new WebSocket(url, this.options);\n\t\tthis.readyState = this.ws.readyState;\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents() {\n\t\tthis.ws.on('open', this.onOpen.bind(this));\n\t\tthis.ws.on('close', this.onClose.bind(this));\n\t\tthis.ws.on('error', this.onError.bind(this));\n\t\tthis.ws.on('message', this.onMessage.bind(this));\n\t}\n\n\tonOpen() {\n\t\tthis.readyState = this.ws.readyState;\n\t\tthis.emit('open');\n\t}\n\n\n\tonClose(code, message) {\n\t\tthis.readyState = this.ws.readyState;\n\t\tthis.emit('close', code, message);\n\t}\n\n\tonError(err) {\n\t\tthis.readyState = this.ws.readyState;\n\t\tthis.emit('error', err);\n\t}\n\n\tonMessage(data, flags) {\n\t\tconst message = Message.parse(data);\n\n\t\tif (!message.options.id)\n\t\t\treturn this.emit(message.event, message.payload, message);\n\n\t\tif (message.event == '_ack') {\n\t\t\tconst {resolve, reject} = this.promiseCallbacks[message.options.id];\n\n\t\t\tif (message.options.failed) {\n\t\t\t\tconst err = _.assign(new Error(), err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(message.payload);\n\t\t\t}\n\n\t\t\tdelete this.promiseCallbacks[message.options.id];\n\t\t\treturn;\n\t\t}\n\n\t\tconst done = (err, payload) => {\n\t        if (_.isObject(err) && err instanceof Error && err.name == 'Error')\n\t            err = {message: err.message, name: 'Error'};\n\n\t\t\tconst response = err ? new Message('_ack', err, {failed: true, id: message.options.id}) : new Message('_ack', payload, {id: message.options.id});\n\t\t\tthis.send_(response);\n\t\t};\n\n\t\tthis.emit(message.event, message.payload, done, message);\n\t}\n\n\tsend(eventName, payload) {\n\t\tconst message = new Message(eventName, payload);\n\t\tconst messageId = message.setId();\n\t\treturn this\n\t\t\t.send_(message)\n\t\t\t.then(_ => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.promiseCallbacks[messageId] = {resolve, reject};\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsend_(message) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.ws.send(message.toString(), err => {\n\t\t\t\tif (err) return reject(err);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n}\n\nmodule.exports = Client;\n\n\n// WEBPACK FOOTER //\n// ./src/client/client.js","module.exports = require(\"uws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uws\"\n// module id = 1\n// module chunks = 0","import * as _ from 'lodash';\nimport * as uuid from 'node-uuid';\n\n\nexport default class Message {\n\tstatic parse(raw) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(raw);\n\t\t\treturn new Message(data.event, data.payload, data.options);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not parse message.`);\n\t\t}\n\t}\n\n\tconstructor(event, payload, options = {}) {\n\t\tthis.event = event;\n\t\tthis.payload = payload;\n\t\tthis.options = options;\n\t}\n\n\tsetId(id) {\n\t\tif (!id)\n\t\t\tid = uuid.v4();\n\t\tthis.options.id = id;\n\t\treturn id;\n\t}\n\n\ttoString() {\n\t\ttry {\n\t\t\tconst data = {event: this.event};\n\n\t\t\tif (!_.isUndefined(this.payload))\n\t\t\t\tdata.payload = this.payload;\n\n\t\t\tif (!_.isEmpty(this.options))\n\t\t\t\tdata.options = this.options;\n\n\t\t\treturn JSON.stringify(data);\n\t\t} catch(err) {\n\t\t\tthrow new Error(`Could not stringify message.`);\n\t\t}\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/message.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 5\n// module chunks = 0"],"sourceRoot":""}